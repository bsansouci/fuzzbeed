var BF_UniversalDOM=function(){this.UNIVERSAL_DOM_CLASS="bf_dom";this.UNIVERSAL_DOM_ATTR="rel:bf_bucket";this.UNIVERSAL_DOM_DATA_ATTR="rel:bf_bucket_data";this.UNIVERSAL_DOM_BUCKET_DATA_ATTR="rel:bf_data";this._bucket={};this._element_assignment_lookup={};this.init=function(){universal_dom._bucket={};$$("."+universal_dom.UNIVERSAL_DOM_CLASS).each(function(el){universal_dom._assign(el)})};this.get_bucket_elements=function(bucket){if(typeof universal_dom._bucket[bucket]=="undefined"){return[]}var elements=[];universal_dom._bucket[bucket].elements.each(function(obj){elements.push(obj.element)});return elements};this.get_bucket_elements_with_data=function(bucket,data){if(typeof universal_dom._bucket[bucket]=="undefined"){return[]}var elements=[];universal_dom._bucket[bucket].elements.each(function(el){var matches=true;for(var each in data){if(typeof el.data[each]=="undefined"||el.data[each]!=data[each]){matches=false}}if(matches){elements.push(el.element)}});return elements};this.class_regex=new RegExp(this.UNIVERSAL_DOM_CLASS);this.update=function(snippet){var s=$(snippet);if(s){var elements=s.select('[class~="'+universal_dom.UNIVERSAL_DOM_CLASS+'"]');if(elements.length==0&&s.innerHTML.match(universal_dom.class_regex)){elements=new Array();universal_dom.extract_dom_class_elements(snippet,elements)}if(s.hasClassName(this.UNIVERSAL_DOM_CLASS)){elements.push(s)}elements.each(function(el){universal_dom._assign(el)})}};this.extract_dom_class_elements=function(snippet,list){if(snippet.className&&snippet.className.match(universal_dom.class_regex)){list.push(snippet)}for(var i=0;i<snippet.childNodes.length;i++){universal_dom.extract_dom_class_elements(snippet.childNodes[i],list)}};this.assign_handler=function(obj){var bucket=obj.bucket;var handler=obj.handler;var event=obj.event||"immediate";var needs_to_be_added=true;var my_bucket=universal_dom._bucket[bucket]||{};var handlers=my_bucket.handlers||{};var handler_list=handlers[event]||[];handler_list.each(function(fn){if(fn==handler){needs_to_be_added=false}});if(needs_to_be_added){handler_list.push(handler);handlers[event]=handler_list;my_bucket.handlers=handlers;universal_dom._bucket[bucket]=my_bucket}universal_dom._assign_handler(bucket)};this.add_element_to_bucket=function(obj){var bucket=obj.bucket;var element=obj.element;var data=obj.data;var the_bucket=universal_dom._bucket[bucket]||{};var bucket_elements=the_bucket.elements||[];bucket_elements.push({element:element,data:data});the_bucket.elements=bucket_elements;universal_dom._bucket[bucket]=the_bucket;universal_dom._assign_handler(bucket);var assigned_to_buckets=universal_dom._element_assignment_lookup[element]||[];assigned_to_buckets.push(bucket);universal_dom._element_assignment_lookup[element]=assigned_to_buckets};this.remove_element_from_buckets=function(element){var buckets=universal_dom._element_assignment_lookup[element];if(buckets){buckets.each(function(bucket){var new_bucket_elements=[];universal_dom._bucket[bucket].elements.each(function(el){if(el.element!=element){new_bucket_elements.push(el)}});universal_dom._bucket[bucket].elements=new_bucket_elements})}};this.refresh_immediate_bucket=function(bucket){if(universal_dom._bucket[bucket].elements){universal_dom._bucket[bucket].elements.each(function(obj){if(universal_dom._bucket[bucket].handlers.immediate){universal_dom._bucket[bucket].handlers.immediate.each(function(fn){fn(obj.element,obj.data)})}})}};this._assign_handler=function(for_bucket){var bucket=universal_dom._bucket[for_bucket];var handlers=bucket.handlers;if(typeof bucket.elements=="undefined"){bucket.elements=[]}for(var i=0;i<bucket.elements.length;i++){var element=bucket.elements[i].element;var data=bucket.elements[i].data;data.element=element;for(var event in handlers){handlers[event].each(function(fn){var assigned=data.assigned||{};if(typeof assigned[fn.toString()]=="undefined"){if(event=="immediate"){fn(element,data)}else{var cl=Object.clone(data);element.observe(event,function(e){for(var each in cl){e[each]=cl[each]}fn(e)})}}assigned[fn.toString()]=true;data.assigned=assigned;universal_dom._bucket[for_bucket].elements[i].data=data})}}};this._assign=function(el){if(el.hasAttribute(this.UNIVERSAL_DOM_ATTR)){this.bucket_attr(el)}else{if(el.hasAttribute(this.UNIVERSAL_DOM_DATA_ATTR)){this.bucket_data_attr(el)}else{}}};this.update_or_add_element_in_bucket=function(obj){var bucket=obj.bucket;var element=obj.element;var data=obj.data;var b=universal_dom._bucket[bucket];if(typeof b=="undefined"||typeof b.elements=="undefined"||b.elements.length==0){universal_dom.add_element_to_bucket({bucket:bucket,element:element,data:data});return}var exists=0;b.elements.each(function(b_element,index){if(b_element.element==element){b.elements[index].data=data;exists=1;throw $break}});if(!exists){universal_dom.add_element_to_bucket({bucket:bucket,element:element,data:data})}};this.bucket_attr=function(el){var bucket="";try{bucket=el.getAttribute(universal_dom.UNIVERSAL_DOM_ATTR);var data={};var data_attr=el.getAttribute(universal_dom.UNIVERSAL_DOM_BUCKET_DATA_ATTR);if(data_attr){data=eval("("+data_attr+")")}var buckets=bucket.split(" ");buckets.each(function(bucket_name){universal_dom.update_or_add_element_in_bucket({element:el,bucket:bucket_name,data:data})})}catch(e){console.error(e+bucket+el.id+universal_dom.UNIVERSAL_DOM_BUCKET_DATA_ATTR)}};this.bucket_data_attr=function(el){var data=el.getAttribute(universal_dom.UNIVERSAL_DOM_DATA_ATTR);try{var obj=eval("("+data+")")}catch(e){console.error("Failed to parse JSON ("+data+") for element "+el+" (id:"+el.id+",class:"+el.className+",tag:"+el.tagName+")")}for(var bucket_name in obj){universal_dom.update_or_add_element_in_bucket({element:el,bucket:bucket_name,data:obj[bucket_name]})}};this.remove_bucket_elements=function(array_of_buckets){array_of_buckets.each(function(bucket){if(typeof universal_dom._bucket[bucket]!="undefined"){delete universal_dom._bucket[bucket].elements}})};this.assign_ids_to_elements_in_bucket=function(bucket,callback){universal_dom._bucket[bucket].elements.each(function(el,idx){if(typeof el.element!="undefined"&&!el.element.id){el.element.id=callback(idx)}})}};var universal_dom=new BF_UniversalDOM();universal_dom.init();universal_dom.assign_handler({bucket:"toggle",event:"click",handler:function(b){b.stop();var a=function(c){if(c.style.display=="none"){c.toggle()}else{if(c.hasClassName("hidden")){c.removeClassName("hidden")}else{c.addClassName("hidden")}}};if(typeof b.el!="undefined"){a($(b.el))}if(typeof b.els!="undefined"){b.els.each(function(c){a($(c))})}}});universal_dom.assign_handler({bucket:"stop",event:"click",handler:Event.stop});BF_ProgLoad_Images=function(){this.images=new Hash();this.index=1;this.DEBUG=false;this.bad_browser=0;this.autoload=false;this.autoload_interval=1000;this.min_lookahead_pixels=400;this.init_total_delay=0;this.init_max_delay=10000;this.init_delay_interval=250;var a=this;this.init=function(){bf_prog_load.media=new Hash();if(document.location.search.match(/progload_debug=true/)){this.DEBUG=true;console.debug("init progressive image loader...")}try{this.lookahead_pixels=document.viewport.getHeight();if(window.BF_IS_TOP_LIST&&this.lookahead_pixels<2000){this.lookahead_pixels=2000}if(this.lookahead_pixels<a.min_lookahead_pixels&&a.init_total_delay<a.init_max_delay){a.init_total_delay+=a.init_delay_interval;setTimeout(bf_prog_load.init,a.init_delay_interval);return}var c=document.viewport.getScrollOffsets();var b=c[1];b=document.viewport.getHeight()+b;universal_dom.get_bucket_elements("progload").each(function(h){var g=h.getAttribute("rel:bf_image_src");var f=h.cumulativeOffset()[1];if(bf_prog_load.DEBUG){console.log("INIT viewport: %s image offset: %s image: %s lookahead: %s pixels",b,f,g,bf_prog_load.lookahead_pixels);h.title=f}if(b>(f-bf_prog_load.lookahead_pixels)){if(bf_prog_load.DEBUG){h.style.border="solid red 1px"}a.load_image(h,((g.indexOf("http://")==0)?g:BF_STATIC.image_root+g))}else{var i={el:h,position:f,src:g};bf_prog_load.media.set(""+bf_prog_load.index,i);bf_prog_load.index++}});universal_dom.get_bucket_elements("progload_video").each(function(g){var f=g.cumulativeOffset()[1];bf_prog_load.media.set(""+bf_prog_load.index,{data:g,position:f,type:"video"});bf_prog_load.index++});if((Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6)||Prototype.Browser.Opera||!!window.fb_app){bf_prog_load.bad_browser=1;setTimeout(function(){bf_prog_load.scrolled("all")},500)}else{Event.observe(window,"scroll",function(f){bf_prog_load.scrolled()})}}catch(d){console.error(d)}universal_dom.assign_handler({bucket:"add_to_prog_load",handler:bf_prog_load.add});a.autoload_images()};this.autoload_images=function(){a.autoload=true;if(a.DEBUG){console.info("Starting image autoload")}var b;b=setInterval(function(){if(!bf_prog_load.media.size()){if(a.DEBUG){console.info("End image autoload")}a.autoload=false;clearInterval(b)}else{bf_prog_load.media.each(function(d){if(!d.value.type){var c=d.value.el.getAttribute("rel:bf_image_src");if(c==d.value.el.src){return}if(a.DEBUG){d.value.el.style.border="solid orange 1px"}a.load_image(d.value.el,((d.value.src.indexOf("http://")==0)?d.value.src:BF_STATIC.image_root+d.value.src));bf_prog_load.media.unset(d.key);throw $break}})}},a.autoload_interval)};this.image_watcher=function(c,f,d,b){this.maxRetries=3;this.retry=0;this.retryTimeout=[10000,20000,30000];this.el=c;this.src=f;this.success=d;this.error=b;this.load=function(){if(a.DEBUG){console.log((this.retry==0?"First":("Try #"+this.retry))+" load "+this.src)}this.image=new Image();this.image.onload=function(g){return function(){g.onsuccess.call(g)}}(this);this.image.onabort=function(g){return function(){g.timeout.call(g)}}(this);this.image.onerror=function(g){return function(){g.timeout.call(g)}}(this);this.image.src=this.src};this.onsuccess=function(){this.image=null;this.success(this)};this.timeout=function(){this.image=null;if(this.retry>=this.maxRetries){this.error(this);return}if(a.DEBUG){console.log("Waiting "+this.retryTimeout[this.retry]+" ms on "+this.src)}setTimeout(function(g){return function(){g.load.call(g)}}(this),this.retryTimeout[this.retry]);this.retry++}};this.load_image=function(b,c){if(b.className.match(/progload-tweet/)){bf_prog_load.loadTwitterEmbed(b);return false}else{if(b.className.match(/progload-instagram/)){bf_prog_load.loadInstagramEmbed(b);return false}}new this.image_watcher(b,c,function(d){if(a.DEBUG){console.info("Image %s was loaded successfully.",d.src)}b.src=c},function(d){if(a.DEBUG){console.error("Image %s wasn't loaded.",d.src)}b.src=trans_gif_1x1_base64}).load()};this.loadInstagramEmbed=function(d){var c=d.getAttribute("rel:bf_instagram_el"),b=document.getElementById(c);b.className="instagram-media";if(typeof instgrm!="undefined"&&typeof instgrm.Embeds!="undefined"){instgrm.Embeds.process()}};this.loadTwitterEmbed=function(b){if(typeof EventManager!="undefined"){EventManager.fire("progload:tweet",{el:b})}};this.scrolled=function(b){try{bf_prog_load.media.each(function(g){var f=document.viewport.getScrollOffsets();var d=f[1];d=document.viewport.getHeight()+d;if(d>(g.value.position-bf_prog_load.lookahead_pixels)||b){if(bf_prog_load.DEBUG){console.log("SCROLL viewport: %s image offset: %s image: %s",d,g.value.position,g.value.src);if(b){g.value.el.style.border="solid green 1px"}else{g.value.el.style.border="solid blue 1px"}}if(g.value.data){embed_video.load_video(g.value.data,true)}else{a.load_image(g.value.el,((g.value.src.indexOf("http://")==0)?g.value.src:BF_STATIC.image_root+g.value.src))}bf_prog_load.media.unset(g.key)}})}catch(c){console.error(c)}};this.add=function(g){var d=g.getAttribute("rel:bf_image_src");var b=g.cumulativeOffset()[1];var h=document.viewport.getScrollOffsets();var c=h[1];c=document.viewport.getHeight()+c;if(c>(b-bf_prog_load.lookahead_pixels)||bf_prog_load.bad_browser){if(bf_prog_load.DEBUG){g.style.border="solid yellow 1px";console.log("SHOW (add). offset: %s image: %s lookahead: %s pixels",b,d,bf_prog_load.lookahead_pixels)}a.load_image(g,((d.indexOf("http://")==0)?d:BF_STATIC.image_root+d))}else{var j={el:g,position:b,src:d};if(bf_prog_load.DEBUG){console.log("ADDING image. offset: %s image: %s lookahead: %s pixels",b,d,bf_prog_load.lookahead_pixels)}bf_prog_load.media.set(""+bf_prog_load.index,j);bf_prog_load.index++;if(!a.autoload){a.autoload_images()}}var f=g.getAttribute("rel:bf_bucket");var i=f.replace("add_to_prog_load","xx");g.setAttribute("rel:bf_bucket",i)}};var bf_prog_load=new BF_ProgLoad_Images();BuzzLoader.register(function(){bf_prog_load.init()},2);var SigninAnywhere=function(){this.init=function(){universal_dom.assign_handler({bucket:"SigninAnywhere.open",event:"click",handler:signin_anywhere.open});universal_dom.assign_handler({bucket:"SigninAnywhere.close",event:"click",handler:signin_anywhere.close});universal_dom.assign_handler({bucket:"sign-in",event:"click",handler:signin_anywhere.reset});signin_anywhere.dialog=null;bf_login.init({current_page:"signin_anywhere"})};this.close=function(){if(signin_anywhere.dialog){signin_anywhere.dialog.hide()}};this.open=function(i){var j=document.getElementsByTagName("BODY");if(!j){return}var o=$(i.el);var g;var m;var c="login";if(signin_anywhere.dialog){m=signin_anywhere.dialog;k=m.getElementsByTagName("IFRAME")[0];if((new BF_User().isLoggedIn())){if(typeof i.logged_in_iframe_url!="undefined"){k.src=i.logged_in_iframe_url;c="react"}}else{k.src=BF_STATIC.web_root+"/signin_anywhere?logged_in_iframe_url="+i.logged_in_iframe_url}m.show()}else{m=document.createElement("div");m.id="signin_anywhere_container";var k=document.createElement("iframe");k.id="signin_anywhere_iframe";if((new BF_User().isLoggedIn())){if(typeof i.logged_in_iframe_url!="undefined"){k.src=i.logged_in_iframe_url;c="react"}}else{k.src=BF_STATIC.web_root+"/signin_anywhere"+(i.logged_in_iframe_url?"?logged_in_iframe_url="+i.logged_in_iframe_url:"")}j[0].appendChild(m);signin_anywhere.dialog=m;signin_anywhere.loading=g;m.insert(k);universal_dom.update(m)}if(c=="login"){var d={width:620,height:520};if(Prototype.Browser.IE){d.height=560}var h=j[0].getDimensions();var n=Math.round(parseInt(h.width)/2-parseInt(d.width)/2);var l=o.cumulativeOffset().top-200;var f={top:l+"px",left:n+"px"};g=document.createElement("div");g.id="signin_anywhere_loading";g.innerHTML='<img src="/static/images/public/spinners/big_on_e6e6e6.gif" style="margin:'+d.height/2+"px "+(d.width/2-15)+'px;" />';g.setStyle({left:n,top:l});m.setStyle({zIndex:"1001",padding:"20px 0px 0px 0px",display:"block",position:"absolute",top:f.top,left:f.left,background:"#fff","box-shadow":"2px 2px 2px #888",width:d.width+"px",height:d.height+"px",border:"1px solid #000"});m.insert({top:g});k.setStyle({width:d.width+"px",height:d.height+"px"});if(!$("exit_bar")){var b='					<div id="exit_bar" style="width:100%;height:25px;background-color:#000000; position: absolute; top: 0px;"> 					<a class="bf_dom" style="float:right;color:white;margin:2px 5px; font-size:16px; font-family:Helvetica; font-weight:bold;" onclick="signin_anywhere.close();" href="javascript:;">x</a> 					</div> 				';m.insert({top:b})}}else{if(c="react"){a(o,m,k)}}k.observe("load",function(){if((new BF_User()).isLoggedIn()){(new BF_UserNav()).init()}if(g){g.hide()}var p=$("signin_anywhere_iframe").contentWindow.document.getElementById("social-actions");if(p){p.observe("set:reaction",function(q){a(o,m,k);if($("reaction-message")){$("reaction-message").addClassName("reaction-complete")}if(o.hasClassName("heart")){o.up().addClassName("deactivated")}else{o.addClassName("deactivated")}})}else{window.parent.bf_login.loggedInCallbacks.push(function(){signin_anywhere.close()})}});function a(t,q,s){s.addClassName("hidden");q.addClassName("hidden");var p=' 			<div id="reaction-message"> 				<span class="icon timetoshare"></span> 				<span class="icon checkmark"></span> 				<h3>Yes! Share it with friends</h3> 			</div> 			';if(!$("reaction-message")){if($(t).up(".splash_dfp_story")){t.up("div").insert({after:p})}else{if($$(".one_vid").length>0){$$(".badges.one_vid")[0].insert({bottom:p});$("reaction-message").setStyle({width:"410px"});$$(".icon.timetoshare")[0].hide();var r=new RegExp("^[0-9]+");var v=r.exec("150px");$$(".video-module-sharing.one_vid")[0].setStyle({left:(v*1+290)+"px"})}}}}};this.reset=function(){$("new-registration-form").hide();$("login-form").show()}};var signin_anywhere=new SigninAnywhere();BuzzLoader.register(function(){signin_anywhere.init()},2);var BF_SignIn=function(){this.wrap;this.section;this.overlay;this.signin_page;this.social_register=false;this.email_updates=0;this.reg_name;this.email;this.fb_done=0;this.fb_edit;this.spin_el;this.modal_type;this.modal_mode;this.page_location;this.callbacks={onLogin:[],onRegister:[]};this.keydown_enabled=true;this.mousedown_enabled=true;this.close_enabled=true;this.mask_hidden=true;this.signup_test=false;this.opened=false;this.is_gplus=false;this.android_app_package="com.buzzfeed.android";this.html={section_wrapper:'<div class="signin_section" id="signin_modal" rel:gt_cat="'+BF_STATIC.tt_page+':Signin-Modal"><a href="javascript:;" onclick="signin.close()" class="white_popup_close fa fa-times" rel:gt_act="sign-in-close"></a><div class="signin_content">#{content}</div></div>',section_content:{initial:'				<div class="signin_upper">					<div class="msg-text" id="initial-msg"></div>					<header id="initial_header">'+local.t("Sign in here!")+'</header>					<a href="javascript:;" onclick="signin.fb_login()" class="fb-button bf_dom" rel:gt_act="initial-fb-sign">						<div class="fb-icon fa fa-facebook"></div>						<div class="fb-label" id="initial_fb_text">'+local.t("Sign in with Facebook")+'</div>					</a>  					<a class="bf-gplus-button bf_dom hidden" id="gplus-signin-button" rel:gt_act="googleplus-signin">  					<span id="g-signin-button"></span>  					<div class="gplus-icon fa fa-google-plus"></div>						<div class="gplus-label" id="initial_gplus_text">'+local.t("Sign in with Google")+'</div>  					</a>				  </div>				<div class="signin_lower">					<span class="mid-text hide_for_non_english">You can also <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="email_signup" rel:gt_act="sign-up" id="signup-email">'+local.t("Sign Up With Email")+'</a></span>					<span class="small-text">'+local.t('By signing up for BuzzFeed, you agree to our <a href="http://www.buzzfeed.com/about/useragreement" target="_blank">Terms and Conditions</a>')+'</span>					<span class="mid-text mid-text-box"> '+local.t("Have an account?")+'&nbsp; <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="signin" rel:gt_act="sign-in" id="signin-initial">'+local.t("Sign in")+'</a></span>				</div>				<div class="brand_publisher-text"><a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="brand_publisher_signup" rel:gt_act="sign-up" id="signin-brand_publisher">'+local.t("Create an account")+"</a>&nbsp;"+local.t("for your brand or organization")+"</div>      ",signin:'				<div class="signin_upper">					<header>'+local.t("Sign In To BuzzFeed")+'</header>					<form id="login-form">						<span id="reg_error_username" class="hidden"></span>						<input rel:gt_act="email-signin-input" id="login-username" class="bf_dom initial-field-state" type="text" rel:bf_bucket="event_handler" 						       rel:actions="change:map_into focus:hide_placeholder blur:show_placeholder" value="" placeholder="'+local.t("Username")+'" />						<span id="login-username-placeholder" class="signin-placeholder">'+local.t("Username")+'</span>						<input rel:gt_act="email-signin-input" id="login-password" class="bf_dom initial-field-state" type="password" rel:bf_bucket="event_handler" 						       rel:actions="change:map_into change:mark_as_edited focus:hide_placeholder blur:show_placeholder" rel:data="{clear_default_field:{set_type:\'password\'}, mark_as_edited:{set_type:\'password\'}}" value="" placeholder="'+local.t("Password")+'" />						<span id="login-password-placeholder" class="signin-placeholder">'+local.t("Password")+'</span>						<button rel:gt_act="signin" onclick="signin.login(this)" id="login-submit" class="bf_dom submit">'+local.t("Sign in")+'</button>					</form>					<a class="trouble_signin" rel:type_data="trouble_signin" onclick="signin.set_template(this)" rel:gt_act="trouble_signin" id="forgot-password-link">'+local.t("Trouble signing in?")+'</a>				</div>				<div class="signin_sep"><div class="signin_sep_text">or</div></div>				<div class="signin_lower">						<a href="javascript:;" onclick="signin.fb_login()" class="fb-button" rel:gt_act="signin-fb"><div class="fb-icon fa fa-facebook"></div><div class="fb-label">'+local.t("Sign in with Facebook")+'</div></a>						<a class="bf-gplus-button bf_dom hidden" id="gplus-signin-button" rel:gt_act="googleplus-signin" rel:gt_label="googleplus">	  					<span id="g-signin-button"></span>	  					<div class="gplus-icon fa fa-google-plus"></div>						<div class="gplus-label" id="initial_gplus_text">'+local.t("Sign in with Google")+'</div>						</a>						<span class="mid-text hide_for_non_english">You can also <a href="javascript:;" id="signup-email-2" onclick="signin.set_template(this)" rel:type_data="email_signup" rel:gt_act="also-signup">'+local.t("Sign Up With Email")+"</a></span>	  			</div>			",trouble_signin:'				<div class="signin_upper trouble_signin">					<header>'+local.t("Trouble signing in?")+'</header>					<span class="mid-text">'+local.t("Enter the email address for your account and we'll send you your username and a link to reset your password.")+'</span>					<form id="forgot-password-form">						<input rel:gt_act="ignore" type="text" id="login-email" class="bf_dom initial-field-state" type="text" rel:bf_bucket="event_handler" 						       rel:actions="change:map_into focus:hide_placeholder blur:show_placeholder" value="" placeholder="'+local.t("Email address")+'" />						<span id="login-email-placeholder" class="signin-placeholder">'+local.t("Email address")+'</span>						<div id="reg_error_email" class="hidden"></div>						<button onclick="signin.reset_password()" id="forgot-password-submit" type="submit" value="Reset Password">'+local.t("Reset Password")+'</button>					</form>					<div class="cancel-trouble-signin"><a href="javascript:;" rel:type_data="signin" onclick="signin.set_template(this)" rel:gt_act="cancel-trouble-signin">'+local.t("Cancel")+'</a></div>				</div>				<div class="signin_lower"></div>			',trouble_signin_resp:'				<div class="signin_upper trouble_resp" id="request_pw_response">					<div class="thanks-icon fa fa-check-circle"></div>					<header>'+local.t("Thanks!")+'</header>					<div id="password_text" class="mid-text">'+local.t("OK, check your email - we've sent you a link to reset your password")+'</div>				</div>				<div class="mid-text back-to-sign-in">					<a href="javascript:;" rel:type_data="signin" onclick="signin.set_template(this)" rel:gt_act="back-to-signin">'+local.t("Back to Sign in")+"</a>				</div>			",fb_signup:'				<div id="signup_form_wrap">					<div id="signup_complete">						<div class="thanks-icon fa fa-check-circle"></div>						<header id="custom-reg-message">'+local.t("Welcome to BuzzFeed!")+'</header>						<div class="account_details fb_account">							<div class="mid-text account_details_header">'+local.t("This will be your new BuzzFeed account:")+'</div>							<div class="tooltip_content fb_tooltip hidden hide_for_non_english" id="user-image_tooltip">								<p>'+local.t('You can change your profile picture on your <a href="/settings">settings page</a>')+'</p>								<span class="arrow_down">&nbsp;</span>							</div>							<div class="tooltip_content fb_tooltip hidden hide_for_non_english" id="reg_username_tooltip">								<p>'+local.t("Click the edit button to the right to modify your display name")+'</p>								<span class="arrow_down">&nbsp;</span>							</div>							<div class="tooltip_content fb_tooltip hidden hide_for_non_english" id="reg_site_home_tooltip">								<p>'+local.t("Click the edit button above to modify your custom buzzfeed URL")+'</p>								<span class="arrow_up">&nbsp;</span>							</div>							<div class="tooltip_content fb_tooltip hidden hide_for_non_english" id="reg_link_tooltip">								<p>'+local.t("Click the edit button above to modify your custom buzzfeed URL")+'</p>								<span class="arrow_up">&nbsp;</span>							</div>							<a href="javascript:;" onclick="signin.fb_update(this)" class="edit_pencil fa fa-pencil" id="edit_update" rel:gt_act="edit-user-info">&nbsp;</a>							<a href="javascript:;" onclick="signin.cancel_fb_update(false, null, null)" class="edit_cancel fa fa-times hidden" id="cancel_update" rel:gt_act="cancel-edit-user-info">&nbsp;</a>							<div class="default_image"><img src="" id="user-image"/></div>							<span class="register_username" id="reg_username"></span>							<input rel:gt_act="ignore" type="text" id="update_display_name" class="hidden" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" 							       rel:actions="keyup:filter_chars change:map_into" 							       rel:data="{filter_chars:{disallow:/[^A-Za-z0-9]/g},map_into:{target:\'submit-button\',field:\'register.username\'}}" rel:gt_act="ignore">							<span id="reg_error_displayname" class="hidden"></span>							<div class="register_url" id="reg_url"><span id="reg_site_home">http://buzzfeed.com/</span><span class="register_link" id="reg_link"></span><input rel:gt_act="ignore" type="text" id="update_user_name" class="hidden" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" rel:actions="keyup:filter_chars change:map_into" rel:data="{filter_chars:{disallow:/[^A-Za-z0-9]/g},map_into:{target:\'submit-button\',field:\'register.username\'}}" rel:gt_act="ignore"></div>							<span id="reg_error_new_username" class="hidden new_user_error"></span>						</div>					</div>				</div>			',email_signup:'				<div id="signup_form_wrap">					<div class="signin_upper" >						<header>'+local.t("Sign Up With Email")+'</header>						<form id="registration-form">							<input id="register-username"  rel:gt_act="sign-up-input" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" type="text" value="" 							       rel:actions="keyup:filter_chars change:map_into focus:hide_placeholder blur:show_placeholder" 							       rel:data="{filter_chars:{disallow:/[^A-Za-z0-9]/g},map_into:{target:\'submit-button\',field:\'register.username\'}}" placeholder="'+local.t("Pick a Username")+'" />							<span id="register-username-placeholder" class="signin-placeholder">'+local.t("Pick a Username")+'</span>							<span id="reg_error_username" class="hidden"></span>							<input id="register-password" rel:gt_act="sign-up-input" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" type="password" 							       value="" rel:actions="change:map_into focus:hide_placeholder blur:show_placeholder" 							       rel:data="{clear_default_field:{set_type:\'password\'},map_into:{target:\'submit-button\',field:\'register.pw\'}}" autocomplete="off" placeholder="'+local.t("Pick a Password")+'" />							<span id="register-password-placeholder" class="signin-placeholder">'+local.t("Pick a Password")+'</span>							<span id="reg_error_pw" class="hidden"></span>							<input id="register-email" rel:gt_act="sign-up-input" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" type="text" 							       value="" rel:actions="change:map_into focus:hide_placeholder blur:show_placeholder" 							       rel:data="{map_into:{target:\'submit-button\',field:\'register.email\'}}" placeholder="'+local.t("Enter Your Email")+'" />							<span id="register-email-placeholder" class="signin-placeholder">'+local.t("Enter Your Email")+'</span>							<span id="reg_error_email" class="hidden"></span>							<div class="bf_email_check hidden">								<label for="email_signup"><input rel:gt_act="checkbox" type="checkbox" id="email_signup" checked="true"> '+local.t("Let me know when BuzzFeed launches cool stuff")+'</label>							</div>							<div class="daily_email_signup_2_wrap"><input type="checkbox" id="daily_email_signup_2" onchange="signin.pmde.daily_email(this)" rel:gt_act="newsletter-signup"><label for="daily_email_signup_2">'+local.t('Get the<span class="bf_daily_email_logo"></span>Daily Email')+'</label></div>							<button id="register-button" class="bf_dom submit" onclick="signin.register(this)" rel:gt_act="email-signup">'+local.t("Sign Up")+'</button>						</form>					</div>					<div class="signin_sep"><div class="signin_sep_text">or</div></div>					<div class="signin_lower">						<div class="signin_lower_social">							<a href="javascript:;" onclick="signin.fb_login()" class="fb-button" rel:gt_act="fb_signup"><div class="fb-icon fa fa-facebook"></div><div class="fb-label">'+local.t("Sign up with Facebook")+'</div></a>							<a class="bf-gplus-button bf_dom hidden" id="gplus-signin-button" rel:gt_act="googleplus-signin" rel:gt_label="googleplus"><span id="g-signin-button"></span><div class="gplus-icon fa fa-google-plus"></div>							<div class="gplus-label gplus-label-signup" id="initial_gplus_text">'+local.t("Sign up with Google")+'</div>							</a>						</div>						<span class="mid-text"> '+local.t("Have an account?")+'&nbsp; <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="signin" rel:gt_act="signin-screen">'+local.t("Sign in")+'</a></span>					</div>				</div>				<div class="hidden" id="signup_complete">					<div class="thanks-icon fa fa-check-circle"></div>					<header class="complete">'+local.t("Thanks!")+'</header>					<div class="message_wrapper" id="msg_wrap">						<span class="mid-text email_confirm">'+local.t("Check your mail and click the confirmation link.")+'</span>						<span class="email_tooltip hide_for_non_english fa fa-info-circle" id="show_tooltip">							<div class="hidden tooltip_content" id="tooltip_text">								<span class="arrow_up"></span>								<p>'+local.t("If you don't recieve the mail in a few minutes, please check your spam folder")+".</p>								<p>"+local.t('If the email doesn\'t arrive, go to the <a href="/signin"> sign in page</a> and click "forgot password" to resend the email.')+'</p>							</div>						</span>					</div>					<div class="account_details">						<div class="mid-text account_details_header">'+local.t("This will be your new BuzzFeed account:")+'</div>						<div class="default_image" id="default_image_wrap">							<img src="" id="user-image"/>							<div class="tooltip_content fb_tooltip hidden" id="user-image_tooltip">								<p>'+local.t('You can change your profile picture on your <a href="/settings">settings page</a>')+'</p>								<span class="arrow_down">&nbsp;</span>							</div>						</div>						<span class="register_username" id="reg_username"></span>						<span class="register_link" id="reg_link"></span>					</div>				</div>			',ok_content:'			<div class="get_bf_email email_signup hidden" id="reg_email_check">				<input type="checkbox" id="daily_email_signup" onchange="signin.test_email_signup(this)" rel:gt_act="newsletter-signup">				<div class="email_tag"><p id="email_msg">'+local.t("Get the")+'</p></div>				<div class="logo_text"><span class="bf_logo"></span> <span class="daily_text">'+local.t("Daily Email")+'</span></div>				<div class="email_signup_request hidden" id="email-request">Done!</div>			</div>			<div class="email_signup_2_wrap hidden"><label for="email_signup_2"><input rel:gt_act="checkbox" type="checkbox" id="email_signup_2" onchange="signin.pmde.email_signup(this)"> '+local.t("Let me know when BuzzFeed launches cool stuff")+'</label></div>			<div class="bf-buttons" id="bf-follow">				<a href="https://www.facebook.com/BuzzFeed"  alt="Like us on Facebook" rel:gt_act="signup-bf-facebook" class="fb-button"><div class="fb-icon fa fa-facebook"></div><div class="fb-label">'+local.t("Like us on Facebook")+'</div></a>				<a href="https://twitter.com/intent/user?screen_name=BuzzFeed" class="tw-follow bf-tw-button" alt="Follow us on Twitter" rel:gt_act="signup-bf-twitter"><div class="tw-icon fa fa-twitter"></div><div class="tw-label">'+local.t("Follow us on Twitter")+'</div></a>			</div>			<a href="javascript:;" onclick="signin.update_user_info(false)" class="email ok_button hidden" rel:gt_act="email-update-user-info">'+local.t("Okay, thanks!")+"</a>			"}};this.init=function(){};this.keydown=function(ev){if(!signin.keydown_enabled){return false}if(ev.keyCode==Event.KEY_ESC){if(signin.modal_type=="initial"){signin.close()}}};this.mousedown=function(ev){if(!signin.mousedown_enabled){return false}if(ev.target.hasClassName("signin_overlay")&&signin.modal_type=="initial"){signin.close()}};this.open=function(e){signin.pmde.allow_daily_email=false;try{if(signin.opened){return}if(typeof bf_rdio!="undefined"&&bf_rdio.hide){bf_rdio.hide()}signin.page_location=e.location;signin.modal_type=e.signin_type;if(e.reg_params){signin.reg_params=e.reg_params}if(e.mode){signin.modal_mode=e.mode}signin.signin_page=true;signin.overlay=new Element("div",{"class":"signin_overlay white_popup_overlay"});signin.wrap=new Element("div",{"class":"signin_wrapper white_popup"});signin.overlay.setStyle({opacity:0});$$("body")[0].insert(signin.overlay);signin.overlay.insert(signin.wrap);signin.mask_hidden=false;BF_Effect.FadeIn(signin.overlay,1,0.1,function(){if(e.bookmark_overlay){$s(".bookmark-white-overlay").hide()}});signin.section=new Template(signin.html.section_wrapper);if(e.signin_type=="signin"){signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.initial}))}else{signin.wrap.update(signin.section.evaluate({content:signin.html.section_content[e.signin_type]}))}setTimeout(function(){signin.set_input_events()},5);if(e.mode){signin.set_mode(e.mode,e.signin_type)}if(typeof e.keydown_enabled!="undefined"&&!e.keydown_enabled||e.keydown_disabled){signin.keydown_enabled=false}if(typeof e.mousedown_enabled!="undefined"&&!e.mousedown_enabled||e.mousedown_disabled){signin.mousedown_enabled=false}if(typeof e.close_enabled!="undefined"&&!e.close_enabled||e.close_disabled){signin.close_enabled=false}if(signin.signin_page){document.observe("click",signin.mousedown);document.observe("keydown",signin.keydown)}bf_login.loggedInCallbacks.push.apply(bf_login.loggedInCallbacks,signin.callbacks.onLogin);signin.opened=true;signin.append_gtrack();if(!isIE8()){$s("#gplus-signin-button").removeClassName("hidden");$s("#gplus-signin-button").observe("click",function(e){signin._gplus_render()})}gtrack.track_events(BF_STATIC.tt_page+":Signin-Modal","[nc]imp-signin-"+signin.page_location,gtrack.postEvents.toString(),"",true)}catch(e){console.error(e)}};this.set_signup_buttons=function(){if($("signup_complete")){$("signup_complete").insert(signin.html.section_content.ok_content)}if(signin.social_register){$s(".ok_button").removeClassName("hidden");$s(".ok_button").setAttribute("onclick","signin.update_user_info(true)")}};this.test_email_signup=function(e,is_ie){if((e&&e.checked)||is_ie){signin.email_signup(signin.email,true)}};this.close=function(){document.stopObserving("keydown",signin.keydown);signin.mask_hidden=false;BF_Effect.FadeOut(signin.overlay,false,false,function(){signin.mask_hidden=true});BF_Effect.FadeOut(signin.wrap,false,false);setTimeout(function(){if(signin.callbacks.onLogin.length&&bf_login.loggedInCallbacks.length){var cbs=[];for(var i=0;i<bf_login.loggedInCallbacks.length;i++){var ifcb=false;for(var j=0;j<signin.callbacks.onLogin.length;j++){if(bf_login.loggedInCallbacks[i]==signin.callbacks.onLogin[j]){ifcb=true}}if(!ifcb){cbs.push(bf_login.loggedInCallbacks[i])}}bf_login.loggedInCallbacks=cbs}signin.callbacks.onLogin=[];signin.callbacks.onRegister=[];if(signin.wrap&&signin.wrap.parentNode){signin.wrap.remove()}if(signin.overlay&&signin.overlay.parentNode){signin.overlay.remove()}signin.opened=false},500)};this.set_template=function(e){setTimeout(function(){signin.set_input_events()},5);signin.modal_type=e.getAttribute("rel:type_data");var template=(signin.modal_type=="brand_publisher_signup"?"email_signup":signin.modal_type);signin.wrap.update(signin.section.evaluate({content:signin.html.section_content[template]}));if(signin.modal_type=="trouble_signin"){var forgot_password_form=$("forgot-password-form");if(forgot_password_form){if(!bf_login.initialized){forgot_password_form.observe("submit",function(event){event.stop()}.bind(this))}}}else{if(signin.modal_type=="brand_publisher_signup"){var form=$$(".signin_wrapper")[0];if(form){form.addClassName("brand_publisher_signup");if(form.select("header")[0]){form.select("header")[0].innerHTML=local.t("Create an account for your brand or organization")}if(form.select(".signin_lower_social")[0]){form.select(".signin_lower_social")[0].hide()}if(form.select("#register-button")[0]){form.select("#register-button")[0].addClassName("brand_publisher")}}}}var reg_form=$("registration-form");if(reg_form){reg_form.observe("submit",function(event){event.stop()}.bind(this))}var login_form=signin.wrap.select("#login-form")[0];if(login_form){login_form.observe("submit",function(event){event.stop()}.bind(this))}var reset_form=signin.wrap.select("#forgot-password-form")[0];if(reset_form){reset_form.observe("submit",function(event){event.stop()}.bind(this))}signin.append_gtrack();if(signin.modal_type=="signin"||signin.modal_type=="email_signup"){var gplus_signin_button=$("gplus-signin-button");if(!isIE7()&&!isIE8()&&gplus_signin_button){gplus_signin_button.removeClassName("hidden");gplus_signin_button.observe("click",function(e){signin._gplus_render()})}}};this.set_mode=function(mode,type){try{if(type=="initial"){if(mode=="signup"){$s("#initial_header").update(local.t("Sign up here!"));$s("#initial_fb_text").update(local.t("Sign up with Facebook"))}else{if(mode=="contribution"){$s("#reg_username_tooltip").hide();$s("#reg_site_home").hide();$s("#reg_link").hide();$s("#edit_update").hide();$s("#initial-msg").update(local.t("Thanks for your response."));$s("#initial_header").update(local.t("Just one more step!"));$s("#custom-reg-message").update(local.t("Your response was posted!"));$s("#signup_complete .mid-text").update(local.t("And here's your new BuzzFeed account:"))}else{if(mode=="voting"){$s("#initial-msg").update(local.t("Thanks for your vote."));$s("#initial_header").update(local.t("Just one more step!"));$s("#custom-reg-message").update(local.t("Your vote was submitted!"));$s("#signup_complete .mid-text").update(local.t("And here's your new BuzzFeed account:"))}else{if(mode=="badges"){$s("#initial-msg").update(local.t("Thanks for your reaction."));$s("#initial_header").update(local.t("Just one more step!"));$s("#custom-reg-message").update(local.t("Your reaction was posted!"));$s("#signup_complete .mid-text").update(local.t("And here's your new BuzzFeed account:"))}else{if(mode=="submissions"){$s("#initial-msg").update(local.t("Thanks for your submission."));$s("#initial_header").update(local.t("Just one more step!"));$s("#custom-reg-message").update(local.t("Your photo was submitted!"));$s("#signup_complete .mid-text").update(local.t("And here's your new BuzzFeed account:"))}}}}}}else{if(type=="email_signup"&&$$("#action_msg .text")[0]){if(mode=="contribution"){$s("#action_msg .text").innerHTML=local.t("Click the link to post your comment.")}else{if(mode=="voting"){$s("#action_msg .text").innerHTML=local.t("Click the link to submit your vote.")}else{if(mode=="badges"){$s("#action_msg .text").innerHTML=local.t("Click the link to post your reaction.")}else{if(mode=="submissions"){$s("#action_msg .text").innerHTML=local.t("Click the link to submit your photo.")}}}}}}}catch(e){console.error(e)}};this.login=function(e){signin.clear_errors();signin.spinner();bf_login.login();bf_login.loggedInCallbacks.push(function(){signin.close()})};this.fb_login=function(perms,onFail){facebook.FB_login(perms,onFail);signin.spinner();bf_login.loggedInCallbacks.push(function(){if(!signin.social_register){signin.close()}})};this.reset_password=function(){signin.clear_errors();if($("forgot-password-submit")){$("forgot-password-submit").disabled=true}if(bf_login.already_sent){signin.register_errors("email",local.t("A request has already been sent for this email."))}else{signin.spinner();bf_login.reset_password()}};this.pw_response=function(resp){var obj=resp.responseText.evalJSON();if(obj.error){signin.register_errors("email",obj.error);bf_login.already_sent=false;if($("forgot-password-submit")){$("forgot-password-submit").disabled=false}}else{signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.trouble_signin_resp}))}};this.register=function(e){try{if($("register-button")){$("register-button").disabled=true}signin.clear_errors();signin.spinner();var username="",password="";if(signin.wrap.select("#register-username")[0]){username=signin.wrap.select("#register-username")[0].value}if(signin.wrap.select("#register-password")[0]){password=signin.wrap.select("#register-password")[0].value}if(signin.wrap.select("#register-email")[0]){signin.email=signin.wrap.select("#register-email")[0].value}signin.email_updates=0;var params={username:username,email:signin.email,pw:password,allow_email_updates:signin.email_updates,contribute:1,import_fb_profile:true};if(e.hasClassName("brand_publisher")){params.create_brand_publisher_account=1}if(signin.reg_params){params.params=signin.reg_params}bf_register.new_register(params);bf_register.newRegisterCallbacks.push.apply(bf_register.newRegisterCallbacks,signin.callbacks.onRegister)}catch(err){console.log(err)}};this.register_settings=function(obj){try{if(obj){if(signin.social_register){var user_image=obj.image?BF_STATIC.image_root+obj.image:BF_STATIC.static_root+"/images/public/signin/default_pug.png";signin.fb_edit=0;signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.fb_signup}));signin.set_input_events();if($("reg_email_check")){$("reg_email_check").removeClassName("hidden")}if($("reg_username")){$("reg_username").update(obj.username)}if($("user-image")){$("user-image").src=user_image}if($("reg_link")){var link=obj.username;$("reg_link").update(link);signin.tooltip()}}else{signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.email_signup}));if($("signup_form_wrap")){$("signup_form_wrap").addClassName("hidden")}if($("signup_complete")){$("signup_complete").removeClassName("hidden")}if($("reg_username")){$("reg_username").update(obj.username)}if($("reg_link")){var link="http://buzzfeed.com/"+obj.username;$("reg_link").update(link)}if($("user-image")){$("user-image").src=BF_STATIC.static_root+"/images/public/signin/default_pug.png"}signin.tooltip();signin.pmde.update_daily_email(signin.email)}if(signin.modal_mode){signin.set_mode(signin.modal_mode,signin.modal_type)}}signin.set_signup_buttons()}catch(err){console.error(err)}};this.fb_update=function(e){signin.fb_edit=1;signin.reg_name="";if($("reg_username")){signin.reg_name=$("reg_username").innerHTML;$("reg_username").addClassName("hidden")}if($("reg_link")){$("reg_link").addClassName("hidden")}if($("update_display_name")){$("update_display_name").value=signin.reg_name;$("update_display_name").removeClassName("hidden")}if($("update_user_name")){$("update_user_name").value=signin.reg_name;$("update_user_name").removeClassName("hidden")}if($("edit_update")){$("edit_update").addClassName("hidden")}if($("cancel_update")){$("cancel_update").removeClassName("hidden")}};this.update_user_info=function(is_fb){try{signin.clear_errors();signin.set_input_events();var new_errors=false;var email_signup=$("daily_email_signup").checked;if(is_fb){document.observe("do:reload",function(){this.mailready=false;this.updateready=false;return function(ev){this[ev.memo.what]=true;if(this.mailready&&this.updateready){window.location.reload()}}}())}if(email_signup){signin.email_signup(signin.email)}else{document.fire("do:reload",{what:"mailready"})}if(signin.social_register){var display=$F("update_display_name");var user=$F("update_user_name");if(signin.fb_done||!signin.fb_edit||(display==signin.reg_name&&user==signin.reg_name)){signin.close();document.fire("do:reload",{what:"updateready"})}else{var new_display=$F("update_display_name");var new_user=$F("update_user_name");if(!new_display){signin.register_errors("displayname",local.t("Your display name cannot be blank."));new_errors=true;if($("update_display_name")){$("update_display_name").addClassName("fb_errors")}}if(new_user.length<3||new_user.length>30){signin.register_errors("new_username",local.t("Please enter a username between 3 and 30 characters"));new_errors=true;if($("update_user_name")){$("update_user_name").addClassName("fb_errors")}}if(!new_errors&&!signin.fb_done){var params={};params.action="update_username";if(new_display!=signin.reg_name){params.new_display_name=new_display}if(new_user!=signin.reg_name){params.new_username=new_user}new Ajax.Request("/buzzfeed/_edit_user",{method:"post",parameters:{action:"update_username",new_display_name:new_display,new_username:new_user},onSuccess:function(resp){var obj=eval("("+resp.responseText+")");if(!obj.success){signin.register_errors("new_username",obj.message);if($("update_user_name")){$("update_user_name").addClassName("fb_errors")}}else{if(obj.success){if(obj.session_key){BFW_Util.setCookie({name:BFW_COOKIE,value:obj.session_key})}bf_login.cookieLogin();signin.cancel_fb_update(true,new_user,new_display)}}},onFailure:function(resp){console.log(resp);document.fire("do:reload",{what:"updateready"})}})}}}else{if(!is_fb){signin.close();document.fire("do:reload",{what:"updateready"})}}}catch(e){console.log(e)}};this.cancel_fb_update=function(new_info,new_user,new_display){signin.clear_errors();if(new_info){if($("reg_username")){if(new_display){$("reg_username").update(new_display)}$("reg_username").removeClassName("hidden")}if($("reg_link")){if(new_user){$("reg_link").update(new_user)}$("reg_link").removeClassName("hidden")}if($("cancel_update")){$("cancel_update").remove()}if($("edit_update")){$("edit_update").remove()}if($("update_display_name")){$("update_display_name").addClassName("hidden")}if($("update_user_name")){$("update_user_name").addClassName("hidden")}signin.fb_done=1;setTimeout(signin.close(),1000)}else{if($("reg_username")){$("reg_username").removeClassName("hidden")}if($("reg_link")){$("reg_link").removeClassName("hidden")}if($("update_display_name")){$("update_display_name").addClassName("hidden")}if($("update_user_name")){$("update_user_name").addClassName("hidden")}if($("edit_update")){$("edit_update").removeClassName("hidden")}if($("cancel_update")){$("cancel_update").addClassName("hidden")}}};this.email_signup=function(email,from_test){if(email){if($("daily_email_signup")){$("daily_email_signup").setAttribute("disabled","disabled")}new Ajax.Request("/buzzfeed/_email/",{method:"get",parameters:{email:email,category:"buzzfeed"},onSuccess:function(resp){document.fire("do:reload",{what:"mailready"});if(from_test){signin.email_signup_complete_ui()}},onFailure:function(resp){document.fire("do:reload",{what:"mailready"})}})}else{document.fire("do:reload",{what:"mailready"})}};this.email_signup_complete_ui=function(){if($("daily_email_signup")){$("daily_email_signup").addClassName("hidden")}if($("email-request")){$("email-request").removeClassName("hidden")}};this.set_input_events=function(){$$("input").each(function(el){if(el.hasClassName("bf_dom")){var obj={bucket:"event_handler",element:$(el),data:{}};universal_dom.add_element_to_bucket(obj)}})};this.register_errors=function(type,msg){if(signin.modal_type=="email_signup"||signin.modal_type=="brand_publisher_signup"){if(type.match("duplicate")){type=type.split(" ")[1]}if(msg.match("URL")){msg=msg.replace("URL","username")}if(type=="pw"&&signin.wrap.select("#register-password")[0]){signin.wrap.select("#register-password")[0].addClassName("errors")}else{if(signin.wrap.select("#register-"+type).length){signin.wrap.select("#register-"+type)[0].addClassName("errors")}}}else{if(signin.modal_type=="signin"){if(signin.wrap.select("#login-username")[0]){signin.wrap.select("#login-username")[0].addClassName("errors")}if(signin.wrap.select("#login-password")[0]){signin.wrap.select("#login-password")[0].addClassName("errors")}}else{if(signin.modal_type=="trouble_signin"){if(signin.wrap.select("#login-email")[0]){signin.wrap.select("#login-email")[0].addClassName("errors")}if(msg.match("No user found with email")){msg=msg.replace("No user found with email",local.t("No user found with email"))}}}}var err_el=$("reg_error_"+type);if(err_el){err_el.removeClassName("hidden");err_el.addClassName("errors");err_el.update(msg)}if($("register-button")){$("register-button").disabled=false}if(signin.spin_el){signin.spin_el.remove()}};this.clear_errors=function(){$$(".errors, .fb_errors").each(function(el){if(el.tagName=="INPUT"){if(el.hasClassName("errors")){el.removeClassName("errors")}else{if(el.hasClassName("fb_errors")){el.removeClassName("fb_errors")}}}else{if(el){el.addClassName("hidden");el.removeClassName("errors")}}})};this.spinner=function(){if(signin.wrap.select(".white_popup_spinner_bg").length>0){signin.wrap.select(".white_popup_spinner_bg")[0].show();return}signin.spin_el=new Element("div",{"class":"white_popup_spinner_bg"});signin_spinner=new Element("div",{"class":"loader loader-6"});if(isIE8()||isIE9()){signin_spinner=new Element("img",{"class":"white_popup_spinner"});signin_spinner.src=BF_STATIC.static_root+"/images/public/spinners/big_on_eee.gif"}signin.spin_el.insert(signin_spinner);signin.wrap.insert(signin.spin_el)};this.fb_dialog_cancel=function(){if(signin.spin_el){signin.spin_el.remove()}};this.tooltip=function(){if(local&&local.non_english){return false}if(!signin.social_register){if($("show_tooltip")&&$("tooltip_text")){$("show_tooltip").observe("mouseenter",function(){$("tooltip_text").removeClassName("hidden")});$("msg_wrap").observe("mouseleave",function(){if($("tooltip_text")){$("tooltip_text").addClassName("hidden")}})}if($("default_image_wrap")&&$("user-image_tooltip")){$("default_image_wrap").observe("mouseenter",function(){$("user-image_tooltip").removeClassName("hidden")});$("default_image_wrap").observe("mouseleave",function(){$("user-image_tooltip").addClassName("hidden")})}}else{if(signin.social_register){var tool_els=["user-image","reg_username","reg_site_home","reg_link"];tool_els.each(function(el){if($(el)){$(el).observe("mouseenter",function(){if($(el+"_tooltip")){$(el+"_tooltip").removeClassName("hidden")}});$(el).observe("mouseleave",function(){if($(el+"_tooltip")){$(el+"_tooltip").addClassName("hidden")}})}})}}};this.append_gtrack=function(){signin.wrap.select("*").each(function(el){if(el.hasAttribute("rel:gt_act")){if(el.getAttribute("rel:gt_act").match("sign-in-close")&&signin.modal_type=="signin"){el.setAttribute("rel:gt_act","email-"+el.getAttribute("rel:gt_act")+"-"+signin.page_location)}else{if(el.getAttribute("rel:gt_act").match("sign-in-close")&&signin.modal_type=="email_signup"){el.setAttribute("rel:gt_act","sign-up-close-"+signin.page_location)}else{el.setAttribute("rel:gt_act",el.getAttribute("rel:gt_act")+"-"+signin.page_location)}}}})};this._gplus_render=function(){if(typeof(gapi)!="undefined"&&typeof(gapi.auth)!="undefined"){var additionalParams={clientid:BF_STATIC.google_plus_client_id,redirecturi:"postmessage",accesstype:"offline",cookiepolicy:"single_host_origin",callback:"gplusCallback",apppackagename:"com.buzzfeed.android"};gapi.auth.signIn(additionalParams)}}};var signin=new BF_SignIn();BuzzLoader.register(signin.init,1);signin.pmde={allow_daily_email:false,daily_email:function(a){if(a.checked){this.allow_daily_email=true}else{this.allow_daily_email=false}},update_daily_email:function(a){if(this.allow_daily_email&&a){new Ajax.Request("/buzzfeed/_email/",{method:"get",parameters:{email:a,category:"buzzfeed"},onSuccess:function(b){},onFailure:function(b){}})}},email_signup:function(a){if(a.checked){if(signin.social_register&&!signin.fb_done){a.setAttribute("disabled","disabled");(new BF_Request()).request("/buzzfeed/_edit_user",{method:"post",needsToken:true,parameters:{action:"update_settings",session_key:BFW_Util.getCookie(BFW_COOKIE),allow_email_updates:1,email:signin.email},onSuccess:function(b){},onFailure:function(b){}})}}}};var BFPinterestReferer=function(){this.COOKIE="bf_referer";this.PROMO_INDEX=5;this.pinit_ps={};this.init=function(){var b=readCookie(bf_pinterest_referer.COOKIE);if(b!=null||BF_STATIC.tt_page=="DIY"||BF_STATIC.tt_page=="Food"||BF_STATIC.tt_page=="Style"){bf_pinterest_referer._init()}else{if(BF_STATIC.tt_page=="Buzz"&&BF_STATIC.vertical&&(BF_STATIC.vertical.toLowerCase()=="diy"||BF_STATIC.vertical.toLowerCase()=="food")){bf_pinterest_referer._init()}else{if((document.referrer||"").match(/pinterest.com/)||(location.search||"").match(/\?referer=pinterest.com/)||(document.referrer||"").match(/blog.pinterest.com/)||(location.search||"").match(/\?referer=blog.pinterest.com/)){var a=1/24/2;createCookie(bf_pinterest_referer.COOKIE,"pinterest.com",a);bf_pinterest_referer._init()}}}};this._init=function(){if(typeof universal_dom=="undefined"){setTimeout(bf_pinterest_referer.init,250)}else{bf_pinterest_referer.setup_observers();bf_pinterest_referer.show_pinterest_embed();bf_pinterest_referer.show_more();universal_dom.get_bucket_elements("pinterest_plugin").each(function(c){c.removeClassName("hidden")});if(!bf_pinterest_referer.matchReferer&&$$(".pinterestunit").length){var a=$$(".pinterestunit").first();if(a.hasClassName("hotonpinterest")&&!this.matchReferer){var b=$("permalink_buzz_stats");b.parentNode.insertBefore(a,b)}else{a.addClassName("hidden")}}}};this.setup_observers=function(){universal_dom.assign_handler({bucket:"more-pinterest-promos",event:"click",handler:bf_pinterest_referer.show_more});universal_dom.assign_handler({bucket:"pinit_promo",event:"mouseover",handler:bf_pinterest_referer.show_pinit_link});universal_dom.assign_handler({bucket:"pinit_link",event:"mouseover",handler:bf_pinterest_referer.show_pinit_link});universal_dom.assign_handler({bucket:"pinit_promo",event:"mouseout",handler:bf_pinterest_referer.hide_pinit_link})};this.show_pinit_link=function(a){universal_dom.get_bucket_elements_with_data("pinit_link",{uri:a.uri}).each(function(b){b.removeClassName("hidden")})};this.hide_pinit_link=function(a){universal_dom.get_bucket_elements_with_data("pinit_link",{uri:a.uri}).each(function(b){b.addClassName("hidden")})};this.show_more=function(c){var b=typeof bf_pinterest_referer._revealed=="undefined"?0:bf_pinterest_referer._revealed;var a=(BF_STATIC.tt_page=="DIY"||BF_STATIC.tt_page=="Food")?4:3;if(b==3||b==4){a=12}if(b==12){a=21}bf_pinterest_referer.reveal_promos(a);if(a==21){universal_dom.get_bucket_elements("more-pinterest-promos").each(function(d){d.addClassName("hidden")})}};this.reveal_promos=function(b){bf_pinterest_referer._revealed=b;var d=[],a=bf_pinterest_referer._get_shuffled_promos(),c=function(h){for(var f in a){for(var g=0;g<b&&g<a[f].length;g++){h.call(null,a[f][g])}}};c(function(f){var g;if(f.tagName.toLowerCase()=="div"){f.removeClassName("hidden");return}g=f.select(".pin-button-link");if(g.length){f.removeClassName("hidden");g.first().setAttribute("data-pin-do","buttonPin")}else{f.select(".pin-button a").each(function(h){if(h.getAttribute("data-pin-log")=="button_pinit"){d.push(h)}h.remove()})}});bf_pinterest_referer._loadPinterestScript(function(){if(!d.length){return}c(function(g){var f=g.select(".pin-button");if(!f.length){return}f.first().insert(d.shift())})})};this._get_shuffled_promos=function(){if(typeof bf_pinterest_referer._shuffled_promos=="undefined"){bf_pinterest_referer._shuffled_promos={};var a=["pinterest_promo"];a.each(function(g){var f=universal_dom.get_bucket_elements(g);f=f.slice(0,f.length);for(var d=0;d<f.length;d++){var c=Math.floor(Math.random()*f.length);var b=f[c];f[c]=f[d];f[d]=b}universal_dom.get_bucket_elements_with_data(g,{widget:true}).each(function(h){f.splice(f.indexOf(h),1);f.splice(bf_pinterest_referer.PROMO_INDEX,0,h)});bf_pinterest_referer._shuffled_promos[g]=f;bf_pinterest_referer._reorder_promos_on_page(g)})}return bf_pinterest_referer._shuffled_promos};this._reorder_promos_on_page=function(b){var a=bf_pinterest_referer._get_shuffled_promos();var c=null;var d=function(f){c=f.parentNode;c.update("")};a[b].each(function(f){if(!c){d(f)}c.appendChild(f)});universal_dom.update(c)};this._loadPinterestScript=function(f){if(!BF_STATIC.bf_test_mode){var a,b,c=document;b=c.createElement("SCRIPT");b.type="text/javascript";b.async=true;if(f){$(b).on("load",f)}b.src="//assets.pinterest.com/js/pinit.js";a=c.getElementsByTagName("SCRIPT")[0];a.parentNode.insertBefore(b,a)}else{console.info("disable Dynamically load assets.pinterest.com/js/pinit.js for test mode")}},this.show_pinterest_embed=function(){(function(b){var a=function(g){if(g==16){console.warn("Nothing returned from pinterest")}else{var f=0;var c=bf_pinterest_referer._get_shuffled_promos();for(var d in c){universal_dom.get_bucket_elements_with_data(d,{widget:true}).each(function(h){if(h.getElementsByTagName("SPAN").length>0){f++;try{if(h.next().className.indexOf("hidden")!=-1){h.addClassName("hidden")}}catch(i){console.warn("Error in DOM")}h.removeClassName("hide-buzz_holder")}})}if(f<2){setTimeout(function(){a(++g)},250)}}};a(0)}(document))}};bf_pinterest_referer=new BFPinterestReferer();BF_DID_REGISTER=false;BF_Register=function(){this.highlight_field=new Array();this.ajax=new BF_Request();this.ERR_MISSING_PARAMS="Please complete all fields.";this.ERR_BAD_USERNAME="Your username may only contain letters and numbers.";this.ERR_USERNAME_LENGTH="Your username must be between 3 and 30 characters in length.";this.ERR_PW_LENGTH="Your password must be at least 6 characters in length.";this.ERR_MUST_AGGEE=local.t("You must agree to the Terms of Service in order to register.");this.ERR_PW_MUST_MATCH="Your passwords do not match.";this.ERR_DUP_USERNAME="Sorry, that username is not available. Please try another.";this.ERR_DUP_SITENAME="Sorry, that domain name is not available. Please try another.";this.ERR_BAD_INVITE="Sorry, the invite code you entered is not valid.";this.ERR_DUP_EMAIL="There is already an account with that email address.";this.ERR_FB_DUP_EMAIL="The email address that belongs to your Facebook account has already been used by another BuzzFeed account.";this.BANNED_FB_UID=local.t("You cannot register with that Facebook user.");this.ERR_BAD_EMAIL="You have entered an invalid email address.";this.ERR_NO_ALIASES="Sorry, you don't have enough site aliases left to create a tracked site.";this.ERR=local.t("Sorry, we are unable to process your request at this time.");this.ERR_ALREADY_REGISTERED="You have already registered for an account";this.highlight_field[this.ERR_BAD_USERNAME]="register-username";this.highlight_field[this.ERR_USERNAME_LENGTH]="register-username";this.highlight_field[this.ERR_PW_LENGTH]="register-pw1";this.highlight_field[this.ERR_PW_MUST_MATCH]="register-pw2";this.highlight_field[this.ERR_MUST_AGGEE]="register-agree";this.highlight_field[this.ERR_DUP_USERNAME]="register-username";this.highlight_field[this.ERR_DUP_EMAIL]="bfe";this.highlight_field[this.ERR_BAD_EMAIL]="bfe";this.SUCCESS1="Thanks for registering. We've created your account and saved your post, but before we post it we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.<br /><br />Your post will appear automatically once you validate.";this.SUCCESS1_VALIDATED=local.t("Thanks for registering. We've validated your email address with Facebook, created your account and saved your post. ");this.SUCCESS2="Thanks for registering. We've created your account, but before you can vote we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.";this.SUCCESS2_VALIDATED=local.t("Thanks for registering. We've validated your email address with Facebook and created your account. You now can vote.");this.SUCCESS3="<h3>Please Validate Your Email</h3><p>Thanks for registering. We've created your account, but before you can log in we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.</p>";this.SUCCESS3_VALIDATED="<h3>Your Email Has Been Validated</h3><p>"+local.t("Thanks for registering. We've created your account and validated your email address with Facebook. Some of your profile data has been prepopulated with information from your Facebook profile. You can log in now.")+"</p>";this.SUCCESS4="Thanks for registering. We've created your account, but before you can post we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.<br/><br/>Once you validate <a id='register_this_page_url' href=''>click here</a> to make a post.";this.SUCCESS4_VALIDATED="Thanks for registering. We've created your account and validated your email address with Facebook.";this.fb_link_handler=function(){var handler=function(event){event.stop();$("facebook-login").hide();$("facebook-registration-form").hide();bf_login.switch_to_link_accounts()}.bind(this);if($("fb-link-submit")){$("fb-link-submit").observe("click",handler)}if($("fb-link-submit2")){$("fb-link-submit2").observe("click",handler)}};this.fb_register_handler=function(reset_form,args){if(BF_Register.registered_fb_handler){return}BF_Register.registered_fb_handler=true;this.fb_link_handler();if(typeof reset_form=="undefined"){reset_form=true}if(args){this.args=args}var handler=function(event){event.stop();this.facebook_register()}.bind(this);if($("facebook-registration-form")){$("facebook-registration-form").stopObserving("submit",handler)}if($("facebook-registration-form")){$("facebook-registration-form").observe("submit",handler)}if($("fb-register-submig")){$("fb-register-submit").disabled=false}if(reset_form&&$("facebook-registration-form")){$("facebook-registration-form").reset()}};this.alias_register_handler=function(reset_form,args){if(BF_Register.alias_registered_handler){return}BF_Register.alias_registered_handler=true;if(typeof reset_form=="undefined"){reset_form=true}if(args){this.args=args}var handler=function(event){event.stop();this.alias_register()}.bind(this);BF_UserSwitcher.count_aliases(function(obj){var user_info=new BF_User().getUserInfo();var remaining=parseInt(user_info.max_aliases)-parseInt(obj.count);if($("self-serve-form")){if(remaining<=0&&user_info.max_aliases!=0){$("registration-form-tabs").hide();$("self-serve-form").hide();$("self-max-alias").show()}}if($("alias-sites-left")&&obj.success){$("alias-sites-left").update(remaining);if(remaining==1){$("alias-sites-left-plural").hide()}if(obj.unlimited==1){$("alias-count-message").hide()}else{$("alias-count-message").show()}if(remaining<=0&&user_info.max_aliases!=0){$("alias-registration-fieldset").hide();$("alias-registration-hit-limit").show()}}});if($("alias-registration-form")){$("alias-registration-form").stopObserving("submit",handler)}if($("alias-registration-form")){$("alias-registration-form").observe("submit",handler)}if($("alias-registration-form")){$("alias-register-submit").disabled=false}if(reset_form&&$("alias-registration-form")){$("alias-registration-form").reset()}};this.admin_register_handler=function(reset_form,args){var user=new BF_User();if(user.isLoggedIn()){var user_info=user.getUserInfo();if(!acl.user_can("partners_manage")){return}$("admin_options").show()}};this.register_handler=function(reset_form,args){if(BF_Register.registered_handler){return}BF_Register.registered_handler=true;if(typeof(reset_form)=="undefined"){reset_form=true}if(args){this.args=args}var handler=function(event){event.stop();this.register()}.bind(this);if($("regsitration-form")){$("regsitration-form").stopObserving("submit",handler)}if($("regsitration-form")){$("regsitration-form").observe("submit",handler)}if($("register-submit")){$("register-submit").disbaled=false}if(reset_form&&$("regsitration-form")){$("regsitration-form").reset()}this.self_serve_handler()};this.register_tab_handler=function(){return;var handler=function(e){if(e.element().id=="self-serve-tab"){$("registration-div").hide();$("self-serve-div").show()}if(e.element().id=="create-your-feed-tab"){$("self-serve-div").hide();$("registration-div").show()}if(e.element().id=="create-new-feed-tab"){$("self-serve-div").hide();$("registration-div").show()}};if($("create-your-feed-tab")){$("create-your-feed-tab").observe("click",handler)}if($("create-new-feed-tab")){$("create-new-feed-tab").observe("click",handler)}if($("self-serve-tab")){$("self-serve-tab").observe("click",handler)}};this.self_serve_handler=function(){var handler=function(e){var domain=$F("self-serve-your-domain").strip();if(domain=="yoursite.com"){domain=""}var code=$("self-serve-invite-code")?$F("self-serve-invite-code").strip():"";if(code=="invite code"){code=""}err_mess="";if(!domain||(!code&&SS_INVITE_NEEDED==true)){err_mess="Please complete all fields."}if(domain!=""&&!domain.match(/^[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/)){err_mess="Please enter a domain for your site (example.com)."}if($F("self-serve-standalone")&&!$F("self-serve-email")){err_mess="You must enter an email address for a seperate account!"}if(err_mess){if(Prototype.Browser.IE){$("self-serve-error-message").innerText=err_mess}else{$("self-serve-error-message").update(err_mess)}$("self-serve-error-message").addClassName("error").show();$("self-serve-error-message").show()}else{var user=new BF_User();if(user.isLoggedIn()){var user_info=user.getUserInfo();default_session=user_info.default_user.session_key;var userid=user_info.userid;$("self-serve-buttons").hide();$("submit-self-serve-spinner").show();$("self-serve-error-message").hide();var save_params={action:"create_site",mycode:code,default_session:default_session,mydomain:domain};if($F("self-serve-standalone")){save_params.standalone_user=1;if($F("self-serve-email")){save_params.email=$F("self-serve-email")}if($F("self-serve-send-email")){save_params.send_email=1}}(new BF_Request()).request("/buzzfeed/_self_serve_tracking",{method:"get",parameters:save_params,onSuccess:function(r){var obj=eval("("+r.responseText+")");if(obj&&obj.success==1){var redir=BF_STATIC.web_root+"/sites/"+obj.status.self_serve_user.username;document.location.href=redir}else{$("self-serve-buttons").show();$("submit-self-serve-spinner").hide();err_mess="Unable to process your request";if(obj.message){if(obj.message=="bad invite code"){err_mess=this.ERR_BAD_INVITE}else{if(obj.message=="duplicate site name"){err_mess=this.ERR_DUP_SITENAME}else{if(obj.message=="no user aliases left"){err_mess=this.ERR_NO_ALIASES}else{if(obj.message=="Cannot validate account with Facebook"){err_mess="Cannot validate your Facebook account; please grant extended permissions or register without your Facebook account"}else{err_mess=local.t("Unable to process your request")}}}}}if(Prototype.Browser.IE){$("self-serve-error-message").innerText=err_mess}else{$("self-serve-error-message").update(err_mess)}$("self-serve-error-message").addClassName("error");$("self-serve-error-message").show()}}.bind(this),onFailure:function(r){$("self-serve-buttons").show();$("submit-self-serve-spinner").hide();if(Prototype.Browser.IE){$("self-serve-error-message").innerText="Unable to process your request"}else{$("self-serve-error-message").update("Unable to process your request")}$("self-serve-error-message").addClassName("error");$("self-serve-error-message").show()}.bind(this)})}else{this.args={onRegister:function(obj){if($("registration-form-tabs")){$("self-serve-registration-div").hide()}if($("self-serve-registration-div")){$("self-serve-registration-div").hide()}if($("self-serve-form")){$("self-serve-form").hide()}if($("registration-success-message")){$("registration-success-message").show()}}};$("self-serve-buttons").hide();$("self-serve-registration-div").show();if($("register-submit")){$("register-submit").disbaled=false}}}}.bind(this);bf_register.self_serve_submit_handler=handler;if($("self-serve-form")){$("self-serve-form").observe("submit",handler)}};this.facebook_register=function(){var name=$F("fb-register-name").strip();var email="get_from_facebook@buzzfeed.com";try{email=facebook.user_data.email}catch(e){}var username=$F("fb-register-username").strip();var pw1=$F("fb-register-pw1").strip();var agreed=true;var emailme=0;var import_fb_profile=$("import_fb_profile_checkbox").checked?"true":"false";if(import_fb_profile=="false"){name=username}var facebook_uid=$("fb-facebook-uid")?$("fb-facebook-uid").value:"";this.username=username;this.password=pw1;if($("fb-email-me").checked){emailme=1}var rr=function(resp){this.response(resp)}.bindAsEventListener(this);var er=function(resp){this.err(resp)}.bindAsEventListener(this);var params={name:name,username:username,pw:pw1,email:email,contribute:1,allow_email_updates:emailme,facebook_uid:facebook_uid,import_fb_profile:import_fb_profile,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent};new Ajax.Request("/buzzfeed/_contribute_register",{method:"post",parameters:params,onSuccess:rr,onFailure:er})};this.alias_register=function(){var username=$("alias-register-username").value.strip();if(!username.match(/^[a-zA-Z0-9]+$/)){this._alias_register({success:0,message:"Site URL must consist of only alphanumeric characters"});return}var display_name=$("alias-register-display_name").value;if($("alias-registering-status")){$("alias-registering-status").show()}if(!username||!display_name){this._alias_register({success:0,message:"missing username"})}else{BF_UserSwitcher.create_alias({username:username,display_name:display_name},this._alias_register)}};this._alias_register=function(obj){if(obj.success==0||obj.status!=200){$("alias-message").show();if(obj.message.match(/missing username/i)){$("alias-message").update("please fill out all fields")}else{if(obj.message.match(/logged in/i)){$("alias-message").update("please log in and try again")}else{if(obj.message.match(/privileges/i)){$("alias-message").update("you don't have permission to create an alias")}else{if(obj.message.match(/limit/i)){$("alias-message").update("Sorry, but you are over your alias limit")}else{if(obj.message.match(/username/i)){$("alias-message").update("this site URL already is taken, please select another")}else{$("alias-message").update(obj.message)}}}}}}else{if($("alias-registration-fieldset")){$("alias-registration-fieldset").hide()}if($("alias-registration-creating-site")){$("alias-registration-creating-site").show()}BF_UserSwitcher.switchTo(obj.userid,function(){})}if($("alias-registering-status")){$("alias-registering-status").hide()}};this.register=function(){if($("registering-status")){$("registering-status").show()}var self_serve_domain="";var self_serve_invite_code="";if($("self-serve-div")&&$("self-serve-div").getStyle("display")!="none"){self_serve_domain=$F("self-serve-your-domain").strip();self_serve_invite_code=$("self-serve-invite-code")?$F("self-serve-invite-code").strip():""}if(typeof this.args=="undefined"){this.args={action:"vote"}}var name=$F("register-name").strip();var email=$F("bfe").strip();var username=$F("register-username").strip();var pw1=$F("register-pw1").strip();var pw2=$F("register-pw2").strip();var agreed=false;var emailme="";var facebook_location="";var facebook_uid="";var facebook_url="";var import_fb_profile=false;if(BF_STATIC.facebook_enabled){facebook_uid=$("facebook-uid")?$("facebook-uid").value:"";import_fb_profile=$("import_fb_profile_checkbox").checked}if($("register-agree").checked){agreed=true}if($("email-me").checked){emailme=1}var is_error=true;if(!name||!email||!username||!pw1||!pw2){this.update_registration_message(this.ERR_MISSING_PARAMS)}else{if(!username.match(/^[a-zA-Z0-9]+$/)){this.update_registration_message(this.ERR_BAD_USERNAME)}else{if(username.length<3||username.length>30){this.update_registration_message(this.ERR_USERNAME_LENGTH)}else{if(pw1!=pw2){this.update_registration_message(this.ERR_PW_MUST_MATCH)}else{if(!agreed){this.update_registration_message(this.ERR_MUST_AGGEE)}else{if(typeof pw1=="undefined"||pw1.length<6){this.update_registration_message(this.ERR_PW_LENGTH)}else{if(typeof email=="undefined"||!email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){this.update_registration_message(this.ERR_BAD_EMAIL)}else{if(self_serve_domain=="yoursite.com"||self_serve_invite_code=="invite code"){this.update_registration_message("Please enter your site's domain.")}else{if(self_serve_domain!=""&&!self_serve_domain.match(/\w\.\w/)){this.update_registration_message("Please enter a valid domain for site (example.com).")}else{is_error=false;this.username=username;this.password=pw1;var rr=function(resp){this.response(resp)}.bindAsEventListener(this);var er=function(resp){this.err(resp)}.bindAsEventListener(this);$("register-submit").disbaled=true;if($("self-serve-div")&&$("self-serve-div").getStyle("display")!="none"){var params={self_serve_username:self_serve_domain,self_serve_invite:self_serve_invite_code,name:name,username:username,pw:pw1,email:email,contribute:1,allow_email_updates:emailme,facebook_uid:facebook_uid,location:facebook_location,link:facebook_url,import_fb_profile:import_fb_profile,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent}}else{var params={name:name,username:username,pw:pw1,email:email,contribute:1,allow_email_updates:emailme,facebook_uid:facebook_uid,location:facebook_location,link:facebook_url,import_fb_profile:import_fb_profile,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent}}new Ajax.Request("/buzzfeed/_contribute_register",{method:"post",parameters:params,onSuccess:rr,onFailure:er})}}}}}}}}}if(is_error){if($("register-submit")){$("register-submit").disabled=false}$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").addClassName("error");$("registration-message").show();$("registering-status").hide()}};this.update_registration_message=function(msg){if(Prototype.Browser.IE){$("registration-message").innerText=msg;$("facebook-registration-message").innerText=msg}else{$("registration-message").update(msg);$("facebook-registration-message").update(msg)}if(this.__error_field){this.__error_field.style.border="1px solid gray";this.__error_field=null}if(this.highlight_field[msg]&&$(this.highlight_field[msg])){$(this.highlight_field[msg]).style.border="1px solid red";this.__error_field=$(this.highlight_field[msg])}};this.response=function(resp){var username=this.username;var password=this.password;$("registering-status").hide();try{$("register-submit").disbaled=false;obj=eval("("+resp.responseText+")");if(!obj||!obj.status){this.err()}else{if(obj.status=="success"){__reg_ok=true;BF_DID_REGISTER=true;$("regsitration-form").reset();if(this.args&&this.args.action=="vote"&&vote_manager.contribution_id){if($("contribute-success")){$("contribute-success").hide()}var reg_success_div=$("registered-success").remove();$("registration-div").hide();var div=document.createElement("div");div.appendChild(reg_success_div);$($("registration-div").parentNode).appendChild(div);$("registered-success").show();$("registered-success").style.marginTop="10px";var show_message=this.SUCCESS2;if(obj.user_validated){show_message=this.SUCCESS2_VALIDATED;if($("please-validate-your-email")){$("please-validate-your-email").update("We Have Validated Your Email")}}$("reg-success-message").update(show_message);if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_vote")}}else{if(this.args&&this.args.action=="signin"){if($("contribute-success")){$("contribute-success").hide()}if($("registered-success")){$("registered-success").show()}if($("registration-div")){$("registration-div").hide()}if($("reg-success-message")){var show_message=this.SUCCESS3;if(obj.user_validated){show_message=this.SUCCESS3_VALIDATED}$("reg-success-message").update(show_message);$("reg-success-message").show();if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_signin")}if(obj.user_validated){var params={username:username,password:password,contribute:1};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:params,onSuccess:function(r){bf_login.loggedIn(r);if(window.location.href.indexOf("/signin")!=-1){window.location.href="/"+username}},onFailure:bf_login.err})}}}else{if(this.args&&this.args.action=="badge_vote"){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_badge_vote")}if(badge_vote_manager&&badge_vote_manager.onRegister){badge_vote_manager.onRegister()}else{if($("registered-vote-success")){$("registered-vote-success").show()}if($("registration-div")){$("registration-div").hide()}}}else{if(this.args&&this.args.action=="contest_entry"){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_contest_entry")}if(typeof contest_manager!="undefined"&&contest_manager.onLogin){contest_manager.onLogin()}}else{if(this.args&&this.args.action=="micosite_submission"){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_microsite")}if(typeof picks_controller!="undefined"&&picks_controller.onLogin){picks_controller.onLogin()}}else{if(this.args&&this.args.onRegister){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}this.args.onRegister(obj)}else{if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}if($("contribute-success")){$("contribute-success").hide()}if($("registered-success")){$("registered-success").show()}if($("registration-div")){$("registration-div").hide()}if(bf_contribute&&bf_contribute.type=="image"){var show_message=this.SUCCESS4;if(obj.user_validated){show_message=this.SUCCESS4_VALIDATED}if($("reg-success-message")){$("reg-success-message").update(show_message)}}else{var show_message=this.SUCCESS1;if(obj.user_validated){show_message=this.SUCCESS1_VALIDATED;if($("please-validate-your-email")){$("please-validate-your-email").update("We Have Validated Your Email")}var params={username:username,password:password,contribute:1};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:params,onSuccess:function(r){bf_login.loggedIn(r,this.args);if(window.location.href.indexOf("/signin")!=-1){window.location.href="/"+username}},onFailure:bf_login.err})}if($("reg-success-message")){$("reg-success-message").update(show_message)}}bf_contribute.submit({session_key:obj.session_key})}}}}}}if($("register_this_page_url")){var rurl=document.location.href;rurl=rurl.replace(/#.*/,"");$("register_this_page_url").href=rurl}}else{var some_error=true;if(obj.message=="bad beta key"){this.update_registration_message(this.ERR_BETA_KEY)}else{if(obj.message=="duplicate username"){this.update_registration_message(this.ERR_DUP_USERNAME)}else{if(obj.message=="duplicate site name"){this.update_registration_message(this.ERR_DUP_SITENAME)}else{if(obj.message=="Your invite code is not valid."){this.update_registration_message(this.ERR_BAD_INVITE)}else{if(obj.message=="duplicate email"){if(facebook.is_logged_in()){this.update_registration_message(this.BANNED_FB_UID)}else{this.update_registration_message(this.ERR_DUP_EMAIL)}}else{this.err();some_error=false}}}}}if(some_error){if($("register-submit")){$("register-submit").disabled=false}$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").addClassName("error");$("registration-message").show()}}}}catch(e){console.dir({e:e});this.err()}};this.err=function(resp){$("register-submit").disabled=false;$("facebook-registration-message").update(this.ERR);$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").update(this.ERR);$("registration-message").addClassName("error");$("registration-message").show();$("registering-status").hide()};this.redirect_to=function(url){window.location.href=BF_STATIC.web_root+"/"+url};this.form_values=function(obj){if(typeof obj.pw=="undefined"){if($("register-password").value!=$("register-password").getAttribute("defaultvalue")){obj.pw=$("register-password").value}}if(typeof obj.username=="undefined"){if(bf_register.signup_page()){if($(signup_page.currentNameBox()).value!=$(signup_page.currentNameBox()).getAttribute("defaultvalue")){obj.name=obj.username=$(signup_page.currentNameBox()).value}}else{obj.name=obj.username=$("register-uri-text").value}}if(typeof obj.email=="undefined"){if($("register-email").value!=$("register-email").getAttribute("defaultvalue")){obj.email=$("register-email").value}}return obj};this.create_advertiser_account=function(data){if(!acl.user_can("partners_manage")){return}var errors=[];var obj={create_advertiser_account:1,pw:data.pw||"",pw2:data.pw||"",name:data.name||data.username||"",username:data.username||"",email:data.email||"",contribute:1};var missingEmail=false;var strip=new Array("email","username","pw");var titles={email:"email",username:"username",pw:"password"};strip.each(function(el){if(typeof obj[el]!="undefined"&&typeof obj[el].strip!="undefined"){obj[el]=obj[el].strip()}if(typeof obj[el]=="undefined"||obj[el]==""){errors.push("Missing "+titles[el]);if(el=="email"){missingEmail=true}}});if(!missingEmail&&!data.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){errors.push(local.t("Please enter a valid email address"));if($("register-email")){$("register-email").style.border="1px solid red";$("register-email").observe("blur",function(){$("register-email").style.border="1px solid #D9D9D9"})}}var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};if(errors.length){return error(errors.join(", "))}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:obj,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(r){var json=eval("("+r.responseText+")");bf_register._new_register(obj,json)}})};this.create_contributor_account=function(data){if(!acl.user_can("editors_manage")){return}var errors=[];var obj={create_contributor_account:1,pw:data.pw||"",pw2:data.pw||"",name:data.name||data.username||"",username:data.username||"",email:data.email||"",contribute:1};var missingEmail=false;var strip=new Array("email","username","pw");var titles={email:"email",username:"username",pw:"password"};strip.each(function(el){if(typeof obj[el]!="undefined"&&typeof obj[el].strip!="undefined"){obj[el]=obj[el].strip()}if(typeof obj[el]=="undefined"||obj[el]==""){errors.push("Missing "+titles[el]);if(el=="email"){missingEmail=true}}});if(!missingEmail&&!data.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){errors.push("Please enter a valid email address");if($("register-email")){$("register-email").style.border="1px solid red";$("register-email").observe("blur",function(){$("register-email").style.border="1px solid #D9D9D9"})}}var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};if(errors.length){return error(errors.join(", "))}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:obj,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(r){var json=eval("("+r.responseText+")");bf_register._new_register(obj,json)}})};this.newRegisterCallbacks=[];this.new_register=function(obj){if(obj.create_advertiser_account){return bf_register.create_advertiser_account(obj)}if(obj.create_contributor_account){return bf_register.create_contributor_account(obj)}if(typeof obj.pw2=="undefined"){obj.pw2=obj.pw}if(typeof obj.name=="undefined"){obj.name=obj.username}var errors=false;var required={username:local.t("Please enter a username."),email:local.t("Please enter a valid email address"),pw:local.t("Please enter a password")};var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};obj=this.form_values(obj);var strip=new Array("name","email","username","pw");strip.each(function(el){if(typeof obj[el]!="undefined"){obj[el]=obj[el].strip()}});if(obj.username=="username"){obj.username=""}for(var each in required){if(typeof obj[each]=="undefined"||obj[each]==""){error(required[each]);if(signin.signin_page){signin.register_errors(each,required[each])}break}}if(obj.username=="url"){obj.username=""}if(obj.pw=="password"){obj.pw=""}if(obj.email=="your@email.com"){obj.email=""}if(!errors&&!obj.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){error("Please enter a valid email address");if(signin.signin_page){signin.register_errors("email",local.t("Please enter a valid email address"))}}if(!errors&&(obj.username.length<3||obj.username.length>30)){error("Please enter a URL between 3 and 30 characters");if(signin.signin_page){signin.register_errors("username","Please enter a URL between 3 and 30 characters")}}if(!errors&&obj.pw.length<6){error("Your password must have at least 6 characters");if(signin.signin_page){signin.register_errors("pw"," Your password must have at least 6 characters")}}if(!errors){if(document.location.search.indexOf("registered_from=")){var search=document.location.search.substring(1);var kvpairs=search.split("&");kvpairs.each(function(kvpair){var kv=kvpair.split("=");if(kv[0]=="registered_from"){obj.registered_from_url=kv[1]}})}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:obj,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(r){var json=eval("("+r.responseText+")");bf_register._new_register(obj,json)}})}};this._new_register=function(obj,json){if(json.status=="failed"){bf_register._error(json)}else{bf_register._success(obj,json)}};this._error=function(json){var messages={"duplicate email":bf_register.ERR_DUP_EMAIL,"duplicate username":bf_register.ERR_DUP_USERNAME};if(signin.signin_page){signin.register_errors(json.message,messages[json.message])}if($("registration-success-message")){old_msg.hide()}var msg=bf_register.currentErrorBox();if(bf_register.signup_page()){signup_page.toggleSpinner(0)}if(msg){var match;if(match=json.message.match(/^(.*) at lib/)){json.message=match[1]}msg.update(messages[json.message]||json.message);msg.show()}};this._success=function(obj,json){if(bf_register.currentErrorBox()){bf_register.currentErrorBox().hide()}if(signin.signin_page){signin.register_settings(obj)}json.user_validated=json.user_validated==true||json.user_validated=="true";if(json.user_validated){var params={username:obj.username,password:obj.pw,contribute:1};bf_register.dont_switch=json.dont_switch||0;bf_register.ajax.request("/buzzfeed/_www_login",{method:"post",parameters:params,while_processing:{show:"logging-in",hide:"new-registration-form"},onSuccess:function(r){if(bf_register.dont_switch){var o=eval("("+r.responseText+")");bf_register.redirect_to("settings/"+o.username)}else{if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}if(signin.social_register){bf_login.loggedIn(r,{no_reload:true})}else{bf_login.loggedIn(r);bf_register.redirect_to("settings?firstTime=true")}}}})}else{if(bf_register.signup_page()){signup_page.toggleSpinner(0);signup_page.openDialog("old")}if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}var form=$("new-registration-form");var msg=$("registration-success-message");if(form){form.hide()}if(msg){msg.show()}}if(this.newRegisterCallbacks.length){this.newRegisterCallbacks.each(function(fn){fn(obj,json)})}};this.register_alias=function(obj){var errors=false;var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};if(!obj.username||obj.username.length<3||obj.username.length>30){if(bf_register.signup_page()){error("Please enter a username between 3 and 30 characters")}else{error("Please enter a URL between 3 and 30 characters")}}if(!errors){if(bf_register.signup_page()){signup_page.toggleSpinner(1)}BF_UserSwitcher.create_alias({username:obj.username,display_name:typeof obj.name=="undefined"?obj.username:obj.name},bf_register._register_alias)}};this._register_alias=function(obj){if(obj.success==0||obj.status!=200){bf_register._error({message:obj.message||"Unable to create an alias at this time"})}else{BF_UserSwitcher.switchTo(obj.userid,function(){if(!signin.social_register){bf_register.redirect_to("settings?firstTime=true")}})}};this.signup_page=function(){return BF_STATIC.tt_page=="Signup"?true:false};this.currentErrorBox=function(){return bf_register.signup_page()?$(signup_page.currentErrorBox()):$("registration-error-message")}};var bf_audio=function(){this.player=function(a){if(typeof a=="undefined"){return false}if(!document.getElementById("turntable")){this.createPlayer()}if(isIE7()||isIE8()){AudioPlayer.setup(BF_STATIC.static_root+"/flash/player.swf",{width:1,height:1,initialvolume:100});this.flashPlayer(this.getAudioPath(a))}else{this.html5Player(this.getAudioPath(a))}};this.createPlayer=function(){var a=document.createElement("div");a.setAttribute("id","turntable");document.body.appendChild(a)};this.flashPlayer=function(a){if(BF_STATIC.bf_env!="live"){console.log("Playing w/Flash: "+a)}var b=document.getElementById("turntable");b.insert('<p id="player_1"></p>');AudioPlayer.embed("player_1",{soundFile:a,autostart:"yes"})};this.html5Player=function(a){if(BF_STATIC.bf_env!="live"){console.log("Playing w/HTML5: "+a)}var c=document.getElementById("turntable");var b=document.createElement("audio");b.setAttribute("id","needle");b.setAttribute("src",a);c.appendChild(b);b.play()};this.getAudioPath=function(a){var c="";var d=a.split(".");for(var b=0;b<(d.length-1);b++){c+=d[b]+"."}c=BF_STATIC.static_root+c;if(Prototype.Browser.Gecko){a=c+"ogg"}else{a=c+"mp3"}return a}};var BFAudio=new bf_audio();if(!window.AJAX_TEST_STATUS){window.AJAX_TEST_STATUS={}}var qq=qq||{};qq.extend=function(b,a){for(var c in a){b[c]=a[c]}};qq.indexOf=function(b,c,d){if(b.indexOf){return b.indexOf(c,d)}d=d||0;var a=b.length;if(d<0){d+=a}for(;d<a;d++){if(d in b&&b[d]===c){return d}}return -1};qq.getUniqueId=(function(){var a=0;return function(){return a++}})();qq.attach=function(a,c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}};qq.detach=function(a,c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.insertBefore=function(d,c){c.parentNode.insertBefore(d,c)};qq.remove=function(a){a.parentNode.removeChild(a)};qq.contains=function(b,a){if(b==a){return true}if(b.contains){return b.contains(a)}else{return !!(a.compareDocumentPosition(b)&8)}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}})();qq.css=function(a,b){if(b.opacity!=null){if(typeof a.style.opacity!="string"&&typeof(a.filters)!="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b)};qq.hasClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");return c.test(b.className)};qq.addClass=function(b,a){if(!qq.hasClass(b,a)){b.className+=" "+a}};qq.removeClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");b.className=b.className.replace(c," ").replace(/^\s+|\s+$/g,"")};qq.setText=function(a,b){a.innerText=b;a.textContent=b};qq.children=function(b){var a=[],c=b.firstChild;while(c){if(c.nodeType==1){a.push(c)}c=c.nextSibling}return a};qq.getByClass=function(d,f){if(d.querySelectorAll){return d.querySelectorAll("."+f)}var b=[];var g=d.getElementsByTagName("*");var a=g.length;for(var c=0;c<a;c++){if(qq.hasClass(g[c],f)){b.push(g[c])}}return b};qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.obj2url=function(g,b,j){var h=[],d="&",f=function(l,k){var m=b?(/\[\]$/.test(b))?b:b+"["+k+"]":k;if((m!="undefined")&&(k!="undefined")){h.push((typeof l==="object")?qq.obj2url(l,m,true):(Object.prototype.toString.call(l)==="[object Function]")?encodeURIComponent(m)+"="+encodeURIComponent(l()):encodeURIComponent(m)+"="+encodeURIComponent(l))}};if(!j&&b){d=(/\?/.test(b))?(/\?$/.test(b))?"":"&":"?";h.push(b);h.push(qq.obj2url(g))}else{if((Object.prototype.toString.call(g)==="[object Array]")&&(typeof g!="undefined")){for(var c=0,a=g.length;c<a;++c){f(g[c],c)}}else{if((typeof g!="undefined")&&(g!==null)&&(typeof g==="object")){for(var c in g){f(g[c],c)}}else{h.push(encodeURIComponent(b)+"="+encodeURIComponent(g))}}}return h.join(d).replace(/^&/,"").replace(/%20/g,"+")};qq.isObject=function(a){return a!==null&&a&&typeof(a)==="object"&&a.constructor===Object};qq.isFunction=function(a){return typeof(a)==="function"};qq.each=function(c,d){var a,b;if(c){for(a in c){if(Object.prototype.hasOwnProperty.call(c,a)){b=d(a,c[a]);if(b===false){break}}}}};qq.obj2FormData=function(c,b,a){if(!b){b=new FormData()}qq.each(c,function(d,f){d=a?a+"["+d+"]":d;if(qq.isObject(f)){qq.obj2FormData(f,b,d)}else{if(qq.isFunction(f)){b.append(d,f())}else{b.append(d,f)}}});return b};qq.obj2Inputs=function(c,b){var a;if(!b){b=document.createElement("form")}qq.obj2FormData(c,{append:function(d,f){a=document.createElement("input");a.setAttribute("name",d);a.setAttribute("value",f);b.appendChild(a)}});return b};var qq=qq||{};qq.FileUploaderBasic=function(b){var a=this;this._options={debug:false,action:"/server/upload",params:{},button:null,multiple:true,maxConnections:3,autoUpload:true,sendAsForm:false,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(d,c){},onProgress:function(g,f,c,d){},onComplete:function(f,d,c){},onCancel:function(d,c){},onValidate:function(c,f,d){},onError:function(f,d,c){},urlHandler:false,messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled.",noFiles:"Only files on your computer can be uploaded."},showMessage:function(c){alert(c)}};qq.extend(this._options,b);this._filesInProgress=0;this._storedFiles=[];this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FileUploaderBasic.prototype={setParams:function(a){this._options.params=a},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){for(var a=0;a<this._storedFiles.length;a++){var b=this._getItemByFileId(this._storedFiles[a]);this._find(b,"spinner").style.display="";this._filesInProgress++;this._handler.upload(this._storedFiles[a],this._options.params)}},clearStoredFiles:function(){this._storedFiles=[];this._options.listElement.innerHTML=""},_createUploadButton:function(b){var a=this;return new qq.UploadButton({element:b,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(c){a._onInputChange(c);a._createUploadButton(b)}})},_createUploadHandler:function(){var a=this,c;if(qq.UploadHandlerXhr.isSupported()){c="UploadHandlerXhr"}else{c="UploadHandlerForm"}var b=new qq[c]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(h,g,d,f){a._onProgress(h,g,d,f);a._options.onProgress(h,g,d,f)},onComplete:function(g,f,d){a._onComplete(g,f,d);a._options.onComplete(g,f,d)},onCancel:function(f,d){a._onCancel(f,d);a._options.onCancel(f,d)}});return b},_preventLeaveInProgress:function(){var a=this;qq.attach(window,"beforeunload",function(b){if(!a._filesInProgress){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(b,a){this._filesInProgress++},_onProgress:function(d,c,a,b){},_onComplete:function(c,b,a){this._filesInProgress--;if(a.error){this._options.showMessage(a.error)}},_onCancel:function(b,a){this._filesInProgress--},_onInputChange:function(a){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(a.files)}else{if(this._validateFile(a)){this._uploadFile(a)}}this._button.reset()},_uploadFileList:function(d){var c,b;c=this._getValidationDescriptors(d);if(c.length>1){b=this._options.onValidate(c,true)===false}if(!b){if(typeof d=="undefined"||d.length<1){this._error("noFiles","empty");return false}for(var a=0;a<d.length;a++){if(!this._validateFile(d[a])){return}}for(var a=0;a<d.length;a++){this._uploadFile(d[a])}}},_uploadFile:function(a){var d=this._handler.add(a);var c=this._handler.getName(d);if(this._options.onSubmit(d,c,a)!==false){this._handler._options.action=this._options.action;this._handler._options.sendAsForm=this._options.sendAsForm;this._onSubmit(d,c);if(this._options.autoUpload){this._handler.upload(d,this._options.params)}else{this._filesInProgress--;var b=this._getItemByFileId(d);this._find(b,"spinner").style.display="none";this._storedFiles.push(d)}}},_validateFile:function(d){var a,b,c;a=this._getValidationDescriptor(d);if(this._options.onValidate(a,false,d)===false){return false}if(d.value){b=d.value.replace(/.*(\/|\\)/,"")}else{b=d.fileName!=null?d.fileName:d.name;c=d.fileSize!=null?d.fileSize:d.size}if(!this._isAllowedExtension(b)){this._error("typeError",b);return false}else{if(c===0){this._error("emptyError",b);return false}else{if(c&&this._options.sizeLimit&&c>this._options.sizeLimit){this._error("sizeError",b);return false}else{if(c&&c<this._options.minSizeLimit){this._error("minSizeError",b);return false}}}}return true},_error:function(c,d){var b=this._options.messages[c];function a(f,g){b=b.replace(f,g)}a("{file}",this._formatFileName(d));a("{extensions}",this._options.allowedExtensions.join(", "));a("{sizeLimit}",this._formatSize(this._options.sizeLimit));a("{minSizeLimit}",this._formatSize(this._options.minSizeLimit));this._options.onError(null,d,b);this._options.showMessage(b);if(this._options.onError(b,d)!==false){this._options.onError(b,d)}},_formatFileName:function(a){if(a.length>33){a=a.slice(0,19)+"..."+a.slice(-13)}return a},_isAllowedExtension:function(d){var b=(-1!==d.indexOf("."))?d.replace(/.*[.]/,"").toLowerCase():"";var c=this._options.allowedExtensions;if(!c.length){return true}for(var a=0;a<c.length;a++){if(c[a].toLowerCase()==b){return true}}return false},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]},_parseFileName:function(b){var a;if(b.value){a=b.value.replace(/.*(\/|\\)/,"")}else{a=(b.fileName!==null&&b.fileName!==undefined)?b.fileName:b.name}return a},_parseFileSize:function(b){var a;if(!b.value){a=(b.fileSize!==null&&b.fileSize!==undefined)?b.fileSize:b.size}return a},_getValidationDescriptor:function(d){var b,c,a;a={};b=this._parseFileName(d);c=this._parseFileSize(d);a.name=b;if(c){a.size=c}return a},_getValidationDescriptors:function(b){var a,c;c=[];for(a=0;a<b.length;a++){c.push(b[a])}return c}};qq.FileUploader=function(b){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,dropElement:null,listElement:null,skipDropElement:false,skipUploadElement:false,template:'<div class="qq-uploader"><div class="qq-upload-drop-area" style="display:none"><span>Drop files here to upload</span></div><div type="button" class="qq-upload-button button2 small">Upload Image</div><ul class="qq-upload-list" style="display:none;"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"},additionalUploadIds:false});qq.extend(this._options,b);this._element=this._options.element;if(!this._options.skipDropTemplate){this._dropElement=this._options.dropElement?this._options.dropElement:this._options.element}if(!this._options.skipUploadTemplate){this._element.innerHTML=this._options.template;this._button=this._createUploadButton(this._find(this._element,"button"))}if(this._options.additionalUploadIds){for(var a=0;a<this._options.additionalUploadIds.length;a++){this._createUploadButton($(this._options.additionalUploadIds[a]))}}this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;this._bindCancelEvent();if(!this._options.skipDropTemplate){this._setupDragDrop()}};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{_find:function(c,b){var a=qq.getByClass(c,this._options.classes[b])[0];if(!a){throw new Error("element not found "+b)}return a},_setupDragDrop:function(){var b=this,c=this._find(this._dropElement,"drop");var a=new qq.UploadDropZone({element:c,onEnter:function(d){qq.addClass(c,b._classes.dropActive);d.stopPropagation()},onLeave:function(d){d.stopPropagation()},onLeaveNotDescendants:function(d){qq.removeClass(c,b._classes.dropActive)},onDrop:function(h){gtrack.track_events("[ttp]:sidebar/minisuper","drag-n-drop","");var g=qq.getByClass(document,b._options.classes.drop);for(var f=0;f<g.length;f++){if(g[f]){qq.removeClass(g[f],b._classes.dropActive);g[f].style.display="none";$$("body")[0].removeClassName("qq-dragging")}}if(b._options.urlHandler&&h.dataTransfer.files.length==0){if(h.dataTransfer.types.indexOf&&-1!=h.dataTransfer.types.indexOf("text/uri-list")||h.dataTransfer.types.contains&&-1!=h.dataTransfer.types.contains("text/uri-list")){var d=h.dataTransfer.getData("text/uri-list");return b._options.urlHandler(h,d)}}b._uploadFileList(h.dataTransfer.files);if($(h.target).descendantOf($("suplist_omnibox_modules"))){gtrack.track_events("[ttp]:edit-item","drag-drop-image")}}});c.style.display="none";c.hide_fn=function(){this.style.display="none";$$("body")[0].removeClassName("qq-dragging")}.bind(c);qq.attach(document,"dragenter",function(d){$$("body")[0].addClassName("qq-dragging");if(!a._isValidFileDrag(d)||c.className.match(/disabled/)){return}c.style.display="block"});qq.attach(document,"dragleave",function(f){var d=document.elementFromPoint(f.clientX,f.clientY);if(!d||d.nodeName=="HTML"||d.nodeName=="BODY"){c.hide_fn()}})},_onSubmit:function(b,a){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(b,a)},_onProgress:function(a,c,d,g){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var i=this._getItemByFileId(a);if(!i){var f=a;var b=0;while(!i){f++;b++;if(b>50){break}i=this._getItemByFileId(f)}}var j=this._find(i,"size");j.style.display="inline";var h;if(d!=g){h=Math.round(d/g*100)+"% from "+this._formatSize(g)}else{h=this._formatSize(g)}qq.setText(j,h)},_onComplete:function(g,f,a){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var c=this._getItemByFileId(g);if(!c){var b=g;var d=0;while(!c){b++;d++;if(d>50){break}c=this._getItemByFileId(b)}}qq.remove(this._find(c,"cancel"));qq.remove(this._find(c,"spinner"));if(a.success){qq.addClass(c,this._classes.success)}else{qq.addClass(c,this._classes.fail)}},_addToList:function(d,c){var a=qq.toElement(this._options.fileTemplate);a.qqFileId=d;var b=this._find(a,"file");qq.setText(b,this._formatFileName(c));this._find(a,"size").style.display="none";this._listElement.appendChild(a)},_getItemByFileId:function(b){var a=this._listElement.firstChild;while(a){if(a.qqFileId==b){return a}a=a.nextSibling}},_bindCancelEvent:function(){var a=this,b=this._listElement;if(b){qq.attach(b,"click",function(f){f=f||window.event;var d=f.target||f.srcElement;if(qq.hasClass(d,a._classes.cancel)){qq.preventDefault(f);var c=d.parentNode;a._handler.cancel(c.qqFileId);qq.remove(c)}})}}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(b){},onLeave:function(b){},onLeaveNotDescendants:function(b){},onDrop:function(b){}};qq.extend(this._options,a);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_disableDropOutside:function(a){if(!qq.UploadDropZone.dropOutsideDisabled){qq.attach(document,"dragover",function(b){if(b.dataTransfer){b.dataTransfer.dropEffect="none";b.preventDefault()}});qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var a=this;qq.attach(a._element,"dragover",function(c){if(!a._isValidFileDrag(c)){return}var b=c.dataTransfer.effectAllowed;if(b=="move"||b=="linkMove"){c.dataTransfer.dropEffect="move"}else{c.dataTransfer.dropEffect="copy"}c.stopPropagation();c.preventDefault()});qq.attach(a._element,"dragenter",function(b){if(!a._isValidFileDrag(b)){return}a._options.onEnter(b)});qq.attach(a._element,"dragleave",function(c){if(!a._isValidFileDrag(c)){return}a._options.onLeave(c);var b=document.elementFromPoint(c.clientX,c.clientY);if(qq.contains(this,b)){return}a._options.onLeaveNotDescendants(c)});qq.attach(a._element,"drop",function(b){if(!a._isValidFileDrag(b)){return}b.preventDefault();a._options.onDrop(b)})},_isValidFileDrag:function(c){if(qq.ie()&&!qq.ie10()){return false}var b=c.dataTransfer,a=navigator.userAgent.indexOf("AppleWebKit")>-1;return b&&b.effectAllowed!="none"&&(b.files||(!a&&b.types&&b.types.contains&&b.types.contains("Files")))}};qq.UploadButton=function(a){this._options={element:null,multiple:false,name:"file",onChange:function(b){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);this._element=this._options.element;qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq.remove(this._input)}qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var c=$(this._element).down("input[type=file]");if(c){return c}var b=document.createElement("input");if(this._options.multiple){b.setAttribute("multiple","multiple")}b.setAttribute("type","file");b.setAttribute("name",this._options.name);b.setAttribute("rel:gt_act","ignore");qq.css(b,{position:"absolute",right:0,top:0,fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0,width:"100%",height:"100%"});b.addClassName("file_mask");this._element.appendChild(b);var a=this;qq.attach(b,"change",function(){a._options.onChange(b)});qq.attach(b,"mouseover",function(){qq.addClass(a._element,a._options.hoverClass)});qq.attach(b,"mouseout",function(){qq.removeClass(a._element,a._options.hoverClass)});qq.attach(b,"focus",function(){qq.addClass(a._element,a._options.focusClass)});qq.attach(b,"blur",function(){qq.removeClass(a._element,a._options.focusClass)});if(window.attachEvent){b.setAttribute("tabIndex","-1")}return b}};qq.UploadHandlerAbstract=function(a){this._options={debug:false,action:"/upload.php",maxConnections:999,onProgress:function(f,d,b,c){},onComplete:function(d,c,b){},onCancel:function(c,b){}};qq.extend(this._options,a);this._queue=[];this._params=[]};qq.UploadHandlerAbstract.prototype={log:function(a){if(this._options.debug&&window.console){console.log("[uploader] "+a)}},add:function(a){},upload:function(d,b){var a=this._queue.push(d);var c={};qq.extend(c,b);this._params[d]=c;if(a<=this._options.maxConnections){this._upload(d,this._params[d])}},cancel:function(a){this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++){this._cancel(this._queue[a])}this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},_upload:function(a){},_cancel:function(a){},_dequeue:function(d){var b=qq.indexOf(this._queue,d);this._queue.splice(b,1);var a=this._options.maxConnections;if(this._queue.length>=a&&b<a){var c=this._queue[a-1];this._upload(c,this._params[c])}}};qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name","image");var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;if(a.parentNode){qq.remove(a)}return b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},_cancel:function(b){this._options.onCancel(b,this.getName(b));delete this._inputs[b];var a=document.getElementById(b);if(a){a.setAttribute("src","javascript:false;");qq.remove(a)}},_upload:function(h,f){var b=this._inputs[h];if(!b){throw new Error("file with passed id was not added, or already uploaded or cancelled")}var g=this.getName(h);var c=this._createIframe(h);var d=this._createForm(c,f);d.appendChild(b);var a=this;this._attachLoadEvent(c,function(){a.log("iframe loaded");var i=a._getIframeContentJSON(c);a._options.onComplete(h,g,i);a._dequeue(h);delete a._inputs[h];setTimeout(function(){qq.remove(c)},1)});d.submit();qq.remove(d);return h},_attachLoadEvent:function(a,b){qq.attach(a,"load",function(){if(!a.parentNode){return}try{if(a.contentDocument&&a.contentDocument.body&&a.contentDocument.body.innerHTML=="false"){return}}catch(c){}b()})},_getIframeContentJSON:function(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(err){response={}}}catch(e){response={success:false}}return response},_createIframe:function(b){var a=qq.toElement('<iframe src="javascript:false;" name="'+b+'" />');a.setAttribute("id",b);a.style.display="none";document.body.appendChild(a);return a},_createForm:function(a,c){var b=qq.toElement('<form method="post" enctype="multipart/form-data"></form>');qq.obj2Inputs(c,b);b.setAttribute("action",this._options.action);b.setAttribute("target",a.name);b.style.display="none";document.body.appendChild(b);return b}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){try{var a=document.createElement("input");a.type="file";var c=false;var b=navigator.userAgent.toLowerCase();if(b.indexOf("safari")!=-1){c=true;if(b.indexOf("chrome")>-1){c=false}}var f=(typeof FileReader!="undefined"&&typeof(new FileReader()).readAsBinaryString=="undefined");return("multiple" in a&&typeof File!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined"&&typeof FileReader!="undefined"&&typeof window.WebKitBlobBuilder=="undefined"&&!c&&!f)}catch(d){console.error(d);return false}};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(a)-1},getName:function(b){var a=this._files[b];return a.fileName!=null?a.fileName:a.name},getSize:function(b){var a=this._files[b];return a.fileSize!=null?a.fileSize:a.size},getLoaded:function(a){return this._loaded[a]||0},_upload:function(c,g){var f=this._files[c],b=this.getName(c),l=this.getSize(c);this._loaded[c]=0;var j=this._xhrs[c]=new XMLHttpRequest();var k=this;j.upload.onprogress=function(m){if(m.lengthComputable){k._loaded[c]=m.loaded;k._options.onProgress(c,b,m.loaded,m.total)}};j.onreadystatechange=function(){if(j.readyState==4){k._onComplete(c,j)}};g=g||{};var a=qq.obj2url(g,this._options.action);j.open("POST",a,true);if(this._options.sendAsForm){try{if(typeof XMLHttpRequest.prototype.sendAsBinary=="undefined"){XMLHttpRequest.prototype.sendAsBinary=function(p){var o=new ArrayBuffer(p.length);var m=new Uint8Array(o,0);for(var n=0;n<p.length;n++){m[n]=(p.charCodeAt(n)&255)}this.send(m)}}}catch(i){console.error(i)}var d="---------------------------";d+=Math.floor(Math.random()*32768);d+=Math.floor(Math.random()*32768);d+=Math.floor(Math.random()*32768);var h=new FileReader();h.readAsBinaryString(f);h.onload=function(n){g.Filedata=h.result;g.Filename=encodeURIComponent(f.name);var m="";$H(g).each(function(o){if(m!=""){m+="\r\n"}m+="--"+d+'\r\nContent-Disposition: form-data; charset: utf-8; accept-charset: utf-8; name="'+o.key+'"';if(o.key=="Filedata"){m+='; filename="'+encodeURIComponent(f.name)+'"\r\nContent-Type: application/octet-stream'}m+="\r\n\r\n"+o.value});m+="\r\n";m+="--"+d+"--\r\n";j.setRequestHeader("Content-Type","multipart/form-data; charset: utf-8; accept-charset: utf-8; boundary="+d);j.sendAsBinary(m)}}else{j.setRequestHeader("X-Requested-With","XMLHttpRequest");j.setRequestHeader("X-File-Name",encodeURIComponent(b));j.setRequestHeader("X-Filesize-On-Client",l);j.setRequestHeader("Content-Type","application/octet-stream");j.send(f)}},_onComplete:function(id,xhr){if(!this._files[id]){return}var xhr_request=this._xhrs[id];if(BF_STATIC.bf_env==="dev"&&BF_STATIC.bf_test_mode){var test_status=window.AJAX_TEST_STATUS[this._options.action];if(!test_status){test_status=(new RequestStack())}var req={xhr_request:xhr_request};req.status=xhr.status;if(test_status.push){test_status.push(req)}else{if(test_status.stack&&test_status.stack.push){test_status.stack.push(req)}}window.AJAX_TEST_STATUS[this._options.action]=test_status}var name=this.getName(id);var size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200){this.log("xhr - server response received");this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}try{if(acl.user_can("general_admin")&&response.uploaded&&(response.uploaded==="false"||response.uploaded===false)&&response.filesize_on_server){(new Image).src="/buzzfeed/_error_logger?z="+(new Date).getTime()+"&error="+encodeURIComponent(JSON.stringify(response))}}catch(err){console.dir(err)}this._options.onComplete(id,name,response)}else{this._options.onComplete(id,name,{})}this._files[id]=null;this._xhrs[id]=null;this._dequeue(id)},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;if(this._xhrs[a]){this._xhrs[a].abort();this._xhrs[a]=null}}});
/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var audioplayer_swfobject=function(){var F="undefined",s="object",U="Shockwave Flash",Y="ShockwaveFlash.ShockwaveFlash",r="application/x-shockwave-flash",T="SWFObjectExprInst",z="onreadystatechange",Q=window,k=document,v=navigator,V=false,W=[i],p=[],P=[],K=[],m,S,G,D,L=false,a=false,o,I,n=true,O=function(){var ac=typeof k.getElementById!=F&&typeof k.getElementsByTagName!=F&&typeof k.createElement!=F,aj=v.userAgent.toLowerCase(),aa=v.platform.toLowerCase(),ag=aa?/win/.test(aa):/win/.test(aj),ae=aa?/mac/.test(aa):/mac/.test(aj),ah=/webkit/.test(aj)?parseFloat(aj.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,Z=!+"\v1",ai=[0,0,0],ad=null;if(typeof v.plugins!=F&&typeof v.plugins[U]==s){ad=v.plugins[U].description;if(ad&&!(typeof v.mimeTypes!=F&&v.mimeTypes[r]&&!v.mimeTypes[r].enabledPlugin)){V=true;Z=false;ad=ad.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ai[0]=parseInt(ad.replace(/^(.*)\..*$/,"$1"),10);ai[1]=parseInt(ad.replace(/^.*\.(.*)\s.*$/,"$1"),10);ai[2]=/[a-zA-Z]/.test(ad)?parseInt(ad.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof Q.ActiveXObject!=F){try{var af=new ActiveXObject(Y);if(af){ad=af.GetVariable("$version");if(ad){Z=true;ad=ad.split(" ")[1].split(",");ai=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}}catch(ab){}}}return{w3:ac,pv:ai,wk:ah,ie:Z,win:ag,mac:ae}}(),l=function(){if(!O.w3){return}if((typeof k.readyState!=F&&k.readyState=="complete")||(typeof k.readyState==F&&(k.getElementsByTagName("body")[0]||k.body))){g()}if(!L){if(typeof k.addEventListener!=F){k.addEventListener("DOMContentLoaded",g,false)}if(O.ie&&O.win){k.attachEvent(z,function(){if(k.readyState=="complete"){k.detachEvent(z,arguments.callee);g()}});if(Q==top){(function(){if(L){return}try{k.documentElement.doScroll("left")}catch(Z){setTimeout(arguments.callee,0);return}g()})()}}if(O.wk){(function(){if(L){return}if(!/loaded|complete/.test(k.readyState)){setTimeout(arguments.callee,0);return}g()})()}t(g)}}();function g(){if(L){return}try{var ab=k.getElementsByTagName("body")[0].appendChild(E("span"));ab.parentNode.removeChild(ab)}catch(ac){return}L=true;var Z=W.length;for(var aa=0;aa<Z;aa++){W[aa]()}}function M(Z){if(L){Z()}else{W[W.length]=Z}}function t(aa){if(typeof Q.addEventListener!=F){Q.addEventListener("load",aa,false)}else{if(typeof k.addEventListener!=F){k.addEventListener("load",aa,false)}else{if(typeof Q.attachEvent!=F){j(Q,"onload",aa)}else{if(typeof Q.onload=="function"){var Z=Q.onload;Q.onload=function(){Z();aa()}}else{Q.onload=aa}}}}}function i(){if(V){X()}else{J()}}function X(){var Z=k.getElementsByTagName("body")[0];var ac=E(s);ac.setAttribute("type",r);var ab=Z.appendChild(ac);if(ab){var aa=0;(function(){if(typeof ab.GetVariable!=F){var ad=ab.GetVariable("$version");if(ad){ad=ad.split(" ")[1].split(",");O.pv=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}else{if(aa<10){aa++;setTimeout(arguments.callee,10);return}}Z.removeChild(ac);ab=null;J()})()}else{J()}}function J(){var ai=p.length;if(ai>0){for(var ah=0;ah<ai;ah++){var aa=p[ah].id;var ad=p[ah].callbackFn;var ac={success:false,id:aa};if(O.pv[0]>0){var ag=c(aa);if(ag){if(H(p[ah].swfVersion)&&!(O.wk&&O.wk<312)){y(aa,true);if(ad){ac.success=true;ac.ref=B(aa);ad(ac)}}else{if(p[ah].expressInstall&&C()){var ak={};ak.data=p[ah].expressInstall;ak.width=ag.getAttribute("width")||"0";ak.height=ag.getAttribute("height")||"0";if(ag.getAttribute("class")){ak.styleclass=ag.getAttribute("class")}if(ag.getAttribute("align")){ak.align=ag.getAttribute("align")}var aj={};var Z=ag.getElementsByTagName("param");var ae=Z.length;for(var af=0;af<ae;af++){if(Z[af].getAttribute("name").toLowerCase()!="movie"){aj[Z[af].getAttribute("name")]=Z[af].getAttribute("value")}}R(ak,aj,aa,ad)}else{q(ag);if(ad){ad(ac)}}}}}else{y(aa,true);if(ad){var ab=B(aa);if(ab&&typeof ab.SetVariable!=F){ac.success=true;ac.ref=ab}ad(ac)}}}}}function B(ac){var Z=null;var aa=c(ac);if(aa&&aa.nodeName=="OBJECT"){if(typeof aa.SetVariable!=F){Z=aa}else{var ab=aa.getElementsByTagName(s)[0];if(ab){Z=ab}}}return Z}function C(){return !a&&H("6.0.65")&&(O.win||O.mac)&&!(O.wk&&O.wk<312)}function R(ac,ad,Z,ab){a=true;G=ab||null;D={success:false,id:Z};var ag=c(Z);if(ag){if(ag.nodeName=="OBJECT"){m=h(ag);S=null}else{m=ag;S=Z}ac.id=T;if(typeof ac.width==F||(!/%$/.test(ac.width)&&parseInt(ac.width,10)<310)){ac.width="310"}if(typeof ac.height==F||(!/%$/.test(ac.height)&&parseInt(ac.height,10)<137)){ac.height="137"}k.title=k.title.slice(0,47)+" - Flash Player Installation";var af=O.ie&&O.win?"ActiveX":"PlugIn",ae="MMredirectURL="+Q.location.toString().replace(/&/g,"%26")+"&MMplayerType="+af+"&MMdoctitle="+k.title;if(typeof ad.flashvars!=F){ad.flashvars+="&"+ae}else{ad.flashvars=ae}if(O.ie&&O.win&&ag.readyState!=4){var aa=E("div");Z+="SWFObjectNew";aa.setAttribute("id",Z);ag.parentNode.insertBefore(aa,ag);ag.style.display="none";(function(){if(ag.readyState==4){ag.parentNode.removeChild(ag)}else{setTimeout(arguments.callee,10)}})()}w(ac,ad,Z)}}function q(aa){if(O.ie&&O.win&&aa.readyState!=4){var Z=E("div");aa.parentNode.insertBefore(Z,aa);Z.parentNode.replaceChild(h(aa),Z);aa.style.display="none";(function(){if(aa.readyState==4){aa.parentNode.removeChild(aa)}else{setTimeout(arguments.callee,10)}})()}else{aa.parentNode.replaceChild(h(aa),aa)}}function h(ae){var ad=E("div");if(O.win&&O.ie){ad.innerHTML=ae.innerHTML}else{var aa=ae.getElementsByTagName(s)[0];if(aa){var af=aa.childNodes;if(af){var Z=af.length;for(var ab=0;ab<Z;ab++){if(!(af[ab].nodeType==1&&af[ab].nodeName=="PARAM")&&!(af[ab].nodeType==8)){ad.appendChild(af[ab].cloneNode(true))}}}}}return ad}function w(ak,ai,aa){var Z,ac=c(aa);if(O.wk&&O.wk<312){return Z}if(ac){if(typeof ak.id==F){ak.id=aa}if(O.ie&&O.win){var aj="";for(var ag in ak){if(ak[ag]!=Object.prototype[ag]){if(ag.toLowerCase()=="data"){ai.movie=ak[ag]}else{if(ag.toLowerCase()=="styleclass"){aj+=' class="'+ak[ag]+'"'}else{if(ag.toLowerCase()!="classid"){aj+=" "+ag+'="'+ak[ag]+'"'}}}}}var ah="";for(var af in ai){if(ai[af]!=Object.prototype[af]){ah+='<param name="'+af+'" value="'+ai[af]+'" />'}}ac.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+aj+">"+ah+"</object>";P[P.length]=ak.id;Z=c(ak.id)}else{var ab=E(s);ab.setAttribute("type",r);for(var ae in ak){if(ak[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="styleclass"){ab.setAttribute("class",ak[ae])}else{if(ae.toLowerCase()!="classid"){ab.setAttribute(ae,ak[ae])}}}}for(var ad in ai){if(ai[ad]!=Object.prototype[ad]&&ad.toLowerCase()!="movie"){f(ab,ad,ai[ad])}}ac.parentNode.replaceChild(ab,ac);Z=ab}}return Z}function f(ab,Z,aa){var ac=E("param");ac.setAttribute("name",Z);ac.setAttribute("value",aa);ab.appendChild(ac)}function A(aa){var Z=c(aa);if(Z&&Z.nodeName=="OBJECT"){if(O.ie&&O.win){Z.style.display="none";(function(){if(Z.readyState==4){b(aa)}else{setTimeout(arguments.callee,10)}})()}else{Z.parentNode.removeChild(Z)}}}function b(ab){var aa=c(ab);if(aa){for(var Z in aa){if(typeof aa[Z]=="function"){aa[Z]=null}}aa.parentNode.removeChild(aa)}}function c(ab){var Z=null;try{Z=k.getElementById(ab)}catch(aa){}return Z}function E(Z){return k.createElement(Z)}function j(ab,Z,aa){ab.attachEvent(Z,aa);K[K.length]=[ab,Z,aa]}function H(ab){var aa=O.pv,Z=ab.split(".");Z[0]=parseInt(Z[0],10);Z[1]=parseInt(Z[1],10)||0;Z[2]=parseInt(Z[2],10)||0;return(aa[0]>Z[0]||(aa[0]==Z[0]&&aa[1]>Z[1])||(aa[0]==Z[0]&&aa[1]==Z[1]&&aa[2]>=Z[2]))?true:false}function x(ae,aa,af,ad){if(O.ie&&O.mac){return}var ac=k.getElementsByTagName("head")[0];if(!ac){return}var Z=(af&&typeof af=="string")?af:"screen";if(ad){o=null;I=null}if(!o||I!=Z){var ab=E("style");ab.setAttribute("type","text/css");ab.setAttribute("media",Z);o=ac.appendChild(ab);if(O.ie&&O.win&&typeof k.styleSheets!=F&&k.styleSheets.length>0){o=k.styleSheets[k.styleSheets.length-1]}I=Z}if(O.ie&&O.win){if(o&&typeof o.addRule==s){o.addRule(ae,aa)}}else{if(o&&typeof k.createTextNode!=F){o.appendChild(k.createTextNode(ae+" {"+aa+"}"))}}}function y(ab,Z){if(!n){return}var aa=Z?"visible":"hidden";if(L&&c(ab)){c(ab).style.visibility=aa}else{x("#"+ab,"visibility:"+aa)}}function N(aa){var ab=/[\\\"<>\.;]/;var Z=ab.exec(aa)!=null;return Z&&typeof encodeURIComponent!=F?encodeURIComponent(aa):aa}var d=function(){if(O.ie&&O.win){window.attachEvent("onunload",function(){var ae=K.length;for(var ad=0;ad<ae;ad++){K[ad][0].detachEvent(K[ad][1],K[ad][2])}var ab=P.length;for(var ac=0;ac<ab;ac++){A(P[ac])}for(var aa in O){O[aa]=null}O=null;for(var Z in audioplayer_swfobject){audioplayer_swfobject[Z]=null}audioplayer_swfobject=null})}}();return{registerObject:function(ad,Z,ac,ab){if(O.w3&&ad&&Z){var aa={};aa.id=ad;aa.swfVersion=Z;aa.expressInstall=ac;aa.callbackFn=ab;p[p.length]=aa;y(ad,false)}else{if(ab){ab({success:false,id:ad})}}},getObjectById:function(Z){if(O.w3){return B(Z)}},embedSWF:function(ad,aj,ag,ai,aa,ac,ab,af,ah,ae){var Z={success:false,id:aj};if(O.w3&&!(O.wk&&O.wk<312)&&ad&&aj&&ag&&ai&&aa){y(aj,false);M(function(){ag+="";ai+="";var al={};if(ah&&typeof ah===s){for(var an in ah){al[an]=ah[an]}}al.data=ad;al.width=ag;al.height=ai;var ao={};if(af&&typeof af===s){for(var am in af){ao[am]=af[am]}}if(ab&&typeof ab===s){for(var ak in ab){if(typeof ao.flashvars!=F){ao.flashvars+="&"+ak+"="+ab[ak]}else{ao.flashvars=ak+"="+ab[ak]}}}if(H(aa)){var ap=w(al,ao,aj);if(al.id==aj){y(aj,true)}Z.success=true;Z.ref=ap}else{if(ac&&C()){al.data=ac;R(al,ao,aj,ae);return}else{y(aj,true)}}if(ae){ae(Z)}})}else{if(ae){ae(Z)}}},switchOffAutoHideShow:function(){n=false},ua:O,getFlashPlayerVersion:function(){return{major:O.pv[0],minor:O.pv[1],release:O.pv[2]}},hasFlashPlayerVersion:H,createSWF:function(ab,aa,Z){if(O.w3){return w(ab,aa,Z)}else{return undefined}},showExpressInstall:function(ab,ac,Z,aa){if(O.w3&&C()){R(ab,ac,Z,aa)}},removeSWF:function(Z){if(O.w3){A(Z)}},createCSS:function(ac,ab,aa,Z){if(O.w3){x(ac,ab,aa,Z)}},addDomLoadEvent:M,addLoadEvent:t,getQueryParamValue:function(ac){var ab=k.location.search||k.location.hash;if(ab){if(/\?/.test(ab)){ab=ab.split("?")[1]}if(ac==null){return N(ab)}var aa=ab.split("&");for(var Z=0;Z<aa.length;Z++){if(aa[Z].substring(0,aa[Z].indexOf("="))==ac){return N(aa[Z].substring((aa[Z].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var Z=c(T);if(Z&&m){Z.parentNode.replaceChild(m,Z);if(S){y(S,true);if(O.ie&&O.win){m.style.display="block"}}if(G){G(D)}}a=false}}}}();var AudioPlayer=function(){var b=[];var g={};var f={};var c="";var h={};var d=-1;var j="9";function i(k){if(document.all&&!window[k]){for(var l=0;l<document.forms.length;l++){if(document.forms[l][k]){return document.forms[l][k];break}}}return document.all?window[k]:document[k]}function a(k,l,m){i(k).addListener(l,m)}return{setup:function(l,k){c=l;h=k;if(audioplayer_swfobject.hasFlashPlayerVersion(j)){audioplayer_swfobject.switchOffAutoHideShow();audioplayer_swfobject.createCSS("p.audioplayer_container span","visibility:hidden;height:24px;overflow:hidden;padding:0;border:none;")}},getPlayer:function(k){return i(k)},addListener:function(k,l,m){a(k,l,m)},embed:function(k,m){var p={};var n;var l={};var q={};var o={};for(n in h){p[n]=h[n]}for(n in m){p[n]=m[n]}if(p.transparentpagebg=="yes"){l.bgcolor="#FFFFFF";l.wmode="transparent"}else{if(p.pagebg){l.bgcolor="#"+p.pagebg}l.wmode="opaque"}l.menu="false";for(n in p){if(n=="pagebg"||n=="width"||n=="transparentpagebg"){continue}q[n]=p[n]}o.name=k;o.style="outline: none";q.playerID=k;audioplayer_swfobject.embedSWF(c,k,p.width.toString(),"24",j,false,q,l,o);b.push(k);if(m.group){g[k]=m.group}},syncVolumes:function(k,m){if(g[k]){return}d=m;for(var l=0;l<b.length;l++){if(!g[b[l]]&&b[l]!=k){i(b[l]).setVolume(d)}}},activate:function(k,m){for(var l in f){if(l==k){continue}if(g[k]!=g[l]){this.close(l);continue}if(!(g[k]||g[l])){this.close(l)}}f[k]=1},load:function(m,k,n,l){i(m).load(k,n,l)},close:function(k){i(k).close();if(k in f){delete f[k]}},open:function(k,l){if(l==undefined){l=1}i(k).open(l==undefined?0:l-1)},getVolume:function(k){return d}}}();var BF_GplusSignin=function(){this.callback=function(authResult){signin.spinner();if(!authResult.status["signed_in"]){if(signin.spin_el){signin.spin_el.hide()}return}else{if(authResult.status["signed_in"]){new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:{googleplus:"1",otc:authResult.code},onSuccess:function(result){gplus._result(result)},onFailure:function(result){if(signin.spin_el){signin.spin_el.hide()}return}})}}};this._result=function(result){signin.is_gplus=true;var res=eval("("+result.responseText+")"),user=new BF_User,default_lang=BF_STATIC.language||"en",username,params;if(res.username.match("[^A-Za-z0-9]")){res.username=res.username.replace(res.username.match("[^A-Za-z0-9]")[0],"")}if(!user.isLoggedIn()&&res.login=="false"&&res.username&&res.password){params={name:res.username,username:res.username.replace(/\W/g,""),pw:res.password,email:res.email,contribute:"1",allow_email_updates:"1",googleplus_uid:res.googleplus_uid,import_fb_profile:"false",language:res.language||default_lang,googleplus_image:res.googleplus_image,display_name:res.display_name,};signin.social_register=true;bf_register.new_register(params)}else{if(res.login=="true"){gplus.login(res)}}};this.login=function(obj){if(obj&&obj.session_key){BFW_Util.setCookie({name:BFW_COOKIE,value:obj.session_key});BFW_Util.setInfoCookie({value:obj});bf_login.cookieLogin()}}};var BF_UserSwitcher={controller:"/buzzfeed/_switch",template:'<li><a href="" onclick="return false" class="switch-to-user" rel:id="#{id}"><img src="#{root}#{image}"/>#{display_name}</a></li>',template_bottom_div:'<li class="#{hl}"><a href="" onclick="return false" rel:username="#{username}"><span class="list-username" rel:username="#{username}">#{username}</span> #{display_name}</a><span class="hl chosen"></span></li>',latest_switch_list:[],latest_switch_list_loaded:false,was_ajax:false,switcher:null,bottom_warning_div:null,bottom_warning_select:null,is_user_switcher:false,selected_user:null,init:function(b){try{if(!acl.user_can("general_admin")){return false}if(b!=null){BF_UserSwitcher.selected_user=b}if(BF_UserSwitcher.is_user_switcher){BF_UserSwitcher.apply_visibility();return false}BF_UserSwitcher.switcher=$("quickpost-user-switcher");if(BF_UserSwitcher.switcher){BF_UserSwitcher.is_user_switcher=true}BF_UserSwitcher.apply_visibility();if(acl.user_can("general_admin")){BF_UserSwitcher._switch_list_ui([""],"bottom");universal_dom.get_bucket_elements("switch_users").each(function(d){var c=BF_UserSwitcher.switcher.select(".switch_user_list")[0];d.observe("click",function(){if(c.style.display=="block"){return false}c.style.display="block";universal_dom.get_bucket_elements("switch_user_dialog").each(function(f){f.update("Loading...")});BF_UserSwitcher.getSwitchList(BF_UserSwitcher._switch_list_ui,"bottom",true)});Event.observe(window,"click",function(f){if(!$(f.target).childOf||!$(f.target).childOf(BF_UserSwitcher.switcher)){c.style.display="none"}})})}}catch(a){console.error(a)}},apply_visibility:function(){try{if(!BF_UserSwitcher.is_user_switcher){return false}var a=(new BF_User()).getUserInfo();if(BF_UserSwitcher.selected_user==null){if(typeof edit_post!="undefined"){BF_UserSwitcher.selected_user=edit_post.buzz.username}else{BF_UserSwitcher.selected_user=a.username;$$(".switched-display_name").each(function(d){if(d.hasClassName("bottom_display_name")){d.update(a.display_name)}})}}if(acl.user_can("general_admin")){var b;if(typeof edit_post!="undefined"){b=edit_post.buzz.username}else{b=a.default_user.username}}else{BF_UserSwitcher.switcher.style.display="none"}}catch(c){console.error(c)}},sw_bottom_div:function(b){try{b.stop();var a=BF_UserSwitcher.switcher.select(".switch_user_list")[0];a.select("li a").each(function(c){if(b.target==c||b.target.parentNode==c){BF_UserSwitcher.selected_user=c.getAttribute("rel:username");c.parentNode.addClassName("hl");superlist_bylines.set_add_bylines(BF_UserSwitcher.selected_user,true);universal_dom.get_bucket_elements("switch_user_dialog")[0].hide()}else{c.parentNode.removeClassName("hl")}});BF_UserSwitcher.apply_visibility()}catch(b){console.error(b)}},fill_switch_div:function(d){try{if(!BF_UserSwitcher.is_user_switcher){return false}var c=new Template(BF_UserSwitcher.template_bottom_div);var b="<ul>";var a=(new BF_User()).getUserInfo();u=a.default_user;d.unshift({display_name:decodeURIComponent(u.display_name.unescapeHTML()),username:u.username,image:u.image,userid:u.userid});if(typeof edit_post!="undefined"){d.unshift({display_name:decodeURIComponent(edit_post.buzz.user_displayname.unescapeHTML()),not_user:true,username:edit_post.buzz.username,image:edit_post.buzz.user_image,userid:edit_post.buzz.userid})}d.each(function(h){if(h.p_disable_quickpost=="1"){return false}if(typeof edit_post!="undefined"&&h.username==edit_post.buzz.username&&!h.not_user){return false}var g=(BF_UserSwitcher.selected_user==h.username)?true:false;b+=c.evaluate({display_name:h.display_name,username:h.username,hl:(g?"hl":"")})});var d=BF_UserSwitcher.switcher.select(".switch_user_list")[0];d.update(b+"</ul>");d.select("ul a").each(function(g){g.observe("click",BF_UserSwitcher.sw_bottom_div)})}catch(f){console.error(f)}},switch_callback:function(){try{var a=(new BF_User()).getUserInfo();if(typeof edit_post=="undefined"){if(BF_UserSwitcher.is_user_switcher){BF_UserSwitcher.selected_user=a.username}$$(".switched-display_name").each(function(d){d.update(a.display_name)})}else{$$(".switched-display_name").each(function(d){if(!d.hasClassName("bottom_display_name")){d.update(a.display_name)}})}if(a.p_disable_quickpost=="true"){BF_Request.location({reload_track:true});return false}if(BF_UserSwitcher.is_user_switcher){var b=BF_UserSwitcher.switcher.select(".switch_user_list")[0];b.style.display="none";BF_UserSwitcher.apply_visibility()}}catch(c){console.error(c)}},swfunction:function(a){try{a.stop();var b=a.target.getAttribute("rel:id");BF_UserSwitcher.switchTo(b,BF_UserSwitcher.switch_callback)}catch(a){console.error(a)}},switch_list_ui:function(a){try{a.stop();if($("switch-list-spinner")){$("switch-list-spinner").show()}this.getSwitchList(BF_UserSwitcher._switch_list_ui,"top")}catch(a){console.error(a)}},_switch_list_ui:function(d,a,j){if(!$("usernav-switch-list")){return}try{if(j&&BF_UserSwitcher.is_user_switcher){var h=d.slice(0);BF_UserSwitcher.fill_switch_div(h)}var g=(new BF_User()).getUserInfo();var i=new Template(BF_UserSwitcher.template);var b='<a class="close_switch_list_ui" href="javascript:;" onclick="BF_UserSwitcher.hide_switch_list_ui();return false;"><img src="'+BF_STATIC.static_root+'/images/public/video-lightbox/closebox.png" alt="Close"/></a><ul>';var f=(typeof g.default_user.image=="undefined"||g.default_user_image==null)?"":g.default_user.image;if(f==null||f==""){f="/static/images/public/defaults/user.jpg"}d.unshift({image:decodeURIComponent(f.unescapeHTML()),display_name:decodeURIComponent(g.default_user.display_name.unescapeHTML()),userid:g.default_user.userid});d.each(function(k){if(typeof k.image=="undefined"||k.image==""||k.image==null){k.image="/static/images/public/defaults/user.jpg"}b+=i.evaluate({image:k.image,display_name:k.display_name,id:k.userid,root:BF_STATIC.image_root})});if(g.p_alias=="true"||(typeof g.default_user!="undefined"&&g.default_user.p_alias=="true")){b+='<li><a href="'+BF_STATIC.web_root+'/signup"><img src="'+BF_STATIC.static_root+'/images/public/icons/new-microsite.png" alt="" width="25" height="25" /><i>Create Another BuzzFeed</i></a></li>'}$("usernav-switch-list").update(b+"</ul>");if(a=="top"){$("usernav-switch-list").show();if($("switch-list-spinner")){$("switch-list-spinner").hide()}}$$(".switch-to-user").each(function(k){k.observe("click",BF_UserSwitcher.swfunction)});$$(".switched-display_name").each(function(k){if(!k.hasClassName("bottom_display_name")){k.update(g.display_name)}});BF_UserSwitcher.apply_visibility()}catch(c){console.error(c)}},hide_switch_list_ui:function(){$("usernav-switch-list").hide()},switchTo:function(g,f){try{var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"){if(a.userid==g){$("usernav-switch-list").hide();if($("switch-list-spinner")){$("switch-list-spinner").hide()}}else{$("usernav-switch-list").hide();if($("switch-list-spinner")){$("switch-list-spinner").show()}var c=new BF_Request();c.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch",default_username:a.default_user.username,default_session_key:a.default_user.session_key,switch_id:g},onSuccess:function(h){BF_UserSwitcher._switchTo(h,f)}})}}}}catch(d){console.error(d)}},_switchTo:function(b,d){try{var a={};if(window.location.href.match("/signup")){a={no_reload:true}}bf_login.loggedIn(b,a);d();if($("switch-list-spinner")){$("switch-list-spinner").hide()}}catch(c){console.error(c)}},getSwitchListFor:function(d,c){try{if(!acl.user_can("edit_user_accounts")){return}var a=new BF_Request();a.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch_list_for",username:d},onSuccess:function(f){BF_UserSwitcher._getSwitchList(f.responseText,c)}})}catch(b){console.error(b)}},getSwitchList:function(i,d,a){try{if(BF_UserSwitcher.was_ajax){var g=BF_UserSwitcher.latest_switch_list;g.shift();g=JSON.stringify(g);BF_UserSwitcher._getSwitchList('{"success" : 1, "switch_list" :'+g+"}",i,d,a)}else{if(typeof a=="undefined"){a=false}var c=new BF_User();if(c.isLoggedIn()){var b=c.getUserInfo();if(typeof b.default_user!="undefined"){var f=new BF_Request();f.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch_list",default_username:b.default_user.username,default_session_key:b.default_user.session_key},onSuccess:function(j){BF_UserSwitcher._getSwitchList(j.responseText,i,d,a);BF_UserSwitcher.was_ajax=true},on401:function(){console.warn("Insufficient Permissions")}})}}}}catch(h){console.error(h)}},_getSwitchList:function(responseText,callback,cbparam,withSelect){try{if(callback==undefined){return false}var obj=eval("("+responseText+")");if(obj.success=="1"){BF_UserSwitcher.latest_switch_list=obj.switch_list.slice(0);var user_info=(new BF_User()).getUserInfo();u=user_info.default_user;BF_UserSwitcher.latest_switch_list.unshift({display_name:decodeURIComponent(u.display_name.unescapeHTML()),username:u.username,image:decodeURIComponent(u.image.unescapeHTML()),userid:u.userid});BF_UserSwitcher.latest_switch_list_loaded=true;callback(obj.switch_list,cbparam,withSelect)}}catch(e){console.error(e)}},show_warning:function(){try{var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(!window.location.pathname.match("/dashboard$")&&typeof a.default_user!="undefined"&&a.default_user.username!=a.username){$$(".switched-display_name").each(function(d){d.update(a.display_name)});$$(".switch-warning").each(function(d){d.show()})}else{$$(".switch-warning").each(function(d){d.hide()})}}}catch(c){console.error(c)}},_getSwitchList:function(responseText,callback,cbparam,withSelect){if(callback==undefined){return false}var obj=eval("("+responseText+")");if(obj.success=="1"){if(typeof obj.switch_list.users!=="undefined"){BF_UserSwitcher.latest_switch_list=obj.switch_list.users.slice(0)}else{BF_UserSwitcher.latest_switch_list=obj.switch_list.slice(0)}var user_info=(new BF_User()).getUserInfo();u=user_info.default_user;BF_UserSwitcher.latest_switch_list.unshift({display_name:unescape(u.display_name),username:unescape(u.username),userid:unescape(u.userid)});BF_UserSwitcher.latest_switch_list_loaded=true;callback(obj.switch_list,cbparam,withSelect)}},disable_private_fields:function(){try{var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"&&a.default_user.username!=a.username){var d=["user-settings-button"];d.each(function(f){if($(f)){$(f).style.display="none"}})}}}catch(c){console.error(c)}},create_alias_for:function(a,b){if(typeof a.username=="undefined"||typeof a.alias_username=="undefined"){BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Oops! You need to tell us your desired URL"})},b);return}if(!acl.user_can("edit_user_accounts")){return}(new BF_Request()).request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias_for",username:a.username,alias_username:a.alias_username},onSuccess:function(c){BF_UserSwitcher._create_alias(c,b)},onFailure:function(c){BF_UserSwitcher._create_alias(c,b)}})},create_alias:function(c,f){if(typeof c.username=="undefined"||typeof c.display_name=="undefined"){BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Oops! You need to tell us your desired URL"})},f);return}var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"){var d=new BF_Request();if(c.self_serve==1){d.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias",username:c.username,display_name:c.display_name,default_username:a.default_user.username,default_session_key:a.default_user.session_key,self_serve:1},onSuccess:function(g){BF_UserSwitcher._create_alias(g,c.username,f)},onFailure:function(g){BF_UserSwitcher._create_alias(g,c.username,f)}})}else{d.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias",username:c.username,display_name:c.display_name,default_username:a.default_user.username,default_session_key:a.default_user.session_key},onSuccess:function(g){BF_UserSwitcher._create_alias(g,f)},onFailure:function(g){BF_UserSwitcher._create_alias(g,f)}})}}else{BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Insufficient privileges"})},f)}}else{BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"User not logged in"})},f)}},_create_alias:function(r,callback){var obj=eval("("+r.responseText+")");obj.status=r.status;callback(obj)},count_aliases:function(d){var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"){var c=new BF_Request();c.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"count_aliases",default_username:a.default_user.username,default_session_key:a.default_user.session_key},onComplete:function(f){BF_UserSwitcher._count_aliases(f,d)}})}}},_count_aliases:function(r,callback){var obj=eval("("+r.responseText+")");obj.status=r.status;callback(obj)}};if(typeof edit_post=="undefined"){BuzzLoader.register(BF_UserSwitcher.init,1)}bf_badge_vote_manager=function(){this.VOTE_CONTROLLER="/buzzfeed/_badge_vote";this.VOTE_DEFINITIONS={badge:{onSuccess:function(r){badge_vote_manager.badgeResponse(r)},parameters:{badge_id:function(t){if(t.className.match(/bf_dom/)){var json=eval("("+t.getAttribute("rel:data")+")");return json.vote.badge_id}else{return t.getAttribute("rel:badge_id")}}},success_template:'<a href="/#{username}"><strong>#{display_name}</strong></a> '+local.t('thinks #{title} is <a class="badgeword">#{badge}</a>')+'. <span class="ago">'+local.t("just now")+"</span>"},love_or_hate:{onSuccess:function(r){badge_vote_manager.loveHateResponse(r)},parameters:{value:function(t){if(t.className.match(/bf_dom/)){var json=eval("("+t.getAttribute("rel:data")+")");return json.vote.value=="loves"?1:0}else{return t.getAttribute("rel:value")=="loves"?1:0}}},success_template:'<a href="/#{username}"><strong>#{display_name}</strong></a> <span class="feed-#{loves}">&nbsp;</span> #{title}. <span class="ago">'+local.t("just now")+"</span>"}};this.initialized=false;this.initialization=false;this.badgeResponse=function(r){var json=eval("("+r.responseText+")");if($("spinner-badge")){$("spinner-badge").hide()}if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(json.success){BFW_Util.updateInfoCookie({last_active:json.last_active});if(!!window.fb_app){fb_app.badge_vote_success(json)}else{var target=$(json.element_id);var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}Event.stopObserving(target,"click",badge_vote_manager.vote);target.removeAttribute("href");$(target).up("li").addClassName("voted");if($("social-actions")){$("social-actions").fire("set:reaction")}if(json.already_voted){if(BF_STATIC.tt_page!="Video"){return badge_vote_manager._already_voted(json)}}if(BF_STATIC.tt_page!="Video"){badge_vote_manager.show_reaction_share_box(target.getAttribute("rel:badge_name"),target.getAttribute("rel:message"))}var vote_category=target.getAttribute("rel:category");var user=new BF_User();var vote_definition=badge_vote_manager.VOTE_DEFINITIONS[vote_category];var template=vote_definition.success_template;var data={username:user.getUserInfo().username,display_name:user.getUserInfo().display_name,title:decodeURIComponent(parent.getAttribute("rel:buzz_title")),uri:parent.getAttribute("rel:buzz_uri"),badge:target.getAttribute("rel:badge_name")};if(BF_STATIC.tt_page!="Video"){badge_vote_manager._add_response(template,data,{parent_class:["feed-action","feed-badge"]});badge_vote_manager._hide_social_messages();if(target.getAttribute("rel:message")){$("badge-message").update(unescape(target.getAttribute("rel:message")))}if($("social_message")){$("social_message").show();var stuffs=$("social_message").select("a")[0];if(stuffs){stuffs.setAttribute("target","_none")}}if($("number_of_contribs_header")){$("number_of_contribs_header").show()}this._update_reaction_count(target.getAttribute("rel:badge_id"));if(typeof json.earned_reactions!="undefined"){BFW_Util.updateInfoCookie({earned_reactions:json.earned_reactions})}}gtrack.trackShares(23,("numReactions_"+data.badge.toLowerCase()));gtrack.track_events("[ttp]","react/"+data.badge.toLowerCase(),"");EventManager.fire("badge_vote:success",data.badge)}}else{}};this.loveHateResponse=function(r){var json=eval("("+r.responseText+")");if($("spinner-love_or_hate")){$("spinner-love_or_hate").hide()}if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(json.success&&json.element_id){BFW_Util.updateInfoCookie({last_active:json.last_active});var target=$(json.element_id);if(target.parentNode.id.match(/(love|hate)_button-\d+/)){$(target.parentNode).show()}var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}Event.stopObserving(target,"click",badge_vote_manager.vote);if($("social-actions")){$("social-actions").fire("set:reaction")}target.removeAttribute("href");if(target.parentNode.nodeName=="LI"){$(target.parentNode).addClassName("voted")}else{if(target.parentNode.nodeName=="A"){$(target.parentNode).up().addClassName("voted")}}if(json.already_voted){return badge_vote_manager._already_voted(json)}var user=new BF_User();var vote_category=target.getAttribute("rel:category");var vote_definition=badge_vote_manager.VOTE_DEFINITIONS[vote_category];var template=vote_definition.success_template;var data={display_name:user.getUserInfo().display_name,title:decodeURIComponent(parent.getAttribute("rel:buzz_title")),uri:parent.getAttribute("rel:buzz_uri"),loves:target.getAttribute("rel:value")};var className=data.loves=="loves"?"feed-love":"feed-hate";badge_vote_manager._hide_social_messages();if(!badge_vote_manager.is_contribution(target)){var reaction=data.loves.match(/love/)?"love":"hate";badge_vote_manager.show_reaction_share_box(reaction);badge_vote_manager._add_response(template,data,{parent_class:["feed-action",className]});if($("number_of_contribs_header")){$("number_of_contribs_header").show()}this._update_reaction_count(reaction)}else{var contribution_message=$("social_message-"+parent.getAttribute("rel:buzz_id"));var vote_feedback=data.loves=="loves"?local.t("Yeah!"):local.t("Awww");contribution_message.update(vote_feedback);contribution_message.show()}}else{}};this._already_voted=function(json){badge_vote_manager._hide_social_messages();if($("share-reaction-box")){$("share-reaction-box").hide()}var target=$(json.element_id);if(badge_vote_manager.is_contribution(target)){var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var social_message=$("social_message-"+parent.getAttribute("rel:buzz_id"));if(social_message){social_message.update(local.t("Okay!"));social_message.style.width="100%";social_message.show()}}else{$("social_message-already-voted").show()}};this._add_response=function(template_str,data,args){var items={};for(var each in data){items[each]=data[each].replace(/</g,"&lt;").replace(/>/g,"&gt;")}var template=new Template(template_str);var message=template.evaluate(items);var li=new Element("li",{"class":"feed-action"});if($("contribution-list")){$("contribution-list").insert({top:li})}if(args&&args.parent_class){var classes=args.parent_class;for(var i=0;i<classes.length;i++){li.addClassName(classes[i])}}li.update(message)};this._exceeded_maximum_badge_votes=function(){if(typeof fb_app=="undefined"){var buttons=$$(".vote-badge");for(var i=0;i<buttons.length;i++){Event.stopObserving(buttons[i],"click",badge_vote_manager.vote);buttons[i].observe("click",badge_vote_manager._show_vote_exceeded)}badge_vote_manager._show_vote_exceeded()}else{if($("badge_vote_msg")){$("badge_vote_msg").update("<h4>"+local.t("Sorry")+"</h4>, <p>"+local.t("you can only react up to three times")+'.<p> <a href="javascript:;" onclick="javascript:$(\'badge_vote_msg\').hide()" class="close">&times;</a>')}if(typeof fb_app.error_msg_timeout!="undefined"){clearTimeout(fb_app.error_msg_timeout)}fb_app.error_msg_timeout=setTimeout("Effect.Fade('badge_vote_msg',{'duration':2.0})",3000)}};this._show_vote_exceeded=function(e){if(typeof e!="undefined"){e.stop()}badge_vote_manager._hide_social_messages();if($("social_message-badge-votecount-exceeded")){$("social_message-badge-votecount-exceeded").show()}};this._hide_social_messages=function(){if($("social_message-badge-votecount-exceeded")){$("social_message-badge-votecount-exceeded").hide()}if($("social_message-already-voted")){$("social_message-already-voted").hide()}if($("social_message")){$("social_message").hide()}if($("social_message-loves")){$("social_message-loves").hide()}if($("social_message-hates")){$("social_message-hates").hide()}};this.init=function(){if(badge_vote_manager.initialized){return false}if(badge_vote_manager.initialization){setTimeout(this.init.bind(this,args),300)}badge_vote_manager.initialization=true;try{bf_login.init();this.ajax=new BF_Request();if($("badge_voting")&&BF_STATIC.tt_page!="Video"){var els=$("badge_voting").getElementsByTagName("UL")[0];badge_vote_manager.earned_reactions_buttons(els)}var user=new BF_User();$$(".add-pick").each(function(el){if(user.isLoggedIn()){el.removeClassName("hidden");el.up().removeClassName("hidden")}else{el.addClassName("hidden");el.up().addClassName("hidden")}});var user_info=user.getUserInfo();if(user_info&&typeof user_info.p_disable_reaction!="undefined"&&user_info.p_disable_reaction=="true"){$$("#lovehate_buttons, #badge_voting, .lovehate-buttons").each(function(el){el.style.visibility="hidden"})}else{for(var category in badge_vote_manager.VOTE_DEFINITIONS){var divs=$$(".vote-"+category);for(var i=0;i<divs.length;i++){var div=divs[i];if(div.className.match(/bf_dom/)){continue}div.setAttribute("rel:category",category);if(!div.id){div.id="vote-"+category+"-"+parseInt(Math.random()*10000000)}div.observe("click",badge_vote_manager.vote)}}}if(0){var reaction_camera=bf_react_cam.create();var reaction_camera_post_observer={_params:null,_on_previewFromServerOk:function(evt){console.log("_on_previewFromServerOk");bf_contribute.postit(reaction_camera_post_observer._params)},_on_previewFromServerError:function(evt){console.log("_on_previewFromServerError");reaction_camera_post_observer.stop()},_on_postitComplete:function(evt){console.log("_on_postitComplete");bf_badge_popup.force_close(reaction_camera);bf_badge_popup.set_active(true);reaction_camera_post_observer.stop()},start:function(params){reaction_camera_post_observer._params=params;reaction_camera_post_observer.stop();document.observe("contribute:previewFromServerOk",this._on_previewFromServerOk);document.observe("contribute:previewFromServerError",this._on_previewFromServerError);document.observe("contribute:postitOk",this._on_postitComplete);document.observe("contribute:postitError",this._on_postitComplete)},stop:function(){document.stopObserving("contribute:previewFromServerOk",this._on_previewFromServerOk);document.stopObserving("contribute:previewFromServerError",this._on_previewFromServerError);document.stopObserving("contribute:postitOk",this._on_postitComplete);document.stopObserving("contribute:postitError",this._on_postitComplete)}};reaction_camera.add_listener("enterframe",function(frame){if(frame!=2){return}bf_badge_popup.set_master(reaction_camera)});reaction_camera.add_listener("cnt_down",function(){bf_badge_popup.set_active(false)});reaction_camera.add_listener("record_complete",function(){bf_badge_popup.set_active(true)});reaction_camera.add_listener("save",function(){bf_badge_popup.set_active(false)});reaction_camera.add_listener("save_error",function(){bf_badge_popup.set_active(true)});reaction_camera.add_listener("save_success",function(gif){var params={form:"mixedpic",reactcam:"yes",delete_images:"no",buzz_id:BF_STATIC.campaignid,url:gif.image,width:gif.width,height:gif.height};reaction_camera_post_observer.start(params);$("contribute-submit").value="Preview";$("submit-mode").value="save";var preview_params=Object.clone(params);bf_contribute.previewFromServer(preview_params)});bf_badge_popup.register(reaction_camera,$$("body")[0],"click",function(evt){if(evt&&(evt.findElement("#"+reaction_camera.id)||evt.findElement("#react_cam_button"))){return false}reaction_camera.close()});bf_badge_popup.assign(reaction_camera,$("react_cam_button"),"mouseover",function(evt){bf_react_cam.reaction_camera_open(reaction_camera)});document.observe("contribute:goforit_reactcam",function(){bf_badge_popup.force_open(reaction_camera);bf_react_cam.reaction_camera_open(reaction_camera);reaction_camera.jumpto_record()})}var target=$("filter-show_everything");if(target){target.observe("click",function(e){e.stop();if($("contribution-list")){$("contribution-list").show()}$(e.target.parentNode).addClassName("current")})}var contribs=$$(".contrib");for(var i=0;i<contribs.length;i++){var buzz_id=contribs[i].getAttribute("rel:buzz_id");if(buzz_id){contribs[i].observe("mouseout",function(e){var parent=e.target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var id="tools-"+buzz_id;if($(id)){$(id).removeClassName("selected_tools")}});contribs[i].observe("mouseover",function(e){var parent=e.target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var id="tools-"+buzz_id;if($(id)){$(id).addClassName("selected_tools")}})}}badge_vote_manager.initialized=true}catch(e){console.error(e);badge_vote_manager.initialization=false}};this.reset_sharing_box=function(){if($("social-sharing-box")){$("sharing-message").value="";$("sharing-box-caption").update("");$("sharing-box-submit").value=local.t("Post to Facebook");$("sharing-box-submit").stopObserving("click",fbtl_session.add_message);$("sharing-box-submit").stopObserving("click",badge_vote_manager.sharing_box_handler)}if($("share-reaction-box")){$("reaction-sharing-message").value="";$("reaction-share-submit").value=local.t("Share Link");$("reaction-share-submit").stopObserving("click",badge_vote_manager.sharing_box_handler)}};this.show_reaction_share_box=function(reaction,message){if($("share-reaction-box")){$("share-reaction-box").show();$("reaction-sharing-message").value="";if($("share-reaction-success-wrapper").visible()){$("share-reaction-success-wrapper").hide()}if(!$("share-reaction-content-wrapper").visible()){BF_Effect.SlideDown("share-reaction-content-wrapper")}$("reaction-share-submit").observe("click",badge_vote_manager.sharing_box_handler);if(typeof bf_rdio=="object"){var play_list=bf_rdio.fetch_rdio_buzz(reaction.toLowerCase());if(play_list&&$("share-reaction-box_title")){var rdio_message="I know, right? Now check out the Rdio <span class='react_box'>"+reaction+"</span> playlist <a onClick=\"trackPixel('http://ad.doubleclick.net/clk;267621454;93691579;z');\" href='http://buzzfeed.com"+play_list+"'>"+local.t("HERE")+"</a>";$("share-reaction-box_title").innerHTML=rdio_message}}["Nom Nom"].each(function(r){if(r==reaction&&message){$("share-reaction-box_title").innerHTML=unescape(message)}})}};this.show_sharing_box=function(target,caller){if($("social-sharing-box")){var shareBox=$("social-sharing-box");var pos=badge_vote_manager.find_position(target);if(typeof pos=="undefined"){return}var btnLeft=parseInt(pos[0]);var vote_category=target.getAttribute("rel:category");var btnTop=(vote_category&&vote_category=="badge")?parseInt(pos[1])+7:parseInt(pos[1])-1;var btn=$(target.getAttribute("id"));var btnWidth=parseInt(btn.getWidth());var shareBoxWidth=parseInt(shareBox.getWidth());var split=300;var boxLeft=btnLeft<(shareBoxWidth/2-btnWidth/2)?10:(btnLeft-(shareBoxWidth/2-btnWidth/2));shareBox.setStyle({top:(btnTop+35)+"px",left:boxLeft+"px"});var pointerHeight=10;var pointerLeft=btnLeft<(shareBoxWidth/2-btnWidth/2)?btnLeft-10+btnWidth/2:shareBoxWidth/2;pointerLeft=pointerLeft-10;$("arrowBorder").setStyle({top:-(pointerHeight)+"px",left:pointerLeft+"px",borderBottom:pointerHeight+"px solid #444"});$("arrowFill").setStyle({top:(-(pointerHeight)+2)+"px",left:pointerLeft+"px",borderBottom:pointerHeight+"px solid #F2F2F2"});if(typeof caller!="undefined"&&caller=="fbtl"){$("sharing-box-caption").update(local.t("Add a message?"));$("sharing-box-submit").value=local.t("Add A Message");$("sharing-box-submit").observe("click",fbtl_session.add_message)}else{$("sharing-box-caption").update(local.t("I know, right? Will your friends agree?"));var prefill_msg=target.getAttribute("rel:badge_name")?target.getAttribute("rel:badge_name")+"!":"";$("sharing-message").value=prefill_msg;$("sharing-box-submit").observe("click",badge_vote_manager.sharing_box_handler)}shareBox.show()}};this.find_position=function(el){var curleft=curtop=0;if(el.offsetParent){do{curleft+=el.offsetLeft;curtop+=el.offsetTop}while(el=el.offsetParent);return[curleft,curtop]}};this.sharing_box_handler=function(e){var message="";var meta_tags=document.getElementsByTagName("meta");var fields=["image","title","description","url"];var info={};if(objExists(e.target.id)){if(e.target.id="reaction-share-submit"){message=$("reaction-sharing-message").value}else{if(e.target.id="sharing-box-submit"){message=$("sharing-message").value}}}for(var i=0;i<meta_tags.length;i++){for(var j=0;j<fields.length;j++){var property="og:"+fields[j];if(meta_tags[i].getAttribute("property")==property){info[fields[j]+""]=meta_tags[i].getAttribute("content")}}}if(typeof BF_STATIC.pound_enabled!="undefined"&&BF_STATIC.pound_enabled&&!BF_STATIC.mobile_app){info.url=pound.urls.unescaped.hashAndQueryString()}var fb_args={};fb_args.description=info.description;fb_args.name=info.title;fb_args.link=info.url;fb_args.picture=info.image;fb_args.message=message;facebook.publish_to_stream(fb_args,function(){if($("social-sharing-box").visible()){$("social-sharing-box").hide()}if($("share-reaction-box")){if($("share-reaction-content-wrapper").visible()){BF_Effect.SlideUp("share-reaction-content-wrapper")}if($("share-reaction-content-wrapper").visible()){BF_Effect.SlideDown("share-reaction-success-wrapper")}}})};this.show_social_icons=function(){if(typeof(ActiveHistory)=="undefined"){return}ActiveHistory.observe("visited:digg",function(){if($("share_digg_button")){$("share_digg_button").show()}});ActiveHistory.observe("visited:twitter",function(){if($("share_twitter_button")){$("share_twitter_button").show()}});ActiveHistory.observe("visited:reddit",function(){if($("share_reddit_button")){$("share_reddit_button").show()}});ActiveHistory.observe("visited:stumbleupon",function(){if($("share_stumbleupon_button")){$("share_stumbleupon_button").show()}});ActiveHistory.observe("visited:delicious",function(){if($("share_delicious_button")){$("share_delicious_button").show()}});ActiveHistory.observe("visited:fark",function(){if($("share_fark_button")){$("share_fark_button").show()}})};this.vote=function(e){e.stop();var user=new BF_User();var target;if(e.target.nodeName=="SPAN"){target=e.target.up()}else{target=e.target}if(typeof fb_app!="undefined"){var badge_name=target.getAttribute("rel:badge_name");fb_app.show_bubble(badge_name);if(!fb_app.session||!fb_app.bf_user_info){fb_app.log_into_buzzfeed()}else{badge_vote_manager._vote(target)}}else{if(user.isLoggedIn()){var fb_vote_prompt=readCookie("fb-vote-prompt");(target.up(".contrib"))?badge_vote_manager._comment_vote(target):badge_vote_manager._vote(target)}else{var ev=target.fire("click");ev.signin_type="initial";ev.mode="badges";ev.location="reaction";ev.reg_params="";var category=target.getAttribute("rel:category");if(category=="love_or_hate"){ev.reg_params="c1&v"+(target.getAttribute("rel:value")=="loves"?1:0)+"&i"+target.id.substr(18)}else{gtrack.track_events("[ttp]","react/"+target.getAttribute("rel:badge_name").toLowerCase()+"/not-signed-in","");ev.reg_params="c&v"+target.getAttribute("rel:badge_id")+"&i"+target.id.substr(11)}var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}ev.reg_params+="&b"+parent.getAttribute("rel:buzz_id")+"&l"+parent.getAttribute("rel:buzz_uri");if(typeof BF_STATIC!="undefined"&&typeof BF_STATIC.country!="undefined"){ev.reg_params+="&u"+BF_STATIC.country}badge_vote_manager.onRegister=function(obj,json){badge_vote_manager.onRegister=null};signin.callbacks.onRegister.push(function(obj,json){if(badge_vote_manager.onRegister){badge_vote_manager.onRegister(obj,json)}});bf_login.loggedInCallbacks=[];bf_login.loggedInCallbacks.push(function(){badge_vote_manager.initialized=true;badge_vote_manager.vote_by_id(target.up("li").id)});signin.open(ev)}}EventManager.fire("badge_vote:vote_init",target.getAttribute("rel:badge_name"))};this.vote_by_id=function(elem){var are_we_ready=(typeof universal_dom!="undefined"&&badge_vote_manager.initialized&&$$("#"+elem+" a").length);if(are_we_ready){var ev=$$("#"+elem+" a")[0].fire("click");badge_vote_manager.vote(ev)}else{setTimeout(badge_vote_manager.vote_by_id.bind(this,elem),500)}};this._comment_vote=function(target){var vote_category=target.getAttribute("rel:category");if(!vote_category){if(target.up("a")){target=target.up("a");vote_category=target.getAttribute("rel:category");if(!vote_category){return}}}Event.stopObserving(target,"click",badge_vote_manager.vote);var id=target.up(".contrib").getAttribute("rel:comment_id");var vote=target.getAttribute("rel:value");var params={action:"comment_vote",comment_id:id,badge_name:vote};var ajax=new BF_Request();ajax.request(this.VOTE_CONTROLLER,{method:"get",parameters:params});var vote_number=parseInt(target.down(".count").innerHTML);if(vote_number>=0){target.down(".count").innerHTML=vote_number+1}};this._vote=function(target){var vote_category=target.getAttribute("rel:category");if(!vote_category){return}var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(vote_category=="badge"){if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={};_badge_votes_so_far[buzz_id]={}}else{if(typeof _badge_votes_so_far[buzz_id]=="undefined"){_badge_votes_so_far[buzz_id]={}}}var user=new BF_User();var user_info=user.getUserInfo();if(typeof _badge_votes_so_far!="undefined"){if(typeof _badge_votes_so_far[""+buzz_id][user_info.username]=="undefined"){_badge_votes_so_far[""+buzz_id][user_info.username]=1}else{_badge_votes_so_far[""+buzz_id][user_info.username]+=1}if(_badge_votes_so_far[""+buzz_id][user_info.username]>=4){return badge_vote_manager._exceeded_maximum_badge_votes()}}}if(badge_vote_manager.is_contribution(target)){$("love_button-"+parent.getAttribute("rel:buzz_id")).hide();$("hate_button-"+parent.getAttribute("rel:buzz_id")).hide();$("social_message-"+parent.getAttribute("rel:buzz_id")).hide();badge_vote_manager._spinner=$("spinner-"+parent.getAttribute("rel:buzz_id"));$(badge_vote_manager._spinner).style.width="100%";$(badge_vote_manager._spinner).show()}else{if($("spinner-"+vote_category)){$("spinner-"+vote_category).show()}}var vote_definition=this.VOTE_DEFINITIONS[vote_category];if(!vote_definition){return}bf_reactions.grow_up_css(target);var params={action:"vote",element_id:target.id,category:vote_category,uri:"/"+parent.getAttribute("rel:buzz_uri"),buzz_id:parent.getAttribute("rel:buzz_id")};for(var each in vote_definition.parameters){params[each]=vote_definition.parameters[each](target)}var ajax=new BF_Request();ajax.request(this.VOTE_CONTROLLER,{method:"get",parameters:params,onSuccess:vote_definition.onSuccess});if(vote_category=="badge"&&target.getAttribute("rel:badge_type")!="earned"){if(typeof _badge_votes_so_far=="undefined"||_badge_votes_so_far[""+buzz_id][user_info.username]<2){var action="react";var article_url=window.location.toString().replace(/\?.*/i,"");if(BF_STATIC.bf_env!="live"){article_url=article_url.replace(/\/\/(stage(\d+)?|dev)\./i,"//www.").replace("/bf2/","/")}var badge_uri=target.getAttribute("rel:badge_uri");var objs={article:article_url,badge:"http://www.buzzfeed.com/badge/"+badge_uri};try{if(typeof(FB)!="undefined"){fbtl_session.trigger(action,objs)}}catch(e){console.error(e)}}}(new BF_Targetting_Pixel()).add("badge_reaction")};this.simple_love_vote=function(uri,buzz_id){var vote_definition=this.VOTE_DEFINITIONS.love_or_hate;var params={action:"vote",buzz_id:buzz_id,category:"love_or_hate",uri:uri,value:1};var ajax=new BF_Request();ajax.request(this.VOTE_CONTROLLER,{method:"get",parameters:params,onSuccess:vote_definition.onSuccess})};this.is_contribution=function(target){var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}return parent.parentNode.className.match(/contribution-lovehate-buttons/)};this._update_reaction_count=function(id_prefix){return false;var id=id_prefix+"-reaction-count";var count=$(id).innerHTML.replace(/\s+/g,"");var count=parseInt(count);if(!isNaN(count)){count++;$(id).update(count)}};this.find_parent=function(tag,el){if(el.tagName.toLowerCase()==tag.toLowerCase()){return el}else{if(el.parentNode!=null){return badge_vote_manager.find_parent(tag,el.parentNode)}else{return console.warn("no "+tag+" found in DOM")}}};this.earned_reactions_buttons=function(target){if(local.non_english){return false}try{var btn_template=new Template('<li id="#{name}_button" class="reaction #{name}"> <a id="vote-badge-#{rand}" class="btn-reaction vote-badge" rel:badge_type="earned" rel:badge_name="#{title}" rel:badge_id="#{badge_id}" rel:message="<b>'+local.t("I know, right?")+"</b> <span class=#{infinite}>"+local.t("You have #{remaining_less_one} of these babies left, use #{itslashthem} wisely")+"...</span><span class=#{none_left}>"+local.t("That was your last #{title} reaction. Go earn some more!")+'</span>"> #{title} <span class="earned-remaining">#{remaining}</span></a> <span id="#{badge_id}-reaction-count" class="badge-vote-count zero"></span> </li>');var str=(new BF_User()).getUserInfo().earned_reactions;var show_reactions=false;if(str&&target){var earned_reactions=eval("("+str+")");for(var reaction in earned_reactions){if(!earned_reactions.hasOwnProperty(reaction)||earned_reactions[reaction].remaining==0){continue}var name=reaction.toLowerCase().replace("[^a-zA-Z]","");if(typeof name==="undefined"||name==""){continue}var params={name:name,rand:parseInt(Math.random()*1000)+(new Date()).getTime(),title:reaction,remaining:earned_reactions[reaction].remaining==-1?"":" "+earned_reactions[reaction].remaining+"",badge_id:earned_reactions[reaction].badge_id};params.remaining_less_one=earned_reactions[reaction].remaining-1;params.infinite=params.remaining_less_one<1?"hidden":"";params.none_left=params.remaining_less_one==0?"":"hidden";params.itslashthem=params.remaining_less_one==1?"it":"them";var html=btn_template.evaluate(params);target.insert(html);show_reactions=true}if(show_reactions){$s(".reactions_container.special").show();$$(".special-reactions").each(function(el){el.show()});var options={el:$s(".reactions_slider.special"),reactions_class:"reaction"};new BF_Reactions_Slider(options)}}}catch(e){console.error(e)}}};badge_vote_manager=new bf_badge_vote_manager();badge_vote_manager.show_social_icons();BuzzLoader.register(function(){badge_vote_manager.init()},6);bf_user_reaction=function(){var reaction_url="/buzzfeed/_badge_vote";var reaction_message={success_voted:local.t("Thanks for your vote!"),already_voted:"<span>"+local.t("Oops")+".</span> "+local.t("It looks like you've already voted")+".",reaction_count_exceeded:"<span>"+local.t("Sorry")+"</span>, "+local.t("you can only react up to three times")+"."};var _this=this;this.init=function(){var user=new BF_User();$$(".user-reaction").each(function(cont,index){if(user.isLoggedIn()){cont.removeClassName("hide-user-reaction")}cont.select(".reaction-btn").each(function(element,index2){element.observe("click",_this.add_reaction)})});universal_dom.assign_handler({bucket:"fb-share",handler:bf_user_reaction.buzz_share,event:"click"});universal_dom.assign_handler({bucket:"tw-share",handler:bf_user_reaction.buzz_share,event:"click"});universal_dom.assign_handler({bucket:"pin-share",handler:bf_user_reaction.buzz_share,event:"click"})};this.buzz_share=function(obj){var parent=$("user-reaction-social-"+obj.id);if(!parent){return}var title=encodeURIComponent(parent.getAttribute("rel:title"));var host=BF_STATIC.bf_env!="live"?"http://stage.buzzfeed.com/":"http://www.buzzfeed.com/";var url=encodeURIComponent(host+parent.getAttribute("rel:link"));var thumb=encodeURIComponent(BF_STATIC.image_root+parent.getAttribute("rel:thumb"));var twitter_url="https://twitter.com/intent/tweet?text="+title+"&url="+url;if(BF_STATIC.tt_page="Community"){twitter_url=twitter_url+"&via=buzzfeeders"}if(obj.element.hasClassName("buzz-facebook-share")){window.open("http://facebook.com/sharer/sharer.php?s=100&p[url]="+url+"&p[title]="+title+"&p[images][0]="+thumb,"_blank","width=600, height=260")}else{if(obj.element.hasClassName("buzz-twitter-share")){window.open(twitter_url,"_blank","width=600,height=400")}else{if(obj.element.hasClassName("buzz-pinterest-share")){window.open("http://pinterest.com/pin/create/button/?media="+thumb+"&url="+url+"&description="+title,"_blank","width=600,height=400")}}}};this.add_reaction=function(el){var target=el.target;if(target.hasClassName("icon")){target=target.parentNode}var reaction_wrap=_this.get_reaction_wrap(target);_this.hide_all_reaction_messages(target);var reaction_params={action:"vote",element_id:target.id,category:target.getAttribute("rel:category"),buzz_id:reaction_wrap.getAttribute("rel:buzz_id"),uri:"/"+reaction_wrap.getAttribute("rel:buzz_uri")};if(target.getAttribute("rel:category")=="badge"&&!_this.is_reaction_available(reaction_wrap.getAttribute("rel:buzz_id"))){_this.show_reaction_message(target,"reaction_count_exceeded");return false}if(target.getAttribute("rel:badge_id")){reaction_params.badge_id=target.getAttribute("rel:badge_id")}if(target.getAttribute("rel:value")){reaction_params.value=target.getAttribute("rel:value")=="loves"?"1":(target.getAttribute("rel:value")=="hates"?"0":target.getAttribute("rel:value"))}var user=new BF_User();if(!user.isLoggedIn()){var t={signin_type:"initial",mode:"badges",location:"reactions"};t.reg_params="";if(reaction_params.category=="love_or_hate"){t.reg_params="c1&v"+reaction_params.value+"&i"+reaction_params.element_id.substr(18)}else{t.reg_params="c&v"+reaction_params.badge_id+"&i"+reaction_params.element_id.substr(11)}t.reg_params+="&b"+reaction_params.buzz_id+"&l"+reaction_params.uri;if(typeof BF_STATIC!="undefined"&&typeof BF_STATIC.country!="undefined"){t.reg_params+="&u"+BF_STATIC.country}bf_login.loggedInCallbacks.push(function(){_this.send_react_request(reaction_params);_this.show_reaction_loading(target)});signin.open(t);return false}_this.send_react_request(reaction_params);_this.show_reaction_loading(target);(new BF_Targetting_Pixel()).add("badge_reaction")};this.vote_by_id=function(elem){$$("#"+elem+" a")[0].scrollIntoView();var ev=$$("#"+elem+" a")[0].fire("click");bf_user_reaction.add_reaction(ev)};this.send_react_request=function(reaction_params){var ajax=new BF_Request();ajax.request(reaction_url,{method:"get",parameters:reaction_params,onSuccess:_this.add_reaction_success})};this.is_reaction_available=function(buzz_id){var user=new BF_User();var user_info=user.getUserInfo();if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={}}if(typeof _badge_votes_so_far[buzz_id]=="undefined"){_badge_votes_so_far[buzz_id]={}}if(typeof _badge_votes_so_far[buzz_id][user_info.username]=="undefined"){_badge_votes_so_far[buzz_id][user_info.username]=1;return true}else{if(_badge_votes_so_far[buzz_id][user_info.username]>=3){return false}_badge_votes_so_far[buzz_id][user_info.username]+=1;return true}};this.add_reaction_success=function(response){var json=eval("("+response.responseText+")");if(json.success){$(json.element_id).stopObserving("click",_this.add_reaction);$(json.element_id).addClassName("already-reacted");_this.hide_reaction_loading($(json.element_id));if(json.already_voted){_this.show_reaction_message($(json.element_id),"already_voted")}else{_this.show_reaction_message($(json.element_id),"success_voted")}}else{}};this.get_reaction_wrap=function(el){var reaction_wrap=el;while(reaction_wrap.parentNode&&!reaction_wrap.hasClassName("user-reaction")){reaction_wrap=reaction_wrap.parentNode}return reaction_wrap};this.show_reaction_loading=function(el){var reaction_wrap=_this.get_reaction_wrap(el);if(!reaction_wrap.select(".reaction-loading").length){reaction_wrap.insert('<div class="reaction-loading" style="display:none;">'+local.t("Saving")+"...</div>")}reaction_wrap.select(".reaction-loading")[0].show()};this.hide_reaction_loading=function(el){var reaction_wrap=_this.get_reaction_wrap(el);if(reaction_wrap.select(".reaction-loading").length){reaction_wrap.select(".reaction-loading")[0].hide()}};this.show_reaction_message=function(el,message_key){var reaction_wrap=_this.get_reaction_wrap(el);if(!reaction_wrap.select(".reaction-message-"+message_key).length){reaction_wrap.insert('<div class="reaction-message reaction-message-'+message_key+'" style="display:none;">'+reaction_message[message_key]+"</div>")}reaction_wrap.select(".reaction-message-"+message_key)[0].show()};this.hide_all_reaction_messages=function(el){var reaction_wrap=_this.get_reaction_wrap(el);if(reaction_wrap.select(".reaction-message").length){reaction_wrap.select(".reaction-message").each(function(element,index){element.hide()})}}};bf_user_reaction=new bf_user_reaction();BuzzLoader.register(function(){bf_user_reaction.init()},2);var BF_MAX_UPLOAD=1024*1024*2;var BF_MAX_UPLOAD_TEXT="2 megabytes";var BF_MAX_UPLOAD_PROFILE=1024*1024*1;var BF_MAX_UPLOAD_PROFILE_TEXT="1 megabyte";BF_IMAGE_CROPPER=Class.create({template:'		<div class="cropperbody #{cropper_class}">			<div class="content">				#{uploader_template}				<div id="cropper_container">					<div class="container"><img id="image" src="'+trans_gif_1x1_base64+'" class="hidden" /></div>					#{preview_template}					#{thumbs_template}				</div>			</div>			<div class="bf_dialog_footer">				<ul>					<li id="save-button">						<button id="save-image" class="hidden bf_button bf_submit">Save</button>						<button id="preview-thumbs" class="hidden bf_button bf_submit">Save</button>						<button id="approve-thumbs" class="hidden bf_button bf_submit">Looks Good!</button>					</li>					<li><input id="image-cancel" type="button" class="bf_button grey" value="Cancel" /></li>				</ul>			</div>		</div>',preview_template:'<div id="preview" class="preview hidden"></div>',uploader_template:'		<div id="uploader_container">			<p class="upload-desc">Select an image to use for your post. After uploading you\'ll be able to crop and resize your thumbnail image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<img id="ul-spinner" src="#{static_root}/images/public/spinners/big_on_eee.gif" width="48" height="48" />			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<fieldset>				<div>Thumbnail</div>				<div id="result" class="results"><div class="scroller"><img id="result-image" rel:width="300" rel:height="45" />&nbsp;</div></div>				<button id="crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>		</div>',setDefaults:function(){},fitToScreen:function(){},initialize:function(b){try{var a=this;this.options={cropper_class:"",fitImageAndScreen:false,showThumbs:true,showPreview:true,showCropper:true,minHeight:null,minWidth:null,enforceMin:false,maxHeight:null,maxWidth:null,enforceMax:false,modalIsParent:false,controller:"/bfcgi/_edit_quickpost_image",session_key:BFW_Util.getCookie(BFW_COOKIE),action:"imageupload"};Object.extend(this.options,b);this.uploader_params={session_key:this.options.session_key,action:this.options.action};this.regions={"default":false};this.setDefaults();this.container=$(b.container);this.container.update((new Template(this.template)).evaluate({cropper_class:this.options.cropper_class,static_root:BF_STATIC.static_root,uploader_template:(new Template(this.uploader_template)).evaluate({static_root:BF_STATIC.static_root}),preview_template:(new Template(this.preview_template)).evaluate({static_root:BF_STATIC.static_root}),thumbs_template:(new Template(this.thumbs_template)).evaluate({static_root:BF_STATIC.static_root})}));if(this.options.modalIsParent){this.container=$(this.container.parentNode)}this.uploader_container=$$("#"+this.container.id+" #uploader_container")[0];this.cropper_container=$$("#"+this.container.id+" #cropper_container")[0];this.cropper_instance=null;this.preview_button=$$("#"+this.container.id+" #preview-thumbs")[0];this.approve_button=$$("#"+this.container.id+" #approve-thumbs")[0];this.save_button=$$("#"+this.container.id+" #save-image")[0];this.cancel_button=$$("#"+this.container.id+" #image-cancel")[0];this.uploader_element=$$("#"+this.container.id+" #uploader")[0];this.image_element=$$("#"+this.container.id+" #image")[0];this.preview_button.observe("click",this.preview_image.bind(this));this.approve_button.stopObserving("click");this.approve_button.observe("click",this.approve_image.bind(this));this.save_button.observe("click",this.save_image.bind(this));this.cancel_button.observe("click",this.cancel_image.bind(this));this.error_title="";this.error_message="";this.init_uploader();this.cropper_container.addClassName("hidden");this.uploader_container.select(".upload-error, upload-status").each(function(d){d.addClassName("hidden")});$("uploader").removeClassName("hidden");if(this.options.image_data){this.onComplete(0,b.image_data.image,b.image_data)}}catch(c){this.close();alert("Unknown error occured. Please try again later.");console.dir(c);console.trace()}},preview_image:function(){try{this.container.scrollTo();this.container.removeClassName("upload").removeClassName("crop").addClassName("thumbs");this.cropper_container.select(".container")[0].addClassName("hidden");$("thumbs").removeClassName("hidden");if(this.options.showThumbs){this.approve_button.removeClassName("hidden")}else{this.save_button.removeClassName("hidden")}this.preview_button.addClassName("hidden");this.show_thumbs()}catch(a){console.error(a)}},show_thumbs:function(){var a=this;var b=this.image_element;$("result-image").each(function(h){var i=a.regions["default"];h.up(".scroller").style.width=h.getAttribute("rel:width")+"px";h.up(".scroller").style.height=h.getAttribute("rel:height")+"px";var d=h.getAttribute("rel:width")*1;var j=h.getAttribute("rel:height")*1;var f=Math.round(a.image_data.width*d/i.width);var c=Math.round(i.left*d/i.width);var k=Math.round(j*i.top/i.height);h.src=b.src;h.style.margin="-"+k+"px 0 0 -"+c+"px";h.style.width=f+"px";var g=h.up("fieldset").select("button")[0];g.stopObserving("click");g.observe("click",function(){$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(a))})},approve_image:function(a){},save_image:function(a){},cancel_image:function(a){a.stop()},init_uploader:function(){try{this.uploader=new qq.FileUploader({sendAsForm:true,element:this.uploader_element,action:this.options.controller,allowedExtensions:["jpg","jpeg","png","gif"],sizeLimit:BF_MAX_UPLOAD,params:this.uploader_params,onValidate:this.onValidate.bind(this),onProgress:this.onProgress.bind(this),onError:this.onError.bind(this),onComplete:this.onComplete.bind(this)})}catch(a){console.error(a)}},check_image:function(a){try{if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="Small image";b.select(".cerror-message")[0].innerHTML=this.error_message="This image is too small, we need at least "+this.options.minWidth+"x"+this.options.minHeight;return false}return true}catch(c){console.error(c)}},init_cropper:function(){try{this.container.scrollTo();this.cropper_container.select(".container")[0].removeClassName("hidden");if(this.options.showThumbs){this.preview_button.removeClassName("hidden")}else{this.save_button.removeClassName("hidden")}if(this.cropper_instance){this.cropper_instance.remove();delete this.cropper_instance}var c={x1:0,y1:0,x2:this.options.minWidth,y2:this.options.minHeight};var b={autoIncludeCSS:true,displayOnInit:true,onloadCoords:c,ratioDim:{x:this.options.minWidth,y:this.options.minHeight},minWidth:this.options.minWidth,minHeight:this.options.minHeight,maxWidth:this.options.maxWidth,maxHeight:this.options.maxHeight,onEndCrop:this.crop_done.bind(this),captureKeys:false};if(this.options.ratioDim){b.ratioDim=this.options.ratioDim}this.customize_cropper(b);this.cropper_instance=new Cropper.Img(this.image_element,b);if(this.options.fitImageAndScreen){this.fitToScreen()}if($(this.container).down("#image")!==this.cropper_instance.img){this.close();(new BF_Request()).alert("Error: Unknown error occurred.<br>Please save your work, reload page and try upload image again.")}}catch(a){console.dir(a);console.trace()}},customize_cropper:function(b){try{var c=b.onloadCoords;if(this.regions["default"]){c.x1=this.regions["default"].left;c.y1=this.regions["default"].top;c.x2=this.regions["default"].left+this.regions["default"].width;c.y2=this.regions["default"].top+this.regions["default"].height}b.onloadCoords=c}catch(a){console.error(a)}},crop_default_size:function(){},crop_done:function(b,a){try{this.regions["default"]={top:b.y1,left:b.x1,height:b.y2-b.y1,width:b.x2-b.x1,image:this.image_element.src}}catch(c){console.error(c)}},onValidate:function(a){try{var d=this.uploader_container.select(".upload-error")[0];if(a.size>BF_MAX_UPLOAD){d.removeClassName("hidden");d.select(".error-title")[0].innerHTML="Too big file";d.select(".cerror-message")[0].innerHTML="Max image upload size is "+BF_MAX_UPLOAD_TEXT}else{$("uploader").addClassName("hidden");d.addClassName("hidden");var c=this.container.select(".upload-status")[0];c.removeClassName("hidden");var c=this.uploader_container.select(".upload-status div.red")[0];c.style.width="0px"}}catch(b){console.error(b)}},onProgress:function(a,d,f,c){try{var g=f;var j=c;var i=Math.round((g/j)*100);var b=this.uploader_container.select(".upload-status div.red")[0];b.style.width=(this.uploader_container.select(".upload-status div.text")[0].getWidth()/100*i)+"px"}catch(h){}},onError:function(f,d,a){$("uploader").removeClassName("hidden");var c="A critical error occurred while trying to upload the picture. Please try again in a few minutes.";if(a){c=a}var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML="Error occured";b.select(".cerror-message")[0].innerHTML=c},onComplete:function(h,g,f){try{this.container.removeClassName("thumbs").removeClassName("upload").addClassName("crop");this.uploader_container.select(".upload-status")[0].addClassName("hidden");this.uploader_element.removeClassName("hidden");this.image_data=f;if(!this.check_image(this.image_data)){if(this.options.callbacks&&this.options.callbacks.image_error){this.options.callbacks.image_error(this.error_title,this.error_message)}return false}else{if(f.scale){f.width*=f.scale;f.height*=f.scale;this.options.minWidth*=f.scale;this.options.minHeight*=f.scale}this.uploader_container.addClassName("hidden");this.cropper_container.removeClassName("hidden");var d=this.image_element;if(Prototype.Browser.IE){var a=this;d.onload=function(){setTimeout(function(){a.image_element.onload=null;a.image_element.src=a.image_element.src},500)}}d.src=bf_ir+this.image_data.image+"?"+(new Date).getTime();d.width=this.image_data.width;d.height=this.image_data.height;d.removeClassName("hidden");if(!this.options.showCropper){this.crop_default_size()}else{if(f.crop_data){for(var c in f.crop_data){this.regions[c]=f.crop_data[c];this["manual_"+c]=true}this.preview_image()}else{if(Prototype.Browser.IE){setTimeout(function(){this.init_cropper()}.bind(this),1000)}else{this.init_cropper()}}}}}catch(b){console.error(b)}},close:function(){BF_UI.closeDialog("user-image-edit");BF_UI.closeDialog("super-image-edit");BF_UI.closeDialog("modal-super-image-edit");if(this.preview_button){this.preview_button.addClassName("hidden")}if(this.save_button){this.save_button.addClassName("hidden")}if(this.approve_button){this.approve_button.addClassName("hidden")}}});BF_SETTINGS_CROPPER=Class.create(BF_IMAGE_CROPPER,{uploader_template:'		<div id="uploader_container">			<div class="upload-title">Upload an Image</div>			<p class="upload-desc">Select an image to use for your profile. After uploading you\'ll be able to crop and resize your image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<img id="ul-spinner" src="#{static_root}/images/public/spinners/big_on_eee.gif" width="48" height="48" />			</div>		</div>',preview_template:'		<div id="preview" class="preview">			<div class="scroller"><img id="result-image" rel:width="83" rel:height="83" />&nbsp;</div>		</div>',setDefaults:function(){var a={cropper_class:"settings",showThumbs:false,showPreview:true,showCropper:true,minWidth:83,minHeight:83};if(this.options.origin=="custom_user_header"||this.options.origin=="custom_user_channel_header"||this.options.origin=="bgimage"){a.showCropper=false}Object.extend(this.options,a);this.uploader_params={session_key:this.options.session_key,action:this.options.action,origin:this.options.origin};BF_MAX_UPLOAD=BF_MAX_UPLOAD_PROFILE;BF_MAX_UPLOAD_TEXT=BF_MAX_UPLOAD_PROFILE_TEXT},cancel_image:function(a){this.close()},save_image:function(){var a=this.regions["default"];this.options.callbacks.save_image_callback(this.image_data.image,this.image_data.name,a,null,this.options.origin);this.close()},crop_done:function(h,a){try{this.regions["default"]={top:h.y1,left:h.x1,height:h.y2-h.y1,width:h.x2-h.x1,image:this.image_element.src};var g=this.regions["default"];var b=$("result-image");b.up(".scroller").style.width=b.getAttribute("rel:width")+"px";b.up(".scroller").style.height=b.getAttribute("rel:height")+"px";var k=b.getAttribute("rel:width")*1;var c=b.getAttribute("rel:height")*1;var j=Math.round(this.image_data.width*k/g.width);var i=Math.round(g.left*k/g.width);var f=Math.round(c*g.top/g.height);b.src=this.image_element.src;b.style.margin="-"+f+"px 0 0 -"+i+"px";b.style.width=j+"px"}catch(d){console.error("If in IE - deal with it. "+d)}},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(!a.uploaded||this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="Small image";var c="This image is too small, we need at least "+this.options.minWidth+"x"+this.options.minHeight;if(!a.uploaded){c=a.message}b.select(".cerror-message")[0].innerHTML=this.error_message=c;return false}return true},crop_default_size:function(){this.regions["default"]={top:0,left:0,width:this.image_data.width,height:this.image_data.height};this.save_image()}});BF_SUPERPOST_CROPPER=Class.create(BF_IMAGE_CROPPER,{template:'		#{uploader_template}		<div id="cropper_container">			<div class="container"><img id="image" src="'+trans_gif_1x1_base64+'" class="hidden" /></div>			#{preview_template}			#{thumbs_template}		</div>',uploader_template:'		<div id="uploader_container">			<div class="upload-title hidden">Upload an Image</div>			<p class="upload-desc hidden">Select an image to use for your post. After uploading you&rsquo;ll be able to crop and resize your thumbnail image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<img id="ul-spinner" src="#{static_root}/images/public/spinners/big_on_eee.gif" width="48" height="48" />			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<div class="thumbs-left">				<fieldset class="normal-result">					<div class="result-header">Normal Thumbnails</div>					<div id="normal-result" class="results"><div class="scroller"><img id="normal-result-image" rel:width="125" rel:height="83" />&nbsp;</div></div>					<div id="small-result" class="results"><div class="scroller"><img id="small-result-image" rel:width="90" rel:height="60" />&nbsp;</div></div>					<button id="crop-thumb" class="bf_button">Re-crop</button>				</fieldset>				<fieldset class="wide-result">					<div class="result-header">Wide Thumbnail</div>					<div id="wide-result" class="results"><div class="scroller"><img id="wide-result-image" rel:width="355" rel:height="125" />&nbsp;</div></div>					<button id="wide-crop-thumb" class="bf_button">Re-crop</button>				</fieldset>			</div>			<div class="thumbs-right">				<fieldset class="big-result">					<div class="result-header">Big Thumbnail</div>					<div id="big-result" class="results"><div class="scroller"><img id="big-result-image" rel:width="355" rel:height="236" />&nbsp;</div></div>					<button id="big-crop-thumb" class="bf_button">Re-crop</button>				</fieldset>			</div>		</div>',setDefaults:function(){var a={cropper_class:"",fitImageAndScreen:true,modalIsParent:true,minWidth:625,minHeight:415};this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=355;this.wide_height=125;this.big_width=355;this.big_height=236;this.thumb_width=125;this.thumb_height=83;this.fitToScreenOuter=this.fitToScreen.bind(this);Event.stopObserving(window,"resize",this.fitToScreenOuter);Event.observe(window,"resize",this.fitToScreenOuter);Object.extend(this.options,a)},fitToScreen:function(){var l=$("modal-super-image-edit-container");if($$("#cropper_container .container")[0].hasClassName("hidden")){l.setStyle({width:""});l.setStyle({height:""});this.container.setStyle({width:""});this.container.setStyle({height:""})}else{var g=document.documentElement.clientWidth,a=document.documentElement.clientHeight,d=this.image_data.width,m=this.image_data.height,n=parseInt(this.container.getStyle("width")),h=parseInt(this.container.getStyle("height")),c=20,j=20,i=50,f=150;if(typeof this.ctw=="undefined"){this.ctw=n;this.cth=h}else{n=this.ctw;h=this.cth}var k=(a-j);if(k<500){k=500}if(k-f-j>m){k=m+f+j}var b=(g-c);if(b<400){b=400}if(h<k&&n<b){return}if(h>k){l.setStyle({height:(k-f)+"px"});this.container.setStyle({height:k+"px"})}if(n>b){l.setStyle({width:(b-i)>1064-i?1064-i:(b-i)+"px"});this.container.setStyle({width:b>1064?1064:b+"px"})}}},cancel_image:function(a){if(typeof superlist!="undefined"){superlist.redisplayPreviewIfNecessary()}$$("#parent-buzz-uploader .qq-upload-list > li").each(function(b){b.remove()});this.close();Event.stopObserving(window,"resize",this.fitToScreenOuter);if(typeof superlist!="undefined"){top.superlist.redisplayPreviewIfNecessary()}},approve_image:function(f){var g=this.regions.thumb;if(this.regions.wide){var a=this.regions.wide;g.wide_height=a.height;g.wide_width=a.width;g.wide_top=a.top;g.wide_left=a.left}if(this.regions.big){var d=this.regions.big;g.big_height=d.height;g.big_width=d.width;g.big_top=d.top;g.big_left=d.left}if("image_data" in this&&typeof(this.image_data.scale)!="undefined"){g.scale=this.image_data.scale}bf_boost_manager.save_image(this.image_data.image,this.image_data.name,g,"/buzzfeed/_edit_quickpost_image");var c=$("buzz-type");var b=(c)?c.value:"text";if(typeof this.options.callbacks!="undefined"&&typeof this.options.callbacks.finish_save_image!="undefined"){this.options.callbacks.finish_save_image(b,this)}else{user_post.save_quickpost_image(b,this)}if(top.$("original_image_crop_data")){top.$("original_image_crop_data").value=Object.toJSON(this.regions)}$$("#parent-buzz-uploader .qq-upload-list > li").each(function(h){h.remove()});Event.stopObserving(window,"resize",this.fitToScreenOuter)},customize_cropper:function(f){var g=f.onloadCoords;if(this.regions[this.current_cropping_region]){g.x1=this.regions[this.current_cropping_region].left;g.y1=this.regions[this.current_cropping_region].top;g.x2=this.regions[this.current_cropping_region].left+this.regions[this.current_cropping_region].width;g.y2=this.regions[this.current_cropping_region].top+this.regions[this.current_cropping_region].height;f.minWidth=this[this.current_cropping_region+"_width"];f.minHeight=this[this.current_cropping_region+"_height"];f.ratioDim={x:this[this.current_cropping_region+"_width"],y:this[this.current_cropping_region+"_height"]}}else{var a=this.image_data;var b=a.width/this.options.minWidth;var d=a.height/this.options.minHeight;var c=Math.min(b,d);g.x2=this.options.minWidth*c;g.y2=this.options.minHeight*c}f.onloadCoords=g},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";b.select(".cerror-message")[0].innerHTML=this.error_message="We need an image at least 625 x 415 pixels. That's as big as the box this message is in! Choose another one below, or hit cancel to try again.";return false}return true},crop_default_size:function(){this.regions.thumb={top:0,left:0,height:this.options.minHeight,width:this.options.minWidth};this.auto_big();this.auto_wide();this.approve_image()},crop_done:function(b,a){this.regions[this.current_cropping_region]={top:b.y1,left:b.x1,height:parseInt(b.y2-b.y1),width:parseInt(b.x2-b.x1),image:this.image_element.src}},auto_big:function(){var b=this.regions.thumb;var a={top:b.top,left:b.left,height:b.height,width:b.width};if(b.width<this.big_width){a.width=this.big_width;a.height=this.big_height;a.top=(b.top-parseInt((a.height-b.height)/2));a.left=(b.left-parseInt((a.width-b.width)/2));if(a.top<0){a.top=0}if(a.left<0){a.left=0}if((a.top+a.height)>this.image_data.height){a.top=this.image_data.height-a.height}if((a.left+a.width)>this.image_data.width){a.left=this.image_data.width-a.width}}this.regions.big=a},auto_wide:function(){var a=this.regions.big;var b={top:a.top,left:a.left,height:a.height,width:a.width};b.top=a.top+parseInt(a.height/3);b.height=parseInt((this.wide_height*a.width)/this.wide_width);this.regions.wide=b},show_thumbs:function(){var b=this;var c=this.image_element;if(!this.manual_big){this.auto_big()}if(!this.manual_wide){this.auto_wide()}this.cropper_container.select("#big-result-image, #wide-result-image").each(function(i){var j;if(i.id=="wide-result-image"){j=b.regions.wide}else{if(i.id=="big-result-image"){j=b.regions.big}}i.up(".scroller").style.width=i.getAttribute("rel:width")+"px";i.up(".scroller").style.height=i.getAttribute("rel:height")+"px";var f=i.getAttribute("rel:width")*1;var k=i.getAttribute("rel:height")*1;var g=Math.round(b.image_data.width*f/j.width);var d=Math.round(j.left*f/j.width);var l=Math.round(k*j.top/j.height);i.src=c.src;i.style.margin="-"+l+"px 0 0 -"+d+"px";i.style.width=g+"px";var h=i.up("fieldset").select("button")[0];h.stopObserving("click");h.observe("click",function(m){if(m.target.id=="big-crop-thumb"){this.manual_big=true;this.current_cropping_region="big"}else{this.manual_wide=true;this.current_cropping_region="wide"}$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(b))});this.cropper_container.select("#normal-result-image, #small-result-image").each(function(h){var i=b.regions.thumb;h.up(".scroller").style.width=h.getAttribute("rel:width")+"px";h.up(".scroller").style.height=h.getAttribute("rel:height")+"px";var f=h.getAttribute("rel:width")*1;var j=h.getAttribute("rel:height")*1;var g=Math.round(b.image_data.width*f/i.width);var d=Math.round(i.left*f/i.width);var k=Math.round(j*i.top/i.height);h.src=c.src;h.style.margin="-"+k+"px 0 0 -"+d+"px";h.style.width=g+"px"});var a=$("crop-thumb");a.stopObserving("click");a.observe("click",function(){this.current_cropping_region="thumb";$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(b));if(this.options.fitImageAndScreen){this.fitToScreen()}}});BF_SUPERPOST_QUIZ_CROPPER=Class.create(BF_IMAGE_CROPPER,{setDefaults:function(){var a={cropper_class:"superpost_quiz",fitImageAndScreen:true,showThumbs:false,showPreview:false,showCropper:true,minWidth:this.options.image_data.crop_width,minHeight:this.options.image_data.crop_height};Object.extend(this.options,a)},fitToScreen:function(){var f=document.documentElement.clientWidth,l=document.documentElement.clientHeight,i=this.image_data.width,n=this.image_data.height,p=parseInt(this.container.getStyle("width")),a=parseInt(this.container.getStyle("height")),g=30+0,k=30+0,w=0,j=35;if(this.container.select("#cropper_container .container")[0].hasClassName("hidden")){var c=this.container.select("#cropper_container #thumbs")[0];i=parseInt(c.getStyle("width"));n=parseInt(c.getStyle("height"))}this.container.setStyle({width:i+"px"});this.container.setAttribute("width",i);this.container.setStyle({height:n+"px"});this.container.setAttribute("height",n);p=parseInt(this.container.getStyle("width"));a=parseInt(this.container.getStyle("height"));this.container.select(".cropperbody")[0].setStyle({width:p+"px"});this.container.select(".cropperbody")[0].setStyle({height:a+"px"});var t=this.container.up(".bf_dialog_content");t.setStyle({width:(p+w)+"px"});t.setStyle({height:(a+j)+"px"});var q=this.container.up(".bf_dialog");q.setStyle({width:(p+w)+"px"});q.setStyle({height:(a+j)+"px"});var h=document.documentElement.scrollLeft,b=document.body.scrollLeft,x=document.documentElement.scrollTop,v=document.body.scrollTop;q.setStyle({left:(((f-p)/2)>0?((f-p)/2):0)+(h>b?h:b)+"px"});q.setStyle({top:(((l-a)/2)>0?((l-a)/2):0)+(x>v?x:v)+"px"});q.setStyle({marginLeft:"0px"});var m=document.documentElement.clientWidth,s=document.documentElement.clientHeight,r=document.body.clientWidth,d=document.body.clientHeight;var o=this.container.up("#super-image-edit").select(".bf_overlay_mask")[0];o.setStyle({width:(m>r?m:r)+"px"});o.setStyle({height:(s>d?s:d)+"px"})},cancel_image:function(a){a.stop();this.close()},save_image:function(a){var b=this.regions["default"];quiz_admin.image_cropper_callback(this.image_data.image,this.image_data.name,this.image_data.format,b);this.close()},customize_cropper:function(f){var g=f.onloadCoords;var a=this.image_data;var b=a.width/this.options.minWidth;var d=a.height/this.options.minHeight;var c=Math.min(b,d);g.x2=this.options.minWidth*c;g.y2=this.options.minHeight*c;f.onloadCoords=g;$("save-image").focus()},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";b.select(".cerror-message")[0].innerHTML=this.error_message="We need an image at least 170 x 170 pixels. Choose another one below, or hit cancel to try again.";return false}if(this.options.minHeight==a.height&&this.options.minWidth==a.width){this.options.showCropper=false}return true},crop_default_size:function(){this.regions["default"]={top:0,left:0,height:this.options.minHeight,width:this.options.minWidth};this.save_image()},crop_done:function(b,a){this.regions["default"]={top:b.y1,left:b.x1,height:b.y2-b.y1,width:b.x2-b.x1,image:this.image_element.src}}});BF_FLEXPRO_CROPPER=Class.create(BF_SUPERPOST_CROPPER,{template:'		<div class="cropperbody #{cropper_class}">			<div class="content">				#{uploader_template}				<div id="cropper_container">					<div class="container"><img id="image" src="'+trans_gif_1x1_base64+'" class="hidden" /></div>					#{preview_template}					#{thumbs_template}				</div>			</div>			<div class="bf_dialog_footer">				<ul>					<li id="save-button">						<button id="save-image" class="hidden bf_button bf_submit">Save</button>						<button id="preview-thumbs" class="hidden bf_button bf_submit">Save</button>						<button id="approve-thumbs" class="hidden bf_button bf_submit">Looks Good!</button>					</li>					<li><input id="image-cancel" type="button" class="bf_button" value="Cancel" /></li>				</ul>			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<div>Are These Thumbnails OK? <span class="help">Thumbnail images may be be used to promote your post so make sure they look good!</span></div>			<fieldset class="big-result">				<div>Big Thumbnail</div>				<div id="big-result" class="results"><div class="scroller"><img id="big-result-image" rel:width="355" rel:height="236" />&nbsp;</div></div>				<button id="big-crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>			<fieldset class="normal-result">				<div>Normal Thumbnails</div>				<div id="normal-result" class="results"><div class="scroller"><img id="normal-result-image" rel:width="125" rel:height="83" />&nbsp;</div></div>				<div id="small-result" class="results"><div class="scroller"><img id="small-result-image" rel:width="90" rel:height="60" />&nbsp;</div></div>				<button id="crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>			<fieldset class="wide-result">				<div>Wide Thumbnail</div>				<div id="wide-result" class="results"><div class="scroller"><img id="wide-result-image" rel:width="355" rel:height="125" />&nbsp;</div></div>				<button id="wide-crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>		</div>',setDefaults:function(){this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=625;this.wide_height=220;this.big_width=625;this.big_height=415;this.thumb_width=125;this.thumb_height=83;var a={cropper_class:"flexpro",fitImageAndScreen:false,minWidth:355,minHeight:236};if(this.options.minWidth){a.minWidth=this.options.minWidth}if(this.options.minHeight){a.minHeight=this.options.minHeight}if(this.options.image_data.crop_height!=this.thumb_height||this.options.image_data.crop_width!=this.thumb_width){a={cropper_class:"flexpro",fitImageAndScreen:false,showThumbs:false,showPreview:false,showCropper:true,minHeight:parseInt(this.options.image_data.crop_height),minWidth:parseInt(this.options.image_data.crop_width)}}Object.extend(this.options,a)},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";var c;if(this.options.showThumbs){c="We need an image at least 355 x 236 pixels. That's as big as the box this message is in! Choose another one below, or hit cancel to try again."}else{c="We need an image at least "+this.options.image_data.crop_width+" x "+this.options.image_data.crop_height+" pixels. Choose another one below, or hit cancel to try again."}b.select(".cerror-message")[0].innerHTML=this.error_message=c;return false}if(this.options.minHeight==a.height&&this.options.minWidth==a.width){this.options.showCropper=false}return true},save_image:function(){var a=this.regions.thumb;this.options.callbacks.save_image(this.image_data.image,this.image_data.name,a,this.options.controller);this.close()},approve_image:function(){var f=this.regions.thumb;if(this.regions.wide){var a=this.regions.wide;f.wide_height=a.height;f.wide_width=a.width;f.wide_top=a.top;f.wide_left=a.left}if(this.regions.big){var d=this.regions.big;f.big_height=d.height;f.big_width=d.width;f.big_top=d.top;f.big_left=d.left}if(this.image_data&&this.image_data.original){f.original={image:this.image_data.original.image,image_width:this.image_data.original.width,height:this.image_data.original.height}}this.options.callbacks.save_image(this.image_data.image,this.image_data.name,f,parent.image_handling.controller);var c=$("buzz-type");var b=(c)?c.value:"text";this.options.callbacks.finish_save_image(b,this)},cancel_image:function(a){a.stop();$$("#parent-buzz-uploader .qq-upload-list > li").each(function(b){b.remove()});this.close();Event.stopObserving(window,"resize",this.fitToScreenOuter)},fitToScreen:function(){}});BF_OPTIMIZE_CROPPER=Class.create(BF_SUPERPOST_CROPPER,{setDefaults:function(){var a={cropper_class:"",fitImageAndScreen:false,modalIsParent:true,minWidth:355,minHeight:236};this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=625;this.wide_height=220;this.big_width=625;this.big_height=415;this.thumb_width=125;this.thumb_height=83;if(this.options.minWidth){a.minWidth=this.options.minWidth}if(this.options.minHeight){a.minHeight=this.options.minHeight}Object.extend(this.options,a)},fitToScreen:function(){},approve_image:function(c){var d=this.regions.thumb;if(this.regions.wide){var a=this.regions.wide;d.wide_height=a.height;d.wide_width=a.width;d.wide_top=a.top;d.wide_left=a.left}if(this.regions.big){var b=this.regions.big;d.big_height=b.height;d.big_width=b.width;d.big_top=b.top;d.big_left=b.left}if(this.options.image_data.image){d.image=this.options.image_data.image;if(this.options.subid){d.subid=this.options.subid}if(this.options.promoid){d.promoid=this.options.promoid}}if(d.subid){optimize.update_cropping(d)}else{if(d.promoid){optimize.update_cropping_in_progress(d)}}this.cancel_image()}});BF_PicksController=function(){this.controller="/buzzfeed/_picks";this.switchuser_list=new Template('<option class="pick_switch_user" rel:data="#{user.id}">#{user.display_name}</option>');this.initialized_dialog=false;this.init=function(){if(BF_STATIC&&BF_STATIC.page&&BF_STATIC.page.match(/Home/)){return true}if(window.location.pathname.match(/\/submit\/\w+/)){this.init_submissions()}else{var user_info=(new BF_User()).getUserInfo();$$(".make_pick").each(function(el){el.show();el.observe("click",picks_controller.launch_pick)});$$(".microsite-name").each(function(el){el.update(user_info.display_name)});var page=(document.location.pathname.split("/")).pop();if(page==user_info.username){if($("pending-submissions-notice")){$("pending-submissions-notice").show()}$$(".delete_pick").each(function(el){$(el.parentNode).show();el.show();el.observe("click",picks_controller.delete_pick)});if(document.location.pathname.match(/\/submissions\//)){$$(".accept_pick").each(function(el){el.show();el.observe("click",picks_controller.launch_pick_accept)});$$(".delete-pick").each(function(el){el.removeClassName("delete-pick");el.addClassName("accept-pick")})}else{$$(".edit_pick").each(function(el){el.show();el.observe("click",picks_controller.launch_pick_edit)});$$(".add-pick").each(function(el){var data=eval("("+el.getAttribute("data")+")");if(data!=null&&data.username==user_info.username){$(el.parentNode).hide();el.hide()}else{el.addClassName("edit-pick")}})}}else{$$(".add-pick").each(function(el){var data=eval("("+el.getAttribute("rel:data")+")");if(data&&data.username==user_info.username){$(el.parentNode).hide();el.hide()}})}}};this.load_picks_dialog=function(callback){if(!this.initialized_dialog){bfjemplate.load_if_missing({id:"pick_dialog",callback:picks_controller.init_picks_dialog,context:picks_controller,args:arguments})}else{callback()}},this.init_picks_dialog=function(callback){if($("pick-buzz-button")){$("pick-buzz-button").observe("click",picks_controller.pick)}if($("pick-buzz-cancel-button")){$("pick-buzz-cancel-button").observe("click",function(e){var buzz_id=$("pick-buzz-button").getAttribute("rel:buzz_id");if(buzz_id){if($(buzz_id+"-accept_pick-spinner")){$(buzz_id+"-accept_pick-spinner").hide()}if($(buzz_id+"-make_pick-add")){$(buzz_id+"-make_pick-add").show()}if($(buzz_id+"-make_pick-success")){$(buzz_id+"-make_pick-success").hide()}if($(buzz_id+"-make_pick-spinner")){$(buzz_id+"-make_pick-spinner").hide()}}})}this.initialized_dialog=true;callback()};this.init_submissions=function(){picks_controller.add_microsite_id=function(obj){obj.submit_to_microsite=($("contest-entry-form")&&$("contest-entry-form").getAttribute("rel:submit_to_microsite"))};picks_controller.save_image=function(path,image,region,sendTo){var params=region;if(typeof sendTo=="undefined"){sendTo="/buzzfeed/_edit_user_image"}else{params.type=$("buzz-type").value+"buzz"}if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=function(resp){picks_controller.image_saved(resp)};var er=function(){contest_manager.error()};var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};picks_controller.image_saved=function(resp){if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){if($("quickpost-enhanced-image-file")){$("quickpost-enhanced-image-file").value=obj.thumb_image}if($("quickpost-embed-image-file")){$("quickpost-embed-image-file").value=obj.thumb_image}if($("quickpost-link-image-file")){$("quickpost-link-image-file").value=obj.thumb_image}if($("quickpost-quiz-image-file")){$("quickpost-quiz-image-file").value=obj.thumb_image}if($("quickpost-video-image-file")){$("quickpost-video-image-file").value=obj.thumb_image}if($("quickpost-image-image-thumb")){$("quickpost-image-image-thumb").value=obj.thumb_image}if($("quickpost-image-image-file")){$("quickpost-image-image-file").value=obj.large_image}if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+obj.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+obj.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+obj.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+obj.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+obj.thumb_image;$("image-preview").show();$("image-preview-div").show()}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+obj.thumb_image;$("quiz-thumbnail").show()}this.settings.image=obj.image}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};picks_controller.save_ok=function(data){if($("successful-entry")){$("successful-entry").show()}if($("select-quickpost-box")){$("select-quickpost-box").hide()}};user_post.init();EventManager.observe("user_post:save:success",picks_controller.save_ok);EventManager.observe("user_post:save:preparing",picks_controller.add_microsite_id);var user=new BF_User();if(user.isLoggedIn()){if(user.getUserInfo().terminal_user&&user.getUserInfo().terminal_user=="true"){if($("quickpost-enhanced-settings")){$("quickpost-enhanced-settings").show()}}else{if($("quickpost-enhanced-settings")){$("quickpost-enhanced-settings").hide()}}var regex=new RegExp("/submit/"+(user.getUserInfo()).username+"$");if(window.location.href.match(regex)){if($("error-div")){$("error-div").show()}}else{if($("contest-entry-form")){$("contest-entry-form").show()}}}else{if($("contest-entry-form")){$("contest-entry-form").show()}var ev=$("header-signin").fire("click");ev.signin_type="initial";ev.location="header";ev.keydown_disabled=true;ev.mousedown_disabled=true;ev.close_disabled=true;signin.open(ev)}};this.do_make_request=function(action,buzz_id,note,success){var params={action:action,buzz_id:buzz_id,note:note};var user_id=$("pick-buzz-button").getAttribute("rel:switch_user_id");if(typeof user_id!="undefined"&&user_id){params.user_id=user_id}if(action=="delete"&&"acl" in window&&acl.user_can("picks_delete_from_anywhere")&&BF_STATIC.tt_page=="User"&&"bf_username" in window){params.username=bf_username}var user_info=(new BF_User()).getUserInfo();if((action=="hide"||action=="show")&&(("acl" in window&&acl.user_can("partners_manage"))||bf_username==user_info.username)&&"bf_username" in window){params.username=bf_username}var ajax=new BF_Request();ajax.request(picks_controller.controller,{method:"post",parameters:params,onSuccess:success})};this.make_request=function(action,buzz_id,note,success){var args=arguments;picks_controller.load_picks_dialog(function(){picks_controller.do_make_request.apply(picks_controller,args)})};this._accept=function(r){var obj=eval("("+r.responseText+")");if(obj.success){var buzz_id=obj.buzz_id;if($(buzz_id+"-accept_pick-spinner")){$(buzz_id+"-accept_pick-spinner").hide()}if($("post-"+buzz_id)){$("post-"+buzz_id).appendChild(new Element("span",{"class":"this-post-was-picked"}))}if($$("#post-2111731 .accept-pick")&&$$("#post-2111731 .accept-pick")[0]){$$("#post-2111731 .accept-pick")[0].hide()}}};this.hide_pick=function(e,success){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(buzz_id){picks_controller.make_request("hide",buzz_id,"",function(r){picks_controller._delete(r);success(r)})}};this.show_pick=function(e,success){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(buzz_id){picks_controller.make_request("show",buzz_id,"",function(r){picks_controller._delete(r);success(r)})}};this.delete_pick=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(buzz_id){if($(buzz_id+"-delete_pick-spinner")){$(buzz_id+"-delete_pick-spinner").show()}picks_controller.make_request("delete",buzz_id,"",picks_controller._delete)}};this._delete=function(r){var obj=eval("("+r.responseText+")");if(obj.success){var buzz_id=obj.buzz_id;if($(buzz_id+"-delete_pick-spinner")){$(buzz_id+"-delete_pick-spinner").hide()}if($("post-"+buzz_id)){$("post-"+buzz_id).hide()}}};this.do_launch_pick=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if($("easy_rebuzz")){$("easy_rebuzz").hide()}picks_controller.start_spinner(parent);(new BF_Request()).request(picks_controller.controller,{method:"get",parameters:{buzz_id:buzz_id,action:"get_pick"},onSuccess:function(o){picks_controller.easy_rebuzz(e,o)},onFailure:function(o){$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value=""},evalJSON:true});return};this.launch_pick=function(e){picks_controller.load_picks_dialog(function(){picks_controller.do_launch_pick(e)})};this.do_easy_rebuzz=function(e,o){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var obj=o.responseText.evalJSON();if(typeof obj.success!="undefined"&&obj.success==1){if(typeof obj.pick!="undefined"&&obj.pick!=0){picks_controller.launch_pick_edit(e,o)}else{BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","pick");$("pick_note").value="";if(typeof obj.users!="undefined"){var list='<select id="switchuser_select">';var i=0;for(i=0;i<obj.users.length;i++){list+=this.switchuser_list.evaluate({user:obj.users[i]})}list+="</select>";if(i>0&&$("rebuzz_switchuser_list")){$("rebuzz_switchuser_list").update(list);if($("easy_rebuzz")){$("easy_rebuzz").show()}if($("switchuser_select")){$("switchuser_select").observe("change",function(e){e.stop();$$(".pick_switch_user").each(function(el){if(el.selected){var switch_user_id=el.getAttribute("rel:data");if(typeof switch_user_id!=undefined&&switch_user_id){picks_controller.choose_user(switch_user_id)}}})})}}}}}else{$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value=""}};this.easy_rebuzz=function(e,o){picks_controller.load_picks_dialog(function(){picks_controller.do_easy_rebuzz(e,o)})};this.do_launch_pick_edit=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");$("pick-buzz-button").value="Update Note";$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","update_note");$("pick_note").value="";$("pick_note").disabled=true;var pick_edit=function(o){$("pick_note").disabled=false;var obj=o.responseText.evalJSON();$("pick_note").value=BF_UI.renderEntities(obj.pick.note);if(obj.pick.is_pick==2&&obj.pick.pending_acceptance==1){$("pick-buzz-button").setAttribute("rel:action","accept_pick");$("pick-buzz-button").value="Accept Buzz"}};if(arguments[1]){pick_edit(arguments[1])}else{(new BF_Request()).request(picks_controller.controller,{method:"get",parameters:{buzz_id:buzz_id,action:"get_pick"},onSuccess:pick_edit,evalJSON:true})}BF_UI.showDialog("pick_dialog","Edit Your Note")};this.launch_pick_edit=function(e){picks_controller.load_picks_dialog(function(){picks_controller.do_launch_pick_edit(e)})};this.do_launch_pick_accept=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");$("pick-buzz-button").value="Accept Buzz";$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","accept");BF_UI.showDialog("pick_dialog","Accept a Submission")};this.launch_pick_accept=function(e){if(!picks_controller.initialized_dialog){picks_controller.load_picks_dialog(function(){picks_controller.do_launch_pick_accept(e)})}else{picks_controller.do_launch_pick_accept(e)}};this.choose_user=function(user_id){$("pick-buzz-button").setAttribute("rel:switch_user_id",user_id)};this.pick=function(e){e.stop();BF_UI.closeDialog("pick_dialog");var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var action=$("pick-buzz-button").getAttribute("rel:action");var callback=picks_controller._pick;if(!action){action="pick"}if(action=="update_note"){var note=$$("#post-"+buzz_id+" .buzznote .what").first();if(note){note.update($F("pick_note").replace(/</g,"&lt;").replace(/>/g,"&gt;"));$$("#post-"+buzz_id+" .buzznote").first().show()}}else{if(action=="accept"){callback=picks_controller._accept}else{if(action=="accept_pick"){action="accept"}}}if(buzz_id){picks_controller.make_request(action,buzz_id,$F("pick_note"),callback);picks_controller.start_spinner(parent)}};this._pick=function(r){var obj=eval("("+r.responseText+")");if(obj.success){var buzz_id=obj.buzz_id;picks_controller.stop_spinner();var user=new BF_User();if(user.isLoggedIn()){var username=(user.getUserInfo()).username;var your_feed="your Feed";if(typeof obj.username!="undefined"&&obj.username&&username!=obj.username){your_feed+=" (/"+obj.username+")";username=obj.username}if($("social_message-rebuzz")){$("social_message-rebuzz").update('<h5><span class="highlight">Rebuzzed!</span> This post has been added to <a href="'+(BF_STATIC?BF_STATIC.web_root:"")+"/"+username+'/">'+your_feed+"</a></h5>");$("social_message-rebuzz").show()}}gtrack.track_events("","share/rebuzz","")}else{picks_controller.stop_spinner()}};this.stop_spinner=function(){$$(".rebuzz_icon.busy").each(function(e){$(e).removeClassName("busy")})};this.start_spinner=function(parent){var icon=parent.select(".rebuzz_icon");if(icon&&icon.length){icon.first().addClassName("busy")}}};var BoostManager=function(){this.BOOST_DIALOG_ID="bf_boost_dialog";this.BOOST_CALCULATE_CPM_PAGE="/buzzfeed/calculate_cpm";this.BOOST_SUBMIT_PAYMENT="/buzzfeed/buzzboost";this.REGISTER_AND_BOOST_SUBMIT_PAYMENT="/buzzfeed/_temp_wrapper";this.type="paypal";this.preview_data={blurb:"",campaignid:"",display_name:"",form:"",full_uri:"",image:"",name:"",position:"",uri:"",userid:"",username:"",user_image:""};this.pause=function(args){var params={action:"pause",ad_multiboost_id:args.ad_multiboost_id};var spinner=args.element.previous(".boost_spinner");spinner.show();args.element.hide();var sr=function(){args.element.siblings().each(function(el){el.show()});spinner.hide();var el=args.element.up("li");if(el&&el.hasClassName("running")){el.removeClassName("running");el.addClassName("paused")}};var ajax=new BF_Request();ajax.request("/buzzfeed/buzzboost",{method:"get",parameters:params,onSuccess:sr})};this.unpause=function(args){var params={action:"unpause",ad_multiboost_id:args.ad_multiboost_id};var spinner=args.element.previous(".boost_spinner");spinner.show();args.element.hide();var sr=function(){args.element.siblings().each(function(el){el.show()});spinner.hide();var el=args.element.up("li");if(el&&el.hasClassName("paused")){el.removeClassName("paused");el.addClassName("running")}};var ajax=new BF_Request();ajax.request("/buzzfeed/buzzboost",{method:"get",parameters:params,onSuccess:sr})};this.init=function(args){if(!acl.user_can("can_boost")){return}if(args.dialog){this.init_dialog(args)}else{if(args.create_post){this.init_create_post(args)}else{universal_dom.assign_handler({bucket:"boostable",event:"click",handler:bf_boost_manager.load_boost_dialog});universal_dom.assign_handler({bucket:"unpause",event:"click",handler:bf_boost_manager.unpause});universal_dom.assign_handler({bucket:"pause",event:"click",handler:bf_boost_manager.pause});universal_dom.get_bucket_elements("boostable").each(function(el){var data=el.getAttribute("rel:bf_data");if(data){try{var obj=eval("("+data+")");var user_id=parseInt(obj.user_id);el.removeClassName("hidden");el.parentNode.removeClassName("hidden")}catch(e){}}});if(acl.user_can("boost_admin")){$$(".admin-user-field").each(function(e){e.show()})}$$(".payment-type").each(function(e){e.observe("click",function(event){bf_boost_manager.toggle_payment()})})}}};this.init_dialog=function(args){};this.init_create_post=function(args){if(window.location.href.match(/\/boost(2)?/)){return}bf_login.init();user_post.init();user_post.CONTRIBUTE_URL="/buzzfeed/_temp_wrapper";user_post.ENHANCED_URL="/buzzfeed/_temp_wrapper";EventManager.observe("user_post:save:preparing",function(data){data.action="save_quickpost";data.anonymous=true});EventManager.observe("user_post:create:opening_form",bf_boost_manager.listen_for_enhanced);EventManager.observe("user_post:save:success",bf_boost_manager.save_ok);if($("facebook_post_to_fanpage_dialog")){$("facebook_post_to_fanpage_dialog").addClassName("hidden")}if($("quickpost-save-as-draft")){$("quickpost-save-as-draft").addClassName("hidden")}EventManager.observe("user_post:create:opening_form",bf_boost_manager.setup_preview);user_setting={save_image:bf_boost_manager.save_image}};this.setup_preview=function(args){var which_template=args.buzz_type=="link"?"preview-link-template":"preview-common-template";var template=$(which_template).innerHTML;template=template.replace(/%7B/g,"{");template=template.replace(/%7D/g,"}");bf_boost_manager.preview_template=new Template(template);var user=new BF_User();var data;if(user.isLoggedIn()){data=user.getUserInfo();if(!data.display_name){data.display_name=data.username}data.user_image=data.image||"/static/images/public/defaults/user.jpg";data.name="Your Title Here!";data.link_buzz="example.com";data.blurb="Your description here.";data.image=BF_STATIC.image_root+"/static/images/public/defaults/thumb.png"}else{data={display_name:"You!",username:"anonymous",userid:0,blurb:"Your description here.",user_image:"/static/images/public/defaults/user.jpg",image:BF_STATIC.image_root+"/static/images/public/defaults/thumb.png",name:"Your Title Here!",link_buzz:"example.com"}}data.form=args.buzz_type;bf_boost_manager.update_preview(data);$("quickpost-title").observe("keyup",function(e){bf_boost_manager.update_preview({name:TT_Filters.html(e.target.value.substr(0,65))})});$("quickpost-description").observe("keyup",function(e){bf_boost_manager.update_preview({blurb:TT_Filters.boost_preview(e.target.value.substr(0,135))})});$("quickpost-link-url").observe("keyup",function(e){bf_boost_manager.update_preview({link_buzz:TT_Filters.html(e.target.value)})});["video-link-thumbnail","image-preview","embed-thumbnail","link-thumbnail"].each(function(id){$(id).observe("load",function(e){var isrc=e.target.getAttribute("src");bf_boost_manager.update_preview({image:isrc})})})};this.update_preview=function(args){for(var each in args){bf_boost_manager.preview_data[each]=args[each]}var html=bf_boost_manager.preview_template.evaluate(bf_boost_manager.preview_data);$("preview").update(html);$$(".ad_boost_image").each(function(e){e.src=bf_boost_manager.preview_data.image});var links=$("preview").getElementsByTagName("A");for(var i=0;i<links.length;i++){links[i].setAttribute("onclick","return false")}};this.listen_for_enhanced=function(args){if(args.buzz_type=="enhanced"){var modify_url=function(c){if((typeof TopList!="undefined"&&typeof TopList.EDIT_ENHANCED_IMAGE!="undefined")||(typeof ClassifyQuiz!="undefined"&&typeof ClassifyQuiz.EDIT_ENHANCED_IMAGE!="undefined")){if(typeof TopList!="undefined"){TopList.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}if(typeof ClassifyQuiz!="undefined"){ClassifyQuiz.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}}else{if(c<40){setTimeout(function(){modify_url(c+1)},250)}else{alert("We are unable to process your request at this time")}}};modify_url(0)}};this.save_image=function(path,image,region,sendTo){var params=region;if(typeof sendTo=="undefined"){sendTo="/buzzfeed/_edit_user_image"}else{params.type=$("buzz-type").value+"buzz"}if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=function(resp){bf_boost_manager.image_saved(resp)};var er=function(){bf_boost_manager.error()};var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};this.image_saved=function(resp){if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){if(typeof window.superlist!="undefined"){return superlist.set_parent_image(resp)}if($("quickpost-enhanced-image-file")){$("quickpost-enhanced-image-file").value=obj.thumb_image}if($("quickpost-embed-image-file")){$("quickpost-embed-image-file").value=obj.thumb_image}if($("quickpost-link-image-file")){$("quickpost-link-image-file").value=obj.thumb_image}if($("quickpost-quiz-image-file")){$("quickpost-quiz-image-file").value=obj.thumb_image}if($("quickpost-video-image-file")){$("quickpost-video-image-file").value=obj.thumb_image}if($("quickpost-image-image-thumb")){$("quickpost-image-image-thumb").value=obj.thumb_image}if($("quickpost-image-image-file")){$("quickpost-image-image-file").value=obj.large_image}if($("quickpost-super-image-file")){$("quickpost-super-image-file").value=obj.thumb_image}if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+obj.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+obj.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+obj.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+obj.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+obj.thumb_image;$("image-preview").show();if($("image-preview-div")){$("image-preview-div").show()}}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+obj.thumb_image;$("quiz-thumbnail").show()}if(!Object.isUndefined(this.settings)){this.settings.image=obj.image}}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};this.save_ok=function(args){if(args.json.updated){window.location.href=BOOST_PAYMENT_FORM+"?buzz_id="+args.json.id}};this.load_boost_dialog=function(data){if(!acl.user_can("can_boost")){return}var onload=function(){var bf_boost_manager=new top.BoostManager();bf_boost_manager.init({dialog:true})};if(!"multiboost" in window){return}multiboost.get_boosts_setup();var url="boost_modal/select_tier",w=800,h=525;if(multiboost.has_active_multiboost()){if(multiboost.has_added_buzz(data.buzz_id)){url="boost_modal/already_added";h=205}else{if(multiboost.has_room_for_more_boosts()){url="boost_modal/add_it";h=190;multiboost.add_buzz_to_boost_list({campaignid:data.buzz_id})}else{if(multiboost.tier_id<3){url="boost_modal/upgrade";h=250}else{url="boost_modal/no_more_room";h=260}}}}BF_UI.create_or_show_dialog({width:w,height:h,scrolling:"no",title:"Boost This!",id:bf_boost_manager.BOOST_DIALOG_ID,url:"/buzzfeed/"+url+"?buzz_id="+data.buzz_id+"&cb="+(new Date()).getTime(),onload:[onload]})};this.toggle_payment=function(){var payment_type=$$("input[name=type]:checked").first().value,rate=multiboost.tier.default_rate;var spend="25";this.type=payment_type;if(payment_type=="paypal"||payment_type=="paypal_account"){spend="95"}if(payment_type=="coupon"){$("submit").value="Boost It";$$(".cc-data-field").each(function(e){e.hide()});$$(".admin-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.show()});var minimum_impressions=multiboost.commify(parseInt(parseInt(spend)/rate,10));universal_dom.get_bucket_elements("minimum_impressions").each(function(el){el.update(minimum_impressions)})}else{if(payment_type=="admin"){$("submit").value="Boost It";$$(".cc-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".admin-data-field").each(function(e){e.show()});if($("spend-paypal").value){$("admin-spend").value=$("spend-paypal").value}}else{if(payment_type=="paypal"){$("submit").value="Charge My Card";$$(".admin-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".cc-data-field").each(function(e){e.show()})}else{$("submit").value="Pay with Paypal";$$(".admin-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".cc-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.show()})}}}};this.submit=function(args){try{for(var key in args){args[key]=args[key].toString().strip()}if(args.city=="City"){args.city=""}if(args.coupon_id=="Coupon Code"){args.coupon_id=""}if(args.first_name=="First Name"){args.first_name=""}if(args.last_name=="Last Name"){args.last_name=""}if(args.street=="Street Address"){args.street=""}if(args.zip=="Zip Code"){args.zip=""}if(args.cc_type=="unknown"){args.cc_type=""}if(this.type=="coupon"&&args.coupon_id==""){$("error-dialog").update("Please enter a Coupon Code");$("error-dialog").removeClassName("hidden");$("error-dialog").addClassName("error");return}if(this.type=="admin"){args.amount=$F("admin-spend");args.admin_boost=1}if($("spinner")&&$("payment_form")){$("spinner").removeClassName("hidden");$("submit").addClassName("hidden")}if($("error-dialog")){$("error-dialog").addClassName("hidden")}if($("registration-error-dialog")){$("registration-error-dialog").addClassName("hidden")}if($("login-error-dialog")){$("login-error-dialog").addClassName("hidden")}if(bf_boost_manager.errors){bf_boost_manager.errors.each(function(detail){if(document.forms.payment.elements[detail]){document.forms.payment.elements[detail].removeClassName("error")}})}args.action="multiboost";args.type=this.type;args.amount=Math.floor(args.amount*100)/100;args.amount=args.amount.toString();var check_decimals=args.amount.split(".");if(!check_decimals[1]){check_decimals[1]="00"}else{if(check_decimals[1].length==1){check_decimals[1]+="0"}}args.amount=check_decimals.join(".");var url=bf_boost_manager.BOOST_SUBMIT_PAYMENT;if(args.register_user=="true"){url=bf_boost_manager.REGISTER_AND_BOOST_SUBMIT_PAYMENT;args.action="register_user_and_boost";var err=$("registration-error-dialog");if(args.pw.length<6){if(err){err.update("Password must be at least 6 characters");err.removeClassName("hidden");$("spinner").addClassName("hidden");$("submit").removeClassName("hidden");err.showOnScreen()}return}if(args.username.length<3||args.username.length>30){if(err){err.update("Username must be at least 3 characters and no more than 30 characters");err.removeClassName("hidden");$("spinner").addClassName("hidden");$("submit").removeClassName("hidden");err.showOnScreen()}return}}else{if(args.login_user=="true"){url=bf_boost_manager.REGISTER_AND_BOOST_SUBMIT_PAYMENT;args.action="login_user_and_boost"}}(new BF_Request).request(url,{method:"post",parameters:args,onComplete:function(r){bf_boost_manager._submit(eval("("+r.responseText+")"))}})}catch(e){console.error(e)}};this._submit=function(result){if(result.success==0){var error_dialog=$("error-dialog");if(typeof result.login!="undefined"&&!result.login){error_dialog=$("login-error-dialog");error_dialog.update("Invalid username or password");error_dialog.removeClassName("hidden");if($("spinner")&&$("payment_form")){$("spinner").addClassName("hidden");$("submit").removeClassName("hidden")}}else{if($("registration-error-dialog")&&result.error_section=="registration"){error_dialog=$("registration-error-dialog")}if($("login-error-dialog")&&result.error_section=="login"){error_dialog=$("login-error-dialog")}if($("spinner")&&$("payment_form")){$("spinner").addClassName("hidden");$("submit").removeClassName("hidden")}error_dialog.removeClassName("hidden");error_dialog.update("");var ul=document.createElement("ul");ul.appendChild(document.createTextNode(result.message));bf_boost_manager.errors=result.errors;var prepend_login=false;if("login"==result.error_section){prepend_login=true}if("registration"==result.error_section){prepend_register=true}result.errors.each(function(detail){if(detail=="username"&&prepend_login){detail="login_username"}if(detail=="email"&&prepend_register){detail="register_email"}if(detail=="cc_type"){var li=document.createElement("li");li.appendChild(document.createTextNode("Invalid Credit Card"));ul.appendChild(li)}if(document.forms.payment.elements[detail]){$(document.forms.payment.elements[detail]).addClassName("error")}else{var li=document.createElement("li");li.appendChild(document.createTextNode(detail));ul.appendChild(li)}});error_dialog.appendChild(ul)}error_dialog.showOnScreen()}else{if(result.redirect){if(!(new BF_User()).isLoggedIn()){bf_login.loggedIn(result)}window.location.href=result.redirect}else{if(result.error){var error_dialog=$("login-error-dialog");error_dialog.removeClassName("hidden");error_dialog.update("There is a problem with your account. Please contact us at support@buzzfeed.com");error_dialog.showOnScreen()}else{var extra_data=[];["first_name","last_name","street","city","state","zip"].each(function(p){extra_data.push(p+"="+result.params[p])});if(!(new BF_User()).isLoggedIn()){bf_login.loggedIn(result)}window.location.href="/buzzfeed/_boost_receipt?transaction_id="+result.transaction_id+"&buzz_id="+result.buzz_id+"&"+extra_data.join("&")}}}};this.update_expiration_date=function(f){var parts=[f.elements.month[f.elements.month.selectedIndex].value,f.elements.year[f.elements.year.selectedIndex].value];var ok=true;if(parts[0]<10){parts[0]="0"+parts[0]}else{parts[0]=""+parts[0]}parts.each(function(v){if(v==0){ok=false}});if(ok){f.elements.cc_expires.value=parts.join("")}};this.cc_checker=[{id:"AMEX",regex:new RegExp("^3")},{id:"VISA",regex:new RegExp("^4")},{id:"MASTERCARD",regex:new RegExp("^5")},{id:"DISCOVER",regex:new RegExp("^6")}];this.update_cc_type=function(cc_number,update_field,highlight_mapping){var type="unknown";bf_boost_manager.cc_checker.each(function(data){if($(highlight_mapping[data.id])){$(highlight_mapping[data.id]).removeClassName("selected")}});bf_boost_manager.cc_checker.each(function(data){if(cc_number.match(data.regex)){type=data.id;if(typeof highlight_mapping[type]!="undefined"&&$(highlight_mapping[type])){$(highlight_mapping[type]).addClassName("selected")}}});if($(update_field)){$(update_field).value=type}}};var bf_boost_manager=new BoostManager();BuzzLoader.register(function(){if(window.location.href.match(/boost_dialog/)){bf_boost_manager.init({dialog:true,url:window.location.href})}else{if(window.location.href.match(/\/boost$/)){bf_boost_manager.init({create_post:true})}else{bf_boost_manager.init({})}}},2);var BF_MultiBoost=function(){this.debug=function(msg,data){if(multiboost.debug){if(!data){data={}}data.msg=msg;console.dir(data)}};this.preview_data={blurb:"",campaignid:"",display_name:"",form:"",full_uri:"",image:"",name:"",position:"",uri:"",userid:"",username:"",user_image:""};this.boost_list=[];this.TIER_DEFINITIONS={"1":{name:"Boost",max_boosts:1,level:1,min_buy:95,max_buy:999,default_rate:0.003},"2":{name:"Optimized Boost",max_boosts:5,level:2,min_buy:1000,max_buy:4999,default_rate:0.002},"3":{name:"Big Seed",max_boosts:10,level:3,min_buy:5000,max_buy:100000,default_rate:0.002}};this.BOOST_COOKIE_NAME="bf_boost_list";this.FACEBOOK_BUZZ_AD=new Template(' 		<p class="error-message" id="error-message-#{unique_id}" style="display:none;"></p> 		<div class="fb_box c"> 		 <h3 class="bf_dom editable" rel:bf_bucket_data="{\'edit\':{\'id\':\'#{campaignid}\',\'field\':\'fb_name\'}}">#{fb_name}</h3><div id="#{campaignid}-fb_name-length" class="blurb_length headline"></div> 		 <div class="c"> 			 <div class="photo"><img src="#{image_root}#{image}" alt="" /></div> 			 <div class="info"> 				 <p class="bf_dom editable" rel:bf_bucket_data="{\'edit\':{\'id\':\'#{campaignid}\',\'field\':\'fb_blurb\'}}">#{fb_blurb}</p><div id="#{campaignid}-fb_blurb-length" class="blurb_length"></div> 				 <a rel:gtrack_id="preview/fb-ad/link" class="bf_dom" rel:bf_bucket_data="{\'edit\':{\'id\':\'#{campaignid}\',\'field\':\'fb_link_url\'}}" href="#{fb_link_url}" onclick="return false" contentEditable="true">#{fb_link_url}</a> 			 </div> 			</div>   		</div> 		<a rel:gtrack_id="preview/fb-ad/edit" class="edit button" href="javascript:;" onclick="multiboost.toggle_fb_contenteditable(this.parentNode); return false;">Edit</a> 		<a rel:gtrack_id="preview/fb-ad/preview" class="bf_dom save button" href="javascript:;" rel:bf_bucket_data="{\'fb-save\':{\'id\':\'#{campaignid}\'}}">Preview</a> 	');this.FACEBOOK_BUZZ_KEYWORDS=new Template(' 		<div class="c"> 			<div class="interests"> 			  <div class="interest_field"> 					<input rel:gtrack_id="preview/fb-ad/keywords/input" class="keyword" placeholder="Enter an interest" onkeyup="facebook.updateKeywords(\'#{unique_id}\',this.value,true)" type="text" id="kw-#{unique_id}" /> 					<input rel:gtrack_id="preview/fb-ad/keywords/search" id="search-#{unique_id}" onclick="var kw_val = $(\'kw-#{unique_id}\').value; if (kw_val && kw_val.strip() != \'\') {facebook.lookup_keywords(this.parentNode,$(\'kw-#{unique_id}\').value, \'#{unique_id}\');}" type="button" value="+" /> 					<img id="lookup-loading-#{unique_id}" style="display:none;" src="#{static_root}/images/public/spinners/small_on_white.gif" /> 			  	<p style="display:none;" id="users-reach-#{unique_id}">Keyword Reach: <span id="users-#{unique_id}">&hellip;</span></p> 				</div> 				<div style="display: none;" id="keywords-#{unique_id}" onmouseover="clearTimeout(this.hide_timeout);" onmouseout="facebook.keyword_suggest_mouseout(\'#{unique_id}\');" class="keywords_list"></div> 				<ul class="keywords" id="terms-#{unique_id}"></ul> 			</div> 		</div> 		<div class="reach" id="post-reach-#{unique_id}" style="display:none;"><strong>Estimated Reach:</strong> <span id="post-#{unique_id}">&hellip;</span></div> 	');this.COMMA_DELIMITER=/(\d)(\d\d\d)(,\d{3,})*$/;this.get_tier_from_cookie=function(){var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);var tier="1";if(obj_str){var obj=eval("("+unescape(obj_str)+")");tier=obj.tier;multiboost.select_tier({tier:tier})}return tier};this.init=function(){if(!acl.user_can("can_boost")){return}if(Prototype.Browser.IE6){$("step_crumbs").hide();$("boost_ie6_warning").removeClassName("hidden");return}try{multiboost.already_boosted=[];multiboost.buzz_cache={};multiboost.set_page({step:"select_tier"});multiboost.get_boosts_setup();multiboost.boost_search_element="search-buzz";multiboost.boost_search_spinner="search-buzz-spinner";multiboost.boost_list_preview_element="selected-buzz";multiboost.boost_list_preview_spinner="selected-buzz-spinner";multiboost.customization_table="customization-table";multiboost.update_cart_icon();if(window.location.href.match(/\/(buzz|_)?(old_)?boost(2)?(_modal)?/)){universal_dom.assign_handler({bucket:"update_field",handler:multiboost.update_field});universal_dom.assign_handler({bucket:"select-tier",event:"click",handler:multiboost.select_tier});universal_dom.assign_handler({bucket:"upgrade-tier",event:"click",handler:function(args){multiboost.select_tier({tier:multiboost.tier_id+1});if(args.choose_buzz){multiboost.choose_buzz()}if(args.customize_buzz){multiboost.customize_buzz()}}});universal_dom.assign_handler({bucket:"upgrade-tier-and-add",event:"click",handler:function(args){multiboost.select_tier({tier:multiboost.tier_id+1});multiboost.add_buzz_to_boost_list({campaignid:args.buzz_id});$("boost_modal_upgrade").hide();$("boost_modal_selected_upgrade").show();if(args.close){multiboost.start_timer(5)}}});universal_dom.assign_handler({bucket:"select-tier-and-add",event:"click",handler:function(args){multiboost.select_tier({tier:args.tier});multiboost.add_buzz_to_boost_list({campaignid:args.buzz_id});$("boost_modal_choose_tier").hide();$("boost_modal_selected_tier").show();if(args.close){multiboost.start_timer(8)}}});universal_dom.assign_handler({bucket:"confirm-removal-buzz-from-list",event:"click",handler:multiboost.confirm_removal_buzz_from_boost_list});universal_dom.assign_handler({bucket:"close-modal",event:"click",handler:function(){universal_dom.get_bucket_elements("boost-modal").each(function(el){el.hide()})}});universal_dom.assign_handler({bucket:"pull-buzz-from-list",event:"click",handler:multiboost.remove_buzz_from_boost_list});universal_dom.assign_handler({bucket:"add-buzz-to-list",event:"click",handler:multiboost.add_buzz_to_boost_list});universal_dom.assign_handler({bucket:"search-next-page",event:"click",handler:function(e){multiboost.search_page++}});universal_dom.assign_handler({bucket:"search-previous-page",event:"click",handler:function(e){multiboost.search_page--}});universal_dom.assign_handler({bucket:"user-search-input",event:"keypress",handler:function(e){if(e.keyCode==Event.KEY_RETURN){Event.stop(e);multiboost.search_page=0;multiboost.search_for_user_posts({username:$("username_search_input").value})}}});universal_dom.assign_handler({bucket:"user-search",event:"click",handler:function(e){multiboost.search_page=0;multiboost.search_for_user_posts({username:$("username_search_input").value})}});universal_dom.assign_handler({bucket:"open-search",event:"click",handler:multiboost.open_search});universal_dom.assign_handler({bucket:"change-tier",event:"click",handler:function(){multiboost.set_page({step:"select_tier"})}});universal_dom.assign_handler({bucket:"choose-buzz",event:"click",handler:multiboost.choose_buzz});universal_dom.assign_handler({bucket:"customize-buzz",event:"click",handler:multiboost.customize_buzz});universal_dom.assign_handler({bucket:"edit",event:"keyup",handler:multiboost.edit_buzz});universal_dom.assign_handler({bucket:"fb-save",event:"click",handler:function(data){multiboost.toggle_fb_contenteditable(data.element.parentNode);multiboost.edit_buzz(data)}});universal_dom.assign_handler({bucket:"set-page",event:"click",handler:multiboost.set_page});universal_dom.assign_handler({bucket:"save-buzz",event:"click",handler:function(data){data.target.form=$("edit-quickpost-form");user_post.save_quickpost(data)}});universal_dom.assign_handler({bucket:"boost_payment",event:"click",handler:multiboost.boost_payment});universal_dom.assign_handler({bucket:"update_amount",event:"blur",handler:multiboost.update_amount});universal_dom.assign_handler({bucket:"reboost",event:"click",handler:multiboost.reboost});universal_dom.assign_handler({bucket:"boost-help",event:"click",handler:multiboost.help_dialog});multiboost.refresh_boosted_buzz_preview();multiboost.search_page=1;if(window.location.href.match(/\/(buzz)?(old_)?boost(2)?/)){if(typeof(user_post)!="undefined"){user_post.init();user_post.CONTRIBUTE_URL="/buzzfeed/_temp_wrapper";user_post.ENHANCED_URL="/buzzfeed/_temp_wrapper";EventManager.observe("user_post:save:preparing",function(data){data.action="save_quickpost";data.anonymous=true;data.manual_moderation=1});EventManager.observe("user_post:create:opening_form",multiboost.listen_for_enhanced);EventManager.observe("user_post:save:success",multiboost.save_ok);EventManager.observe("user_post:create:opening_form",multiboost.setup_preview);user_setting={save_image:multiboost.save_image}}}if(typeof(facebook)!="undefined"){facebook.FB_KEYWORDS_CONTROLLER="/buzzfeed/_temp_wrapper"}if(multiboost.tier&&window.location.href.indexOf("#customize")!=-1){var timeout_incr=0,fn=function(){try{multiboost.customize_buzz()}catch(e){if(timeout_incr<=10){setTimeout(fn,250)}timeout_incr++}};fn()}}}catch(e){}};this.get_boosts_setup=function(){multiboost.boost_list=multiboost.load_boost_list();multiboost.tier_id=multiboost.get_tier_from_cookie();multiboost.tier=multiboost.TIER_DEFINITIONS[multiboost.tier_id]};this.contact_customer_service=function(){var user=new top.BF_User();return window.location.href.indexOf("/old_boost")!=-1&&user.isLoggedIn()&&user.getUserInfo().f_raw==0};this.commify=function(num){num=num+"";while(num.match(multiboost.COMMA_DELIMITER)){num=num.replace(multiboost.COMMA_DELIMITER,"$1,$2$3")}return num};this.reboost=function(args){if(!args.ad_multiboost_id){return}var ajax=new BF_Request();ajax.request("/buzzfeed/buzzboost",{method:"get",parameters:{action:"reboost",ad_multiboost_id:args.ad_multiboost_id}})};this.has_active_multiboost=function(){var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);return obj_str!=null};this.has_room_for_more_boosts=function(){if(!multiboost.has_active_multiboost){return false}return multiboost.tier.max_boosts-multiboost.boost_list.length};this.update_field=function(data,args){var value=eval(args.value),comma_delimiter=eval(args.comma_delimiter);if(comma_delimiter){value=multiboost.commify(value)}args.element.update(value)};this.update_amount=function(data){$("submit").removeClassName("hidden");var amount=parseInt(data.element.value,10),rate=multiboost.tier.default_rate,min_buy=multiboost.tier.min_buy,max_buy=multiboost.tier.max_buy;if(!amount||amount==NaN){amount=0}if(amount<min_buy||amount>max_buy){if($("amount-error-field")&&$("amount-error-field-text")){$("amount-error-field-text").update("Your amount must be between $"+multiboost.commify(min_buy)+" and $"+multiboost.commify(max_buy)+".");$("amount-error-field").show();$("submit").addClassName("hidden")}amount=""}else{if($("amount-error-field")){$("amount-error-field").hide()}}data.element.value=amount;var minimum_impressions=multiboost.commify(parseInt(amount/rate,10));universal_dom.get_bucket_elements("minimum_impressions").each(function(el){el.update(minimum_impressions)})};this.boost_payment=function(){var overrides={};var subsequent_punctuation=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");for(var each in multiboost.buzz_cache){var buzz=multiboost.buzz_cache[each];if(buzz.fb_blurb){buzz.fb_blurb=buzz.fb_blurb.unescapeHTML();buzz.fb_blurb=buzz.fb_blurb.replace(/<[^>]*>/g,"").substr(0,89);buzz.fb_blurb=buzz.fb_blurb.replace(/[^\w\d \.\,\!\'\"\?]/g,"");while(buzz.fb_blurb.match(subsequent_punctuation)){buzz.fb_blurb=buzz.fb_blurb.replace(subsequent_punctuation,"$1 $2")}}if(buzz.fb_name){buzz.fb_name=buzz.fb_name.unescapeHTML();buzz.fb_name=buzz.fb_name.replace(/<[^>]*>/g,"").substr(0,24);buzz.fb_name=buzz.fb_name.replace(/[^\w\d \.\,\!\'\"\?]/g,"");while(buzz.fb_name.match(subsequent_punctuation)){buzz.fb_name=buzz.fb_name.replace(subsequent_punctuation,"$1 $2")}}overrides[each]={name:multiboost.buzz_cache[each].fb_name,blurb:multiboost.buzz_cache[each].fb_blurb}}var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);obj=eval("("+unescape(obj_str)+")")||{};obj.overrides=overrides;createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON(obj)),null,".buzzfeed.com");window.location.href=BOOST_PAYMENT_FORM};this.set_page=function(args){universal_dom.get_bucket_elements("step").each(function(el){var info=el.getAttribute("rel:bf_bucket_data");var data=eval("("+info+")");el.removeClassName("selected");universal_dom.get_bucket_elements(data.step).each(function(id){id.addClassName("hidden")})});universal_dom.get_bucket_elements("step").each(function(el){var info=el.getAttribute("rel:bf_bucket_data");var data=eval("("+info+")");if(data.step==args.step){el.addClassName("selected");universal_dom.get_bucket_elements(data.step).each(function(id){id.removeClassName("hidden")})}});multiboost._retrigger_gtrack("1")};this.open_search=function(){$(multiboost.boost_search_element).update("");if(multiboost.exceeded_max_boosts()){return}else{multiboost.set_page({step:"search"})}var user=new BF_User();if(user.isLoggedIn()){universal_dom.get_bucket_elements("user-search-input").each(function(el){el.value=user.getUserInfo().username})}};this.choose_buzz=function(){multiboost.search_page=1;multiboost.set_page({step:"choose"});universal_dom.get_bucket_elements("selected-buzz-count").each(function(el){el.update(multiboost.boost_list.length)});if($("select-quickpost-box")){$("select-quickpost-box").show()}if(multiboost.boost_list&&multiboost.boost_list.length>0){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(el){el.removeClassName("hidden")})}};this.setup_preview=function(args){var which_template=args.buzz_type=="link"?"preview-link-template":"preview-common-template";if(!which_template||!$(which_template)){return}var template=$(which_template).innerHTML;template=template.replace(/%7B/g,"{");template=template.replace(/%7D/g,"}");multiboost.preview_template=new Template(template);var user=new BF_User();var data;if(user.isLoggedIn()){data=user.getUserInfo();if(!data.display_name){data.display_name=data.username}data.user_image=data.user_image||"/static/images/public/defaults/user.jpg";data.name="Your Title Here!";data.link_buzz="example.com";data.blurb="Your description here.";data.image=BF_STATIC.image_root+"/static/images/public/defaults/thumb.png"}else{data={display_name:"You!",username:"anonymous",userid:0,blurb:"Your description here.",user_image:"/static/images/public/defaults/user.jpg",image:BF_STATIC.image_root+"/static/images/public/defaults/thumb.png",name:"Your Title Here!",link_buzz:"example.com"}}data.form=args.buzz_type;multiboost.update_preview(data);$("quickpost-title").observe("keyup",function(e){multiboost.update_preview({name:TT_Filters.html(e.target.value)})});$("quickpost-description").observe("keyup",function(e){multiboost.update_preview({blurb:TT_Filters.boost_preview(e.target.value)})});$("quickpost-link-url").observe("keyup",function(e){multiboost.update_preview({link_buzz:TT_Filters.html(e.target.value)})});["video-link-thumbnail","image-preview","embed-thumbnail","link-thumbnail"].each(function(id){$(id).observe("load",function(e){var isrc=e.target.getAttribute("src");multiboost.update_preview({image:isrc})})});multiboost.set_page({step:"create-buzz"})};this.update_preview=function(args){for(var each in args){multiboost.preview_data[each]=args[each]}var html=multiboost.preview_template.evaluate(multiboost.preview_data);$("preview").update(html);var links=$("preview").getElementsByTagName("A");for(var i=0;i<links.length;i++){links[i].setAttribute("onclick","return false")}};this.save_image=function(path,image,region,sendTo){var params=region;if(typeof sendTo=="undefined"){sendTo="/buzzfeed/_edit_user_image"}else{params.type=$("buzz-type").value+"buzz"}if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=function(resp){multiboost.image_saved(resp)};var er=function(){multiboost.error()};var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};this.image_saved=function(resp){if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){if($("quickpost-enhanced-image-file")){$("quickpost-enhanced-image-file").value=obj.thumb_image}if($("quickpost-embed-image-file")){$("quickpost-embed-image-file").value=obj.thumb_image}if($("quickpost-link-image-file")){$("quickpost-link-image-file").value=obj.thumb_image}if($("quickpost-quiz-image-file")){$("quickpost-quiz-image-file").value=obj.thumb_image}if($("quickpost-video-image-file")){$("quickpost-video-image-file").value=obj.thumb_image}if($("quickpost-image-image-thumb")){$("quickpost-image-image-thumb").value=obj.thumb_image}if($("quickpost-image-image-file")){$("quickpost-image-image-file").value=obj.large_image}if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+obj.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+obj.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+obj.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+obj.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+obj.thumb_image;$("image-preview").show();$("image-preview-div").show()}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+obj.thumb_image;$("quiz-thumbnail").show()}this.settings.image=obj.image}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};this.save_ok=function(args){multiboost.add_buzz_to_boost_list({campaignid:args.json.id});multiboost.set_page({step:"choose"})};this.exceeded_max_boosts=function(){var exceeded=false;if(multiboost.tier&&multiboost.boost_list.length>=multiboost.tier.max_boosts){var msg="You cannot create more boosts. ";if(multiboost.tier.max_boosts<10){var next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);msg+="You can upgrade to "+(next_tier?next_tier.name:"a higher plan")+" if you want more boosts."}alert(msg);exceeded=true;window.setTimeout(multiboost.choose_buzz,250)}return exceeded};this.listen_for_enhanced=function(args){if(multiboost.exceeded_max_boosts()){return}if(args.buzz_type=="enhanced"){var modify_url=function(c){if((typeof TopList!="undefined"&&typeof TopList.EDIT_ENHANCED_IMAGE!="undefined")||(typeof ClassifyQuiz!="undefined"&&typeof ClassifyQuiz.EDIT_ENHANCED_IMAGE!="undefined")){if(typeof TopList!="undefined"){TopList.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}if(typeof ClassifyQuiz!="undefined"){ClassifyQuiz.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}}else{if(c<40){setTimeout(function(){modify_url(c+1)},250)}else{alert("We are unable to process your request at this time.")}}};modify_url(0)}};this.select_tier=function(args){if(multiboost.contact_customer_service()){alert("There is a problem with your account. Please contact support@buzzfeed.com")}else{multiboost.tier_id=args.tier;multiboost.tier=multiboost.TIER_DEFINITIONS[multiboost.tier_id];if(!multiboost.tier){return}var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME),next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);obj=eval("("+unescape(obj_str)+")")||{};if(multiboost.boost_list.length>multiboost.tier.max_boosts){multiboost.boost_list=multiboost.boost_list.splice(0,multiboost.tier.max_boosts)}createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");multiboost.refresh_boosted_buzz_preview();multiboost.choose_buzz();universal_dom.get_bucket_elements("current-tier").each(function(el){el.update(multiboost.tier.name)});universal_dom.get_bucket_elements("next-tier").each(function(el){el.update(next_tier&&next_tier.name?next_tier.name:multiboost.tier.name)});universal_dom.get_bucket_elements("max-buzz-for-tier").each(function(el){el.update(multiboost.tier.max_boosts)});if(multiboost.boost_list&&multiboost.boost_list.length>0){universal_dom.get_bucket_elements("has-no-buzz").each(function(el){el.hide()})}}};this.load_boost_list=function(){var boost_list=[];var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);if(obj_str){obj=eval("("+unescape(obj_str)+")");boost_list=obj.boosts}return boost_list};this.boost_list_upsell=function(){if(multiboost.boost_list.length>=multiboost.tier.max_boosts&&multiboost.tier.level<3){var preview_elm=$(multiboost.boost_list_preview_element);preview_elm.select(".upsell").each(function(el){el.remove()});var li=document.createElement("li"),next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);li.className="upsell preview";li.innerHTML='<div class="msg">Want to boost more posts?<br /><a href="javascript:;" rel:gtrack_id="upgrade-tier/choose" class="bf_dom" rel:bf_bucket_data="{\'upgrade-tier\':{\'choose_buzz\':true}}" onclick="return false;">Upgrade</a> to '+(next_tier?next_tier.name:"a higher plan")+".</div>";preview_elm.appendChild(li);universal_dom.update(preview_elm)}};this.already_boosted_this=function(id){alert("This buzz already has been boosted and cannot be reboosted until its current campaign finishes.");multiboost.remove_buzz_from_boost_list({id:id})};this.add_buzz_to_boost_list=function(args){if(multiboost.exceeded_max_boosts()){return}var id=args.campaignid;if(!id){multiboost.debug("add_buzz_to_boost_list requires campaignid",args)}var ok=true;multiboost.already_boosted.each(function(id){if(id==args.campaignid){multiboost.already_boosted_this(id);ok=false}});if(ok){if(multiboost.boost_list.length<multiboost.tier.max_boosts){var dup=false;multiboost.boost_list.each(function(bid){if(id==bid){dup=true}});if(!dup){multiboost.boost_list.push(id)}}var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);obj=eval("("+unescape(obj_str)+")")||{};createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");universal_dom.get_bucket_elements("selected-buzz-count").each(function(el){el.update(multiboost.boost_list.length)});universal_dom.get_bucket_elements("has-no-buzz").each(function(el){el.hide()});multiboost.refresh_boosted_buzz_preview();try{if(window!=window.top){window.top.multiboost.get_boosts_setup();window.top.multiboost.update_cart_icon()}else{multiboost.update_cart_icon()}}catch(e){}if(multiboost.boost_list.length){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(el){el.removeClassName("hidden")})}}multiboost._retrigger_gtrack("2")};this.help_dialog=function(args){if(!args.article){return false}universal_dom.get_bucket_elements("boost-help-dialog").each(function(el){el.select(".article").each(function(el2){if(el2.id==args.article){el2.show()}else{el2.hide()}});el.removeClassName("hidden");el.show()})};this.confirm_removal_buzz_from_boost_list=function(args){universal_dom.get_bucket_elements("remove-buzz").each(function(el){el.args=args;universal_dom.assign_handler({bucket:"remove-buzz-button",event:"click",handler:function(e){multiboost.remove_buzz_from_boost_list(el.args);el.hide()}});el.removeClassName("hidden");el.show()})};this.remove_buzz_from_boost_list=function(args){var id=args.campaignid;if(!id){multiboost.debug("add_buzz_to_boost_list requires campaignid",args)}var list=[];multiboost.boost_list.each(function(bid){if(bid!=id){list.push(bid)}});delete multiboost.buzz_cache[id];multiboost.boost_list=list;var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);var obj=eval("("+unescape(obj_str)+")")||{};createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");universal_dom.get_bucket_elements("selected-buzz-count").each(function(el){el.update(multiboost.boost_list.length)});if(multiboost.boost_list.length==0){universal_dom.get_bucket_elements("has-no-buzz").each(function(el){el.show()})}multiboost.refresh_boosted_buzz_preview();multiboost.update_customized_buzz();try{if(window!=window.top){window.top.multiboost.get_boosts_setup();window.top.multiboost.update_cart_icon()}else{multiboost.update_cart_icon()}}catch(e){}if(multiboost.boost_list.length==0){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(el){el.addClassName("hidden")})}multiboost._retrigger_gtrack("3")};this.refresh_boosted_buzz_preview=function(){if(!window.location.href.match(/\/(buzz|_)?(old_)?boost(2)?(_modal)?/)){return}if(!multiboost.tier){return}var missing_buzzes=[];multiboost.boost_list.each(function(bid){if(!multiboost.buzz_cache[bid]){missing_buzzes.push(bid)}});if(missing_buzzes.length>0){var ajax=(new BF_Request).request;ajax("/buzzfeed/_temp_wrapper",{method:"get",parameters:{action:"get_buzzes",buzz_ids:missing_buzzes.join(",")},onSuccess:multiboost._refresh_boosted_buzz_preview,while_processing:{show:multiboost.boost_list_preview_spinner,hide:multiboost.boost_list_preview_element}})}else{multiboost._refresh_buzz_preview({container:$(multiboost.boost_list_preview_element),buzz_list:multiboost.boost_list.slice(0,multiboost.tier.max_boosts).map(function(i){return multiboost.buzz_cache[i]})})}};this._refresh_boosted_buzz_preview=function(r){var obj=eval("("+r.responseText+")");obj.buzzes.each(function(buzz){multiboost.buzz_cache[buzz.campaignid]=buzz});var buzz_list=multiboost.boost_list.slice(0,multiboost.tier.max_boosts).map(function(i){return multiboost.buzz_cache[i]});multiboost._refresh_buzz_preview({container:$(multiboost.boost_list_preview_element),buzz_list:buzz_list});multiboost.update_customized_buzz()};this._refresh_buzz_preview=function(args){if(!args.container){return}var container=$(args.container),buzz_list=args.buzz_list,template_cache={},h3_regex=new RegExp("<h3>"),p_regex=new RegExp('<p class="description">');container.innerHTML="";if(buzz_list&&buzz_list.length>0){buzz_list.each(function(data){var template;if(data){data.image_root=BF_STATIC.image_root;data.user_image=data.user_image||"/static/images/public/defaults/user.jpg";if(!args.template){var templateElement=(data.form=="link"?"preview-link-template":"preview-common-template");if(!template_cache[templateElement]){template_str=$(templateElement).innerHTML;template_str=template_str.replace(/%7B/g,"{");template_str=template_str.replace(/%7D/g,"}");template_cache[templateElement]=new Template(template_str)}template=template_cache[templateElement]}else{template=args.template}data.static_root=BF_STATIC.static_root;var html=template.evaluate(data);var li=document.createElement("li");li.className="preview"+(multiboost.buzz_cache[data.campaignid]?" selected":"")+(data.boosted?" already_boosted":"");li.innerHTML=html;container.appendChild(li);try{if(data.boosted){multiboost.already_boosted.push(data.campaignid)}}catch(e){}}});var imgs=container.getElementsByTagName("img");for(var i=0;i<imgs.length;i++){$(imgs[i]).removeClassName("ad_boost_image")}}multiboost.boost_list_upsell();universal_dom.update(container)};this.search_for_user_posts=function(args){var username=args.username,ajax=(new BF_Request()).request,pagination=$$("#modal_search .pagination").first();if(username==""){return false}if(pagination){pagination.hide()}if(multiboost.search_page<1){multiboost.search_page=1}ajax("/buzzfeed/_temp_wrapper",{method:"get",parameters:{action:"recent_buzz",usernames:username,flag_boosted:1,page:multiboost.search_page},onSuccess:multiboost._search_for_user_posts,while_processing:{show:multiboost.boost_search_spinner,hide:multiboost.boost_search_element}})};this._search_for_user_posts=function(r){var obj=eval("("+r.responseText+")"),container=$(multiboost.boost_search_element),pagination=$$("#modal_search .pagination").first();if(obj.buzzes&&obj.buzzes.length>0){multiboost._refresh_buzz_preview({container:container,buzz_list:obj.buzzes});if(pagination){pagination.show()}}else{container.innerHTML='<p class="suggest">No posts were found. Please check to see if the username exists.</p>';if(pagination){pagination.hide()}}multiboost._retrigger_gtrack("5")};this.customize_buzz=function(){if(!multiboost.contact_customer_service()){multiboost.set_page({step:"customize"});multiboost.update_customized_buzz()}};this.toggle_fb_contenteditable=function(el){var contenteditable=el.hasClassName("contenteditable");el.select(".editable").each(function(elm){if(contenteditable){elm.contentEditable=false;elm.removeAttribute("contentEditable");var obj=eval("("+elm.getAttribute("rel:bf_bucket_data")+")");elm.innerHTML=multiboost.buzz_cache[obj.edit.id][obj.edit.field]}else{elm.setAttribute("contentEditable",true)}});if(contenteditable){el.removeClassName("contenteditable")}else{el.addClassName("contenteditable")}return false};this.filter_facebook_text=function(str){return str.replace(/<[^>]*>/g,"").replace(/(&rsquo;|&lsquo;)/ig,"'").replace(/(&rdquo;|&ldash;)/ig,'"').replace(/(&mdash;|&ndash;)/ig,"-").replace(/&([A-Z0-9\-\#]+);/ig,"").replace(/[^\w\d \-\;\&\.\,\!\'\"\?]/g,"")};this.update_customized_buzz=function(){var buzz_list=multiboost.boost_list.slice(0,multiboost.tier.max_boosts).reject(function(i){return(typeof(multiboost.buzz_cache[i])=="undefined")}).map(function(i){return multiboost.buzz_cache[i]});var temp=document.createElement("ul");temp.className="hidden";var fb_temp=document.createElement("ul");fb_temp.className="hidden";var kw_temp=document.createElement("ul");kw_temp.className="hidden";document.getElementsByTagName("BODY")[0].appendChild(temp);document.getElementsByTagName("BODY")[0].appendChild(fb_temp);document.getElementsByTagName("BODY")[0].appendChild(kw_temp);var subsequent_punctuation=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");buzz_list.each(function(buzz){if(!buzz){return}if(!buzz.link_url){buzz.link_url=""}if(!buzz.fb_name){buzz.fb_name=buzz.title.unescapeHTML();buzz.fb_name=multiboost.filter_facebook_text(buzz.fb_name).substr(0,24).strip();while(buzz.fb_name.match(subsequent_punctuation)){buzz.fb_name=buzz.fb_name.replace(subsequent_punctuation,"$1 $2")}}if(!buzz.fb_blurb){buzz.fb_blurb=buzz.blurb.unescapeHTML();buzz.fb_blurb=multiboost.filter_facebook_text(buzz.fb_blurb).substr(0,89).strip();while(buzz.fb_blurb.match(subsequent_punctuation)){buzz.fb_blurb=buzz.fb_blurb.replace(subsequent_punctuation,"$1 $2")}}if(!buzz.fb_link_url){buzz.fb_link_url=buzz.link_url.replace(/<[^>]*>/g,"")}buzz.unique_id=buzz.campaignid});multiboost._refresh_buzz_preview({container:temp,buzz_list:buzz_list});multiboost._refresh_buzz_preview({container:fb_temp,buzz_list:buzz_list,template:multiboost.FACEBOOK_BUZZ_AD});multiboost._refresh_buzz_preview({container:kw_temp,buzz_list:buzz_list,template:multiboost.FACEBOOK_BUZZ_KEYWORDS});boosts=temp.getElementsByTagName("LI");fbs=fb_temp.getElementsByTagName("LI");kws=kw_temp.getElementsByTagName("LI");var table=$(multiboost.customization_table);table.update("");table.addClassName("loading");for(var i=0;i<boosts.length;i++){var tr=document.createElement("tr"),td1=document.createElement("td"),td2=document.createElement("td"),td3=document.createElement("td"),td4=document.createElement("td"),td5=document.createElement("td");tr.id="preview-"+buzz_list[i].campaignid;td1.className="notice";td1.innerHTML='<div class="cellbox c"><span>&nbsp;</span></div>';tr.appendChild(td1);td2.className="boost_preview";td2.innerHTML='<div class="cellbox c">'+boosts[i].innerHTML+"</div>";tr.appendChild(td2);if(multiboost.tier.level==1){td3.className="fb_preview upsell";var next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);td3.colSpan=2;td3.innerHTML='<div class="cellbox c"><div class="msg"><a href="javascript:;" rel:gtrack_id="upgrade-tier/customize" class="bf_dom" rel:bf_bucket_data="{\'upgrade-tier\':{\'customize_buzz\':true}}" onclick="return false;">Upgrade</a> to '+(next_tier?next_tier.name:"a higher plan")+" for Facebook promotion. </div></div>";tr.appendChild(td3)}else{td3.className="fb_preview";if(fb_errors){if(fb_errors[buzz_list[i].campaignid]){td3.className+=" fb_err"}else{td3.className+=" fb_ok"}}td3.innerHTML='<div class="cellbox c">'+fbs[i].innerHTML+"</div>";tr.appendChild(td3);td4.className="targeting";td4.innerHTML=(multiboost.hide_targeting?"&nbsp;":'<div class="cellbox c">'+kws[i].innerHTML+"</div>");tr.appendChild(td4)}td5.className="actions";td5.innerHTML='<div class="cellbox c"><a class="bf_dom pull-it" href="" title="Remove from Campaign" onclick="return false" rel:bf_bucket_data="{\'confirm-removal-buzz-from-list\':{\'campaignid\':\''+buzz_list[i].campaignid+"'}}\"></a></div>";tr.appendChild(td5);table.appendChild(tr);if(multiboost.tier.level!=1){multiboost.toggle_fb_contenteditable($$("#preview-"+buzz_list[i].campaignid+" .fb_preview .cellbox").first())}multiboost.updateMaxLength((buzz_list[i].campaignid+"-fb_name-length"),24,buzz_list[i].fb_name.length);multiboost.updateMaxLength((buzz_list[i].campaignid+"-fb_blurb-length"),89,buzz_list[i].fb_blurb.length)}universal_dom.update(table);multiboost._retrigger_gtrack("6");table.removeClassName("loading");temp.parentNode.removeChild(temp);fb_temp.parentNode.removeChild(fb_temp);kw_temp.parentNode.removeChild(kw_temp)};this.edit_buzz=function(args){var value=args.target.innerHTML;if(args.update){value=value.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/<[^>]*>/g,"")}value=value.replace(/&nbsp;/ig," ");value=value.replace(/<br>/ig,"");var max=args.field=="fb_name"?24:89;if(value.length>max){value=value.substr(0,max)}var subsequent_punctuation=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");value=value.replace(/[^\w\d \.\,\!\']/g,"");while(value.match(subsequent_punctuation)){value=value.replace(subsequent_punctuation,"$1 $2")}multiboost.buzz_cache[args.id][args.field]=value;multiboost.buzz_cache[args.id].edited=true;$$("#preview-"+args.id+" td.notice").first().removeClassName("warning");if(args.update){multiboost.update_customized_buzz()}if(args.field=="fb_name"||args.field=="fb_blurb"){multiboost.updateMaxLength((args.id+"-"+args.field+"-length"),max,value.length)}};this.i_am_selected=function(el){while(el.tagName.toLowerCase()!="li"&&el.parentNode){el=el.parentNode}if(el.tagName.toLowerCase()=="li"){el.addClassName("selected")}};this.updateMaxLength=function(input_id,maxlen,value){var len=maxlen-value;if($(input_id)){$(input_id).update('<span class="'+(len<=5?"warning":"")+'">'+len+"</span> character"+(len==1?"":"s")+" remaining")}};this.has_added_buzz=function(id){var added=false;if(!multiboost.boost_list){multiboost.boost_list=[]}multiboost.boost_list.slice(0,multiboost.tier.max_boosts).each(function(i){if(id==i){added=true;throw $break}});return added};this.update_cart_icon=function(){if(!multiboost.tier){return}var num=(multiboost.boost_list?multiboost.boost_list.slice(0,multiboost.tier.max_boosts).length:0);universal_dom.get_bucket_elements("boost-cart").each(function(el){if(num>0){if(!el.hasClassName("boost")){el.addClassName("boost")}el.update('<a href="'+BF_STATIC.web_root+'/boost" rel:gtrack_id="utils/boost/'+num+'"><span class="text">Boost</span><span class="num">'+num+"</span></a>")}else{el.removeClassName("boost");el.update('<a rel:gtrack_id="utils/advertise" href="'+BF_STATIC.web_root+'/advertise">Advertise</a>')}var p=el.up(".has_gtrack_unit");if(p){gtrack._init(p)}})};this._retrigger_gtrack=function(str){var el=$("multiboost_container");if(el&&typeof(gtrack)!="undefined"){gtrack._init(el,{skip_impression:true})}};this.start_timer=function(s){$("modal_close_timer_seconds").update(s+" second"+(s!=1?"s":""));$("modal_close_timer").show();var modal_ct_intv=setInterval(function(){--s;$("modal_close_timer_seconds").update(s+" second"+(s!=1?"s":""));if(s<1){clearInterval(modal_ct_intv);top.BF_UI.closeDialog(bf_boost_manager.BOOST_DIALOG_ID,{})}},1000)}};var multiboost=new BF_MultiBoost();BuzzLoader.register(multiboost.init,2);var trackVideo=function(d,b,f,g){if(!f){f=""}if(!g){g=""}var i=gtrack.findCatLabel(d);var j=i?i:gtrack.tt_page;var k=$(d);var a=k[bfjs.read_attr]("src");if(!a){a=g}var h=a?(a.split("?").length>=0?a.split("?")[0].replace(new RegExp(/^http:\/\//i),"").replace(new RegExp(/^www\./i),""):""):"";var c={ready:function(){gtrack.track_events(j,f+"[nc]video:load",h,null,true)},finish:function(){gtrack.track_events(j,f+"[nc]video:end",h,null,true)},play:function(){gtrack.track_events(j,f+"video-play",h,null,true);document.fire("video:play",{playerid:d})}};if(typeof c[b]!="undefined"){c[b]()}};var VimeoTrackVideo=function(){var b=this;var a={};this.init=function(){if((bfjs.isMobile()&&$(".video-embed.vimeo").length)||(!bfjs.isMobile()&&$$(".video_vimeo").length)){if(window.addEventListener){window.addEventListener("message",b.addVideoListener,false)}else{window.attachEvent("onmessage",b.addVideoListener,false)}}};this.addVideoListener=function(g){if(typeof g.origin=="undefined"||g.origin!="http://player.vimeo.com"){return}var d=null,c=null,h=null;if(bfjs.isMobile()){d=JSON.parse(g.data);h="#"+d.player_id}else{d=g.data.evalJSON();h=d.player_id}c=$(h);if(!d||!c){return}if(d.event=="ready"){a[h]={};var f=c[bfjs.read_attr]("src").split("?")[0];if(bfjs.isMobile()){c=$(h)[0]}b.addEvent("addEventListener","play",c,f);b.addEvent("addEventListener","finish",c,f)}if(a[h]&&!a[h][d.event]){trackVideo(h,d.event);a[h][d.event]=true}};this.addEvent=function(h,g,d,c){var f={method:h};if(g){f.value=g}d.contentWindow.postMessage(JSON.stringify(f),c)};this.init()};bfjs.onPageLoad(function(){new VimeoTrackVideo()});var YT_PLAYERS={};var YoutubeTrackVideo=function(){var b=this;var a={},c={};this.init=function(){if(isIE8()){document.observe("video:dfp",function(f){var d=$(f.target.id).select("object");if(!d.length||!d[0].getAttribute("id")){return}c[d[0].getAttribute("id")]={src:f.memo.src,dfp:f.memo.dfp}})}};this.addVideoListener=function(d){a[d]={};var f=$(d).readAttribute("src"),g="";if(f==null){f=c[d].src;if(c[d].dfp){g="dfp/"}}else{if(f){g=f.match(/dfp=true/)?"dfp/":""}}this.addEvent(d,g,f)};this.getVideoTimestamp=function(d){return Math.floor($(d).getCurrentTime())};this.addEvent=function(d,h,g){var f="yt"+Math.floor(Math.random()*100000);YT_PLAYERS[f]={pollIntervalID:0,onStateChanged:function(j){var i=b.getEventType(j);if(i=="play"){if(this.pollIntervalID===0){this.pollIntervalID=setInterval(function(){var k=b.getVideoTimestamp(d);b.ad_tracking(k,d)},1000)}}else{if(i=="paused"||i=="finish"){clearInterval(this.pollIntervalID);this.pollIntervalID=0}}if(!a[d][j]){if(i){trackVideo(d,i,h,g)}a[d][j]=true}}};if($(d).addEventListener){$(d).addEventListener("onStateChange","YT_PLAYERS."+f+".onStateChanged",false)}else{$(d).attachEvent("onStateChange","YT_PLAYERS."+f+".onStateChanged",false)}};this.ad_tracking=function(p,o){var h=BF_STATIC.generated_timestamp;var d=1420934399;var m=1420070399;var l=121;var f=190;var r=BF_STATIC.campaignid=="3547183";var i=BF_STATIC.campaignid=="3468742";var k=0;if(typeof p!=="undefined"){k=parseInt(p,10)}if(BF_STATIC.tt_page=="Buzz"){if(l===parseInt(p,10)&&r&&l===parseInt(p,10)){var n=document.createElement("script");n.src="http://mono.vizu.com/cdn/00/01/85/18/beacon_flyover.js?vzsid=buzzfeedproper&ord="+(Math.random()*100000000000000000);document.getElementsByTagName("head")[0].appendChild(n)}else{if(f===parseInt(p,10)&&i&&(m>h)){var n=document.createElement("script");var q=document.createElement("div");var j=$(o);var g=$(document.body);q.style.width="1px";q.style.height="1px";q.id="pixelAd";n.src="http://b.voicefive.com/c2/6768151/rs.js#c1=3&amp;c3=216719053&amp;c4=testsurvey&amp;c5=22222222&amp;c6=&amp;c10=1&amp;c11=&amp;c13=1x1&amp;c16=gen&amp;ax_n=pixelAd&amp;";if(j){j.insert({after:q})}if(g){g.insert(n)}}}}};this.getEventType=function(f){var d="";switch(f){case -1:d="ready";break;case 0:d="finish";break;case 1:d="play";break;case 2:d="paused";break}return d};this.init()};var youtube_track_video=!bfjs.isMobile()?new YoutubeTrackVideo():"";function onYouTubePlayerReady(a){if(youtube_track_video){youtube_track_video.addVideoListener(a)}}var BFTestRunner=function(){this.__mock_objects={};this.called={};this.init=function(){test_runner.force_testmode_on_ajax();this.load_files([{type:"text/css",url:"http://yui.yahooapis.com/2.7.0/build/logger/assets/logger.css"},{type:"text/css",url:"http://yui.yahooapis.com/2.7.0/build/yuitest/assets/testlogger.css"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/yahoo-dom-event/yahoo-dom-event.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/logger/logger-min.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/yuitest/yuitest-min.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/yahoo/yahoo-min.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/json/json-min.js"}]);this.observe("page_load:done",function(){test_runner.load_tests()});document.observe("dom:loaded",function(e){test_runner.fire_event("page_load",{})})};this.on_page=function(page){if(window.location.href.indexOf(page)!=-1){return true}else{var params=window.location.search;if(page.indexOf("?")!=-1){params=params.replace(/\?/,"&")}window.location.href=BF_STATIC.web_root+page+params}return false};this.append_to_function=function(old_fn,appendage){this.__mock_objects["special-"+old_fn]=eval(old_fn);this.mock(old_fn,function(){eval("var supr="+test_runner.__mock_objects[old_fn]);supr(eval(old_fn+".arguments"));appendage(eval(old_fn+".arguments"))})};this.force_testmode_on_ajax=function(params){if(typeof test_runner._request=="undefined"){this._request=Ajax.Request;this._request_events=Ajax.Request.Events;this.mock("Ajax.Request",function(path,params){params.parameters.testmode="on";Ajax.Request.Events=test_runner._request_events;new test_runner._request(path,params)},"special")}};this.remove_special=function(method){if(typeof this.__mock_objects[method]!="undefined"){eval(method+"="+this.__mock_objects["special-"+method])}};this.mock=function(method,fn,prefix){if(prefix){prefix+="-"}else{prefix=""}this.__mock_objects[prefix+method]=eval(method);var object_path=method.split(".");var first_word=eval(object_path[0]);if(typeof first_word=="undefined"||typeof first_word=="object"){this._mock_object(object_path,[]);object_path=method.split(".");var fn_name=object_path.pop();var obj=eval(object_path.join("."));obj[fn_name]=fn}else{if(typeof first_word=="function"&&object_path[1]){var obj=function(){};var old=first_word;for(var each in old.prototype){obj.prototype[each]=old.prototype[each]}obj.prototype[object_path[1]]=fn}}return obj};this.unmock=function(method){if(typeof test_runner.__mock_objects[method]!="undefined"){eval(method+"="+test_runner.__mock_objects[method])}};this.unmock_all=function(){for(var method in test_runner.__mock_objects){if(method.match(/^special-/)){continue}test_runner.unmock(method)}};this._mock_object=function(object_to_build,object_built){object_built.push(object_to_build.shift());var test;try{test=eval(object_built.join("."))}catch(e){var str=object_built.join(".")+" = new Object();";eval(str)}if(test=="undefined"){var str=object_built.join(".")+" = new Object();";eval(str)}if(object_to_build.length>0){this._mock_object(object_to_build,object_built)}};this._init_testmode=function(code){if(typeof test_runner=="undefined"){window.setTimeout(function(){test_runner._init_testmode(code)},200);return}test_runner.run=function(suite){code.suite=suite};code.reload_count=0;code.ajax=function(url,params){try{var response=code.suite.get_response(url,params.parameters);if(params.while_processing.show){$(params.while_processing.show).addClassName("hidden")}params.onSuccess({status:200,responseText:Object.toJSON(response)})}catch(e){if(code.reload_count++<15){window.setTimeout(function(){code.ajax(url,params)},200)}}}};this.generate_event_handler_tests=function(suite,tests){var test_case=new YAHOO.tool.TestCase({name:"Auto-generated event handler tests"});for(var handler in tests){tests[handler].each(function(btn){if(typeof btn.el!="undefined"){btn.id=btn.id||btn.el.className||btn.el.tagName}else{btn.el=$(btn.id)}test_case["test_"+btn.id+"_is_hooked_up_to_"+handler+"_handler"]=function(handler,btn){if(typeof btn.setup!="undefined"){btn.setup()}var called={};if(typeof btn.preface!="undefined"){eval(btn.preface)}test_runner.mock(handler,function(){called[handler]=true;called.arguments=arguments});if(btn.el==null){btn.el=$(btn.id)}test_runner.Assert.isObject(btn.el,"Found "+btn.id+" element on the page");test_runner.UserAction.click(btn.el);test_runner.Assert.areSame(true,called[handler],"Called "+handler+" from "+btn.el.innerHTML+" element ("+btn.id+")");if(btn.args){btn.args.each(function(expected,idx){test_runner.Assert.isDeeply(expected,called.arguments[idx],"Got expected argument in position "+idx)})}}.curry(handler,btn)})}suite.add(test_case)};this.generate_dependency_tests=function(suite,dependencies){var test_case=new YAHOO.tool.TestCase({name:"Auto-generated dependency tests"});dependencies.each(function(dependency){if(typeof dependency=="string"){test_case["test_"+dependency+"_element_id_exists"]=function(dependency){test_runner.Assert.elementIDExists(dependency)}.curry(dependency)}else{if(typeof dependency=="object"){if(dependency.test=="is_defined"){test_case["test_"+dependency.id+"_is_defined"]=function(dependency){test_runner.Assert.isObject(eval(dependency.id),dependency.id+" is loaded")}.curry(dependency)}}}});suite.add(test_case)};this.profile=function(object_name,object){test_runner.call_profile={};YAHOO.tool.TestRunner.subscribe(YAHOO.tool.TestRunner.COMPLETE_EVENT,function(){console.dir({coverage:test_runner.call_profile})});for(var each in object){if(typeof object[each]!="function"){continue}var rnd_name=each+"_"+(new Date()).getTime();object[rnd_name]=object[each];test_runner.call_profile[each]=0;object[each]=Function(object[each].argumentNames(),'test_runner.call_profile["'+each+'"]+=1;'+object_name+"."+rnd_name+"("+(object[each].argumentNames()).join(",")+")")}};var temp=BFW_Util.getCookie("bf_trace_path");this.trace_path=(temp==null)?new Array():eval("("+unescape(temp)+")");this.trace=function(object_name){var object=eval(object_name);var temp={};for(var key in object){temp[key]=object[key]}for(var each in temp){if(typeof object[each]!="function"){continue}if(object[each].toString().match(/trace_wrapper/)){continue}var rnd_name=each+"_"+(new Date()).getTime();object[rnd_name]=object[each];object[each]=Function(object[each].argumentNames(),'				var trace_wrapper = true; var __trace_context="unknown";				try{__trace_context = arguments.callee.caller.toString();}catch(e){} 				var __trace_result;					var __trace_e; 				var __log = {args:arguments,calling:"'+object_name+"."+each+'",context:__trace_context}; 				test_runner.trace_path.push(__log); 				console.dir({"calling_'+object_name+"."+each+'":__log}); 				try {					__trace_e="";					__trace_result='+object_name+"."+rnd_name+"("+(object[each].argumentNames()).join(",")+');				} catch(e){__trace_e=e}; 				__log = {error:__trace_e,_args:arguments,result:__trace_result,called:"'+object_name+"."+each+'",context:__trace_context}; 				test_runner.trace_path.push(__log); 				console.dir({"called_'+object_name+"."+each+'":__log}); 				BFW_Util.setCookie({name:"bf_trace_path",value:escape(Object.toJSON(test_runner.trace_path))}); 				if ( __trace_e != "" ) throw(__trace_e); 				return __trace_result')}};this.dump_trace=function(){var dump=window.open("","");test_runner.trace_path.each(function(entry){var str="<li>";for(var each in entry){str+="<b>"+each+"</b>: "+entry[each]+" ("+typeof entry[each]+") <br />"}str+="</li>";dump.document.writeln(str)})};this.clear_trace=function(){BFW_Util.deleteCookie("bf_trace_path");test_runner.trace_path=new Array()};this.wait_until=function(fn_timer,fn_run,deadlock_suffix){if(fn_timer()){fn_run()}else{if(!deadlock_suffix){deadlock_suffix=(new Date()).getTime();Facebook["__deadlock_"+deadlock_suffix]=0}else{if(Facebook["__deadlock_"+deadlock_suffix]++>100){fn_run()}}window.setTimeout(function(){test_runner.wait_until(fn_timer,fn_run,deadlock_suffix)},200)}};this.add=function(obj){var tr=YAHOO.tool.TestRunner;tr.add(obj)};this.run=function(suite){this._run(true,suite)};this.local_run=function(suite){this._run(false,suite)};this._run=function(post_to_server,suite){var tr=YAHOO.tool.TestRunner;tr.subscribe(tr.TEST_PASS_EVENT,test_runner.unmock_all);tr.subscribe(tr.TEST_FAIL_EVENT,test_runner.unmock_all);if(post_to_server){tr.subscribe(tr.COMPLETE_EVENT,function(results){var oReporter=new YAHOO.tool.TestReporter(BF_STATIC.web_root+"/_fixtures",YAHOO.tool.TestFormat.JSON);oReporter.report(results.results)})}var logger=new YAHOO.tool.TestLogger();if(window.location.href.match(/test_method=/i)){var params=window.location.href.split("&");params.each(function(args){if(args.match(/test_method=/i)){var trash=args.split(/=/);var test_method=trash[1];suite.items.each(function(test){for(var each in test){if(each.match(/^test_/i)&&each!=test_method){delete test[each]}}})}})}if(suite){tr.add(suite)}tr.run()};this.log_in=function(session){var default_session={session_key:"1234567812345678123456781234567812345678123456781234567812345678marcos",display_name:"Test%20User",image:"",username:"marcos",facebook_uid:"",show_account_settings:"true",registration_path:"signin",is_facebook_user:"false",terminal_user:"false",last_active:123456789,isa:"false",user_id:1234567};var obj=session?session:{};for(var key in default_session){if(typeof obj[key]=="undefined"){obj[key]=default_session[key]}}BFW_Util.setCookie({name:BFW_COOKIE,value:obj.session_key});var info_cookie="display_name="+obj.display_name;info_cookie+="&image="+obj.image;info_cookie+="&username="+obj.username;info_cookie+="&facebook_uid="+obj.facebook_uid;info_cookie+="&show_account_settings="+obj.show_account_settings;info_cookie+="&registration_path="+obj.registration_path;info_cookie+="&is_facebook_user="+obj.is_facebook_user;info_cookie+="&terminal_user="+obj.terminal_user;info_cookie+="&isa="+obj.isa;BFW_Util.setCookie({name:BFW_INFO_COOKIE,value:info_cookie})};this.log_out=function(){BFW_Util.deleteCookie(BFW_COOKIE);BFW_Util.deleteCookie(BFW_INFO_COOKIE);BFW_Util.deleteCookie(DEFAULT_USER)};this.extendAssertions=function(){test_runner.Assert=YAHOO.util.Assert;test_runner.UserAction={};for(var each in YAHOO.util.UserAction){if(each=="click"){test_runner.UserAction[each]=function(obj){if(obj.click){obj.click()}else{YAHOO.util.UserAction.click(obj)}}}else{test_runner.UserAction[each]=YAHOO.util.UserAction[each]}}test_runner.Assert.isVisible=function(id,msg){var value=$(id).visible()&&!$(id).hasClassName("hidden");test_runner.Assert.areEqual(true,value,msg?msg:id+" is visible")};test_runner.Assert.isHidden=function(id,msg){var value=$(id).visible()&&!$(id).hasClassName("hidden");test_runner.Assert.areEqual(false,value,msg?msg:id+" is hidden")};test_runner.Assert.isLike=function(str,regex,msg){test_runner.Assert.isNotNull(str.match(regex),msg?msg:str+" matches regex")};test_runner.Assert.isNotLike=function(str,regex,msg){test_runner.Assert.isNull(str.match(regex),msg?msg:str+" matches regex")};test_runner.Assert.elementIDExists=function(id,msg){test_runner.Assert.isNotNull($(id),msg?msg:id+" is on the page")};test_runner.Assert.isDeeply=function(obj1,obj2,msg){if(typeof obj1=="object"){for(var each in obj1){test_runner.Assert.isDeeply(obj1[each],obj2[each],msg)}}else{test_runner.Assert.areSame(obj1,obj2,msg)}}};this.load_tests=function(){var params=test_runner.parse_params();var tests_to_run=params.test_suite?test_runner.__test_suites[params.test_suite]():[];if(params.tests){var tests=params.tests.split(",");for(var i=0;i<tests.length;i++){tests_to_run.push(test_runner.__tests[tests[i]])}}if(params.test){tests_to_run.push(test_runner.__tests[params.test])}test_runner._wait_for_yahoo(test_runner.extendAssertions);test_runner._wait_for_yahoo(function(){test_runner.load_files(tests_to_run)})};this._wait_for_yahoo=function(fn){if(typeof this.__wait_count=="undefined"){this.__wait_count=0}else{if(this.__wait_count++>1000){alert("Took too long to load Yahoo files");return}}if(typeof YAHOO=="undefined"||typeof YAHOO.util=="undefined"||typeof YAHOO.util.UserAction=="undefined"||typeof YAHOO.util.Assert=="undefined"){window.setTimeout(function(e){test_runner._wait_for_yahoo(fn)},200)}else{fn()}};this.cookie=function(key){var cookie_arr=document.cookie.split(";");var cookie={};for(var i=0;i<cookie_arr.length;i++){var key_val=cookie_arr[i].split("=");key_val[0]=key_val[0].replace(/ /g,"");cookie[key_val[0]]=key_val[1]}return unescape(cookie[key])};this.parse_params=function(str){var params={};if(!str){str=window.location.search.substring(1)}var key_values=str.split("&");for(var i=0;i<key_values.length;i++){var data=key_values[i].split("=");if(data.length==2){params[data[0]]=data[1]}else{params[data[0]]=true}}return params};this.$=function(id){if($(id)){return $(id)}return $(test_runner.DOM_SYNONYMS[id])};this.load_files=function(files){if(typeof files=="string"){files=[{type:"text/javascript",url:files}]}for(var i=0;i<files.length;i++){var file_data=files[i];if(typeof file_data=="undefined"){continue}if(typeof file_data=="string"){file_data={type:"text/javascript",url:file_data}}if(file_data.type=="text/javascript"){this.load_javascript(file_data)}else{if(file_data.type=="text/css"){this.load_css(file_data)}else{console.error("unrecognized file type to load: "+file_data.type)}}}};this.load_javascript=function(data){var tag=document.createElement("script");tag.setAttribute("type",data.type);tag.setAttribute("src",data.url);tag.setAttribute("defer","false");if(document.getElementsByTagName("HEAD")=="undefined"){this.observe("page_load",function(){document.getElementsByTagName("HEAD")[0].appendChild(tag)})}else{document.getElementsByTagName("HEAD")[0].appendChild(tag)}};this.load_css=function(data){var tag=document.createElement("link");tag.setAttribute("rel","stylesheet");tag.setAttribute("type",data.type);tag.setAttribute("href",data.url);if(document.getElementsByTagName("HEAD")=="undefined"){this.observe("page_load",function(e){document.getElementsByTagName("HEAD")[0].appendChild(tag)})}else{document.getElementsByTagName("HEAD")[0].appendChild(tag)}};this.observe=function(ev,fn){if(!this.__EVENTS[ev]){this.__EVENTS[ev]=[]}this.__EVENTS[ev].push(fn)};this.fire_event=function(ev,args){var fns=test_runner.__EVENTS[ev]?test_runner.__EVENTS[ev]:[];for(var i=0;i<fns.length;i++){fns[i](args)}if(ev.indexOf(":done")==-1){test_runner.fire_event(ev+":done",args)}};this.__EVENTS={};this.DOM_SYNONYMS={};this.__tests={buzz_stats:"/static/js/public/test/buzz_stats.js",demo:"/static/js/public/test/demo.js",login:"/static/js/public/test/login.js",register:"/static/js/public/test/register.js",profile:"/static/js/public/test/profile.js",prepopulated_quickpost:"/static/js/public/test/prepopulated_quickpost_test.js",save_buzz:"/static/js/public/test/save_buzz_test.js",facebook2:"/static/js/public/test/facebook2_test.js",badges:"/static/js/public/test/badge_test.js",session_tracking:"/static/js/public/test/session_test.js",micro_sites:"/static/js/public/test/microsite_test.js",handler_test:"/static/js/public/test/generic_handler.js",signup:"/static/js/public/test/new_signup_page.js",settings:"/static/js/public/test/new_settings.js",quickpost:"/static/js/public/test/quickpost_test.js",dashboard:"/static/js/public/test/dashboard_test.js","dashboard-stats":"/static/js/public/test/dashboard-stats-test.js",dashboard_ad:"/static/js/public/test/dashboard_ad_test.js",dashboard_widget:"/static/js/public/test/dashboard_widget_test.js",dashboard_user_stats:"/static/js/public/test/dashboard_user_stats_test.js",realtimeweb:"/static/js/public/test/realtimeweb_test.js",user_switching:"/static/js/public/test/user_switching_test.js",user_tracking:"/static/js/public/test/user_tracking.js",user_panel:"/static/js/public/test/user_panel_test.js",universal_dom_traversal:"/static/js/public/test/universal_dom_traversal_test.js",social:"/static/js/public/test/social_test.js"};this.__test_suites={all:function(){var suite=[];for(var each in test_runner.__tests){suite.push(test_runner.__tests[each])}return suite}}};test_runner=new BFTestRunner();if(test_runner.parse_params()["testmode"]=="on"){test_runner.init()}var BF_Pixel=new (function(){var a=this;this.save=function(f){if(typeof f!="object"){return false}if(!f.hasOwnProperty("dir")){return false}var b=new Image(),d=f.hasOwnProperty("params")?f.params:{},c=a.web_path()+f.dir;d.z=Math.round((Math.random()*100000000));d="?"+a.encode_params(d);c+=d;b.setAttribute("height","1");b.setAttribute("width","1");if(BF_STATIC.env=="dev"||BF_STATIC.bf_env=="dev"){console.log("BF Pixel: "+c)}else{b.setAttribute("src",c)}return c};this.web_path=function(){if(BF_STATIC.env=="stage"||BF_STATIC.bf_env=="stage"){return"http://pixel.stage.buzzfeed.com/"}else{return"http://pixel.buzzfeed.com/"}};this.encode_params=function(d){var b=[];for(var c in d){b.push(encodeURIComponent(c)+"="+encodeURIComponent(d[c]))}return b.join("&")}})();var Carousel=function(){var b={id:"carousel",next:"cc-next",prev:"cc-prev",item:"thumbnail",items:"thumbnails",show:3};var c=function(d){for(var f=0;f<b.show;f++){d[f].removeClassName("hidden")}};var a=function(){return $$("#"+b.id+" ."+b.item+":not(.hidden)")};return{init:function(f){if(f){b=$H(b).merge(f);b=b._object}var g=this;var d=$$("#"+b.id+" ."+b.item);if(d.length>b.show){if($$("#"+b.id+" ."+b.next).length){$$("#"+b.id+" ."+b.next)[0].removeClassName("hidden");universal_dom.assign_handler({bucket:"carousel_next",event:"click",handler:g.next})}if($$("#"+b.id+" ."+b.prev).length){$$("#"+b.id+" ."+b.prev)[0].removeClassName("hidden");universal_dom.assign_handler({bucket:"carousel_prev",event:"click",handler:g.prev})}}c(d)},next:function(g){Event.stop(g);var j=a();j.each(function(i){i.addClassName("hidden")});for(var f=0;f<j.length;f++){var h=j[f];j[f].remove();$$("."+b.items)[0].insert(h)}var d=$$("#"+b.id+"  ."+b.item);for(var f=0;f<b.show&&d.length>f;f++){d[f].removeClassName("hidden")}},prev:function(h){Event.stop(h);var l=a();l.each(function(i){i.addClassName("hidden")});for(var g=l.length;g>0;g--){var k=l[g-1];l[g-1].remove();$$("."+b.items)[0].insert({top:k})}var d=$$("#"+b.id+"  ."+b.item);for(var g=d.length,f=0;f<b.show;f++,g--){d[g-1].removeClassName("hidden")}}}};var BFcarousel=Carousel();var BF_Click=new function(){var a=this;this.trigger=(bfjs.isMobile()&&BF_STATIC.env=="live"?"click":"mousedown");this.el_types=["a","input","button","i"];this.init=function(){bfjs.universal_each(a.el_types,a.addClickEvents)};this.addClickEvents=function(b){$(document.body).on(a.trigger,b,function(f){var d=bfjs.eventFindEl(f,b),c=d.tagName.toUpperCase();EventManager.fire("bf_click",{el:d,tag:c})})}}();BF_Click.init();EventManager.observe("bf_click",function(b){if(b.tag=="A"){var a=b.el;if(typeof a.href!="undefined"&&a.href.match(/http/)&&!a.href.match(/buzzfee?d.com/)){$(a)[bfjs.write_attr]("target","_blank")}}});var BF_Pound=new function(){var a=this;this.position_tag="pound_position";this.init=function(){EventManager.observe("bf_click",function(b){a.click(b.el)})};this.click=function(c){var b=a.findPosition(c);if(b){$.jStorage.set(a.position_tag,b);if(BF_STATIC.bf_env!="live"){console.log("Pound Position: "+b)}}};this.findPosition=function(d){try{var f=0,b=99;while(d!=document&&f<b){var c=$(d)[bfjs.up]();if(c[bfjs.read_attr](a.position_tag)){return c[bfjs.read_attr](a.position_tag)}else{d=c;f++}}return null}catch(g){return null}}}();if(BF_STATIC.tt_page=="Home"){BF_Pound.init()}bf_report_manager=function(){this.ERR="Sorry, we&rsquo;re unable to process your request at this time. Please try again later.";this.VOTE_UPDATED="Your report has been noted. Thanks for your input.";this.cache={};this.init=function(){if(typeof bf_cache!="undefined"){report_manager.cache=bf_cache}var vote_buttons=$$("a.report-button");vote_buttons.each(function(i){var campaign_id=i.getAttribute("comment_id");if(campaign_id){i.observe("click",function(e){e.stop();report_manager.flag_comment(e);return false})}});var catcha_buttons=$$("input.flag_comment_submit");catcha_buttons.each(function(i){i.observe("click",function(e){e.stop();report_manager.flag_comment(e);return false})});var vote_buttons=$$("a.not-iteresting-button");vote_buttons.each(function(i){var campaign_id=i.getAttribute("contributionid");if(campaign_id){i.observe("click",function(e){e.stop();report_manager.handle_click({e:e,type:"uniteresting"});return false})}});if(acl.user_can("edit_user_accounts")){var admin_classes=new Array("spam-admin","boring-admin","report_user-admin","not_raw-admin","toggle_raw_user-admin","edit-admin");for(var cli=0;cli<admin_classes.length;cli++){var handler=null;if(admin_classes[cli]=="spam-admin"){handler=function(e){e.stop();report_manager.handle_click({e:e,type:"flag"});return false}}else{if(admin_classes[cli]=="boring-admin"){handler=function(e){e.stop();report_manager.handle_click({e:e,type:"uniteresting"});return false}}else{if(admin_classes[cli]=="report_user-admin"){handler=function(e){e.stop();report_manager.handle_click({e:e,type:"edit_user"});return false}}else{if(admin_classes[cli]=="toggle_raw_user-admin"&&acl.user_can("user_moderators")){handler=function(e){e.stop();report_manager.handle_click({e:e,type:"toggle_raw"});return false};if(!acl.user_can("user_moderators")){continue}}else{if(admin_classes[cli]=="not_raw-admin"){handler=function(e){e.stop();report_manager.handle_click({e:e,type:"not_raw"});return false}}else{if(admin_classes[cli]=="edit-admin"){handler=function(e){e.stop();report_manager.handle_click({e:e,type:"edit_buzz"});return false}}}}}}}var objs=$$("a."+admin_classes[cli]);for(var obji=0;obji<objs.length;obji++){var obj=objs[obji];if(handler){obj.show();obj.observe("click",handler)}}}if($("quickpost-tags")&&typeof bf_page!="undefined"&&bf_page=="moderation"){$("quickpost-tags").observe("keydown",user_post.auto_complete_special);$("quickpost-tags").observe("keyup",user_post.auto_complete);$("quickpost-tags").observe("blur",function(){window.setTimeout(function(){$("tag_suggestions").hide()},1000)})}if($("save-edited-buzz")){$("save-edited-buzz").observe("click",report_manager.save_edited_buzz)}if($("edit_image")){$("edit_image").observe("click",report_manager.edit_image);user_setting={save_image:report_manager.save_image};if(typeof bf_page!="undefined"&&bf_page=="moderation"){parent.user_post.save_quickpost_image=function(){}}}}if("universal_dom" in window){universal_dom.assign_handler({bucket:"show-badges",event:"click",handler:report_manager.show_badges})}};this.flag_comment=function(e){var el=e.target;var id=el.getAttribute("comment_id");var sr=function(resp){bf_catcha.catcha_answer="";$("flag_comment").hide();$$('span[comment_id="'+id+'"]')[0].addClassName("reporting")}.bind(this);var er=function(){this.error(el)}.bind(this);var user=new BF_User;var user_data=user.getUserInfo();if((el.id&&el.id=="flag_submit")||confirm("Report this comment?")){var params={comment_id:id,action:"flag_contribution",anonymus:user.isLoggedIn()?0:1,user_id:user_data.userid};(new BF_Request()).request("/buzzfeed/flag_comment",{method:"post",parameters:params,onSuccess:sr,onFailure:er,onCatcha:function(resp){flagComment.move_it(id);if(bf_catcha.catcha_answer){alert("Wrong answer!")}}})}};this.show_badges=function(obj){var show_type="badge";var show_link="show-favorite-link";var hide_link="show-all-link";if(obj.for_type=="favorite"){show_type="favorite";show_link="show-all-link";hide_link="show-favorite-link"}universal_dom.get_bucket_elements("badge").each(function(el){el.addClassName("hidden")});universal_dom.get_bucket_elements(show_type).each(function(el){el.removeClassName("hidden")});var el=$(show_link);if(el){el.removeClassName("hidden")}el=$(hide_link);if(el){el.addClassName("hidden")}};this.edit_image=function(e){var buzz=report_manager.cache.buzzes[report_manager.current_buzz];$("user-image-edit-iframe").src="/static/images/public/spinners/big_on_eee.gif";BF_UI.showDialog("user-image-edit");$("user-image-edit-iframe").src="/buzzfeed/_edit_user_contribution_image?action=imageform&template=public/user/quickpost_imageform.tt";var buzz_type="link";if(buzz.form=="image"){buzz_type="image"}else{if(buzz.form=="video"){buzz_type="video"}}$("user-image-edit-iframe").observe("load",function(ev){ev.target.contentWindow.user_image.setBuzzType(buzz_type)})};this.save_image=function(path,image,region,sendTo){var buzz=report_manager.cache.buzzes[report_manager.current_buzz];var params=region;params.type=buzz.form+"buzz";if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=report_manager.image_saved;var er=report_manager.image_errored;var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};this.image_errored=function(){alert("There was an error trying to save your image")};this.image_saved=function(resp){var buzz=report_manager.cache.buzzes[report_manager.current_buzz];if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){buzz.oldimage=buzz.image;buzz.image=obj.thumb_image;if($("img_preview")){$("img_preview").src=BF_STATIC.image_root+obj.thumb_image}}else{this.image_errored()}};this.save_edited_buzz=function(e){if(acl.user_can("edit_user_posts")){var form=report_manager.edit_form;var errors=[];var required=["name","blurb"];required.each(function(field){if(form.elements[field].value==""){errors.push("Missing required field ("+field+")")}});if(!(form.elements["nsfw-btn"].hasClassName("selected")||form.elements["tame-btn"].hasClassName("selected"))){errors.push("Please specify if it's NSFW or not")}if(errors.length){alert("Cannot save. Please address the following error"+(errors.length>1?"s":"")+":\n"+errors.join("\n"));return}var buzz=report_manager.cache.buzzes[report_manager.current_buzz];for(var each in report_manager.buzz_fields_to_text_fields){if(form.elements[report_manager.buzz_fields_to_text_fields[each]].disabled==false){buzz[each]=form.elements[report_manager.buzz_fields_to_text_fields[each]].value}else{delete buzz[each]}}var badge_checkboxes=$("badge-checkboxes").getElementsByTagName("INPUT");buzz.badges=[];for(var i=0;i<badge_checkboxes.length;i++){var cbox=badge_checkboxes[i];if(cbox.checked){buzz.badges.push(cbox.value)}}var new_tags=form.elements.tags.value.split(",");new_tags.each(function(tag){buzz.tags.push(tag)});buzz.nsfw=form.elements["nsfw-btn"].hasClassName("selected")?"true":"false";var ajax=new BF_Request();buzz.category_id=form.elements.category.options[form.elements.category.selectedIndex].value;var params={action:"update_buzz",buzz:Object.toJSON(buzz),update_html:1};var promotion;for(var i=0;i<form.elements.promotion.length;i++){if(form.elements.promotion[i].checked){promotion=form.elements.promotion[i].value}}if(promotion&&promotion!="none"){params.promotion=promotion;params.action="update_and_promote"}if(promotion=="queue-at"){params["queue-on-day"]=form.elements["queue-on-day"].options[form.elements["queue-on-day"].selectedIndex].value;params["queue-on-hour"]=form.elements["queue-on-hour"].options[form.elements["queue-on-hour"].selectedIndex].value}ajax.request("/buzzfeed/_admin",{method:"post",parameters:params,onSuccess:report_manager._save_edited_buzz,while_processing:{show:$("save-edited-buzz-spinner"),hide:e.target}})}else{alert("You do not have permission to save edited buzz")}};this._save_edited_buzz=function(r){var obj=eval("("+r.responseText+")");if(obj.success==1){try{var buzz=report_manager.cache.buzzes[report_manager.current_buzz];var form=report_manager.edit_form;form.addClassName("hidden");form.parentNode.removeChild(form);document.getElementsByTagName("BODY")[0].appendChild(form);$("buzz-"+buzz.campaignid).update(obj.html)}catch(e){console.dir({e:e})}}};this.cancel_inline_editor=function(){if("bf_post_tools" in window){bf_post_tools.cancel_inline_editor()}else{var buzz=report_manager.cache.buzzes[report_manager.current_buzz];var form=report_manager.edit_form;form.addClassName("hidden");form.parentNode.removeChild(form);document.getElementsByTagName("BODY")[0].appendChild(form);$("buzz-"+buzz.campaignid).appendChild(report_manager.current_snippet)}};this.buzz_fields_to_text_fields={name:"name",blurb:"blurb",short_description:"short_description"};this.load_inline_editor=function(args){if("bf_post_tools" in window){return bf_post_tools.load_inline_editor(args)}var converter=$("_converter");if(!converter){converter=document.createElement("div");converter.id="_converter";converter.addClassName("hidden");document.getElementsByTagName("BODY")[0].appendChild(converter)}if(args.buzz_id&&typeof report_manager.cache.buzzes[args.buzz_id]!="undefined"){var form=$(args.editor_id||"editForm");var show_at=$("buzz-"+args.buzz_id);report_manager.current_buzz=args.buzz_id;report_manager.edit_form=form;var buzz=report_manager.cache.buzzes[args.buzz_id];form.parentNode.removeChild(form);report_manager.current_snippet=show_at.cloneNode(true);show_at.update("");show_at.appendChild(form);form.removeClassName("hidden");form.elements.promotion[0].checked=true;for(var each in report_manager.buzz_fields_to_text_fields){converter.update(unescape(buzz[each]));form.elements[report_manager.buzz_fields_to_text_fields[each]].value=converter.innerHTML}if(buzz.form=="enhanced"){form.elements.short_description.disabled=true;form.elements.short_description.value="Use terminal to edit"}else{form.elements.short_description.disabled=false}buzz.badges.each(function(badge){if(typeof form.elements[badge]!="undefined"){form.elements[badge].checked=true}});var tag_list=$("tag_list");if(tag_list){tag_list.update("");buzz.tags.each(function(tag,idx){if(idx>0&&tag!=""){tag_list.appendChild(document.createTextNode(", "))}tag_list.appendChild(document.createTextNode(tag))})}if(buzz.nsfw=="true"){form.elements["nsfw-btn"].removeClassName("selected");form.elements["tame-btn"].removeClassName("selected")}else{form.elements["tame-btn"].addClassName("selected");form.elements["nsfw-btn"].removeClassName("selected")}if($("img_preview")){$("img_preview").setAttribute("src",BF_STATIC.image_root+buzz.image)}if(buzz.category_id){var categories=form.elements.category.options;for(var i=0;i<categories.length;i++){if(categories[i].value==buzz.category_id){categories[i].selected=true}}}}else{alert("Invalid ID ("+args.buzz_id+")")}};this.handle_click=function(args){var el=args.e.target;if(args.type=="report_user"){this.deleteUser(el,args.type)}else{if(args.type=="edit_user"){this.editUser(el,args.type)}else{if(args.type=="toggle_raw"){this.toggle_raw(el,args.type)}else{if(args.type=="edit_buzz"){this.edit_buzz(el,args.type)}else{this.report(el,args.type)}}}}};this.edit_buzz=function(el,type){this.el=el;var id=el.getAttribute("buzz_id");var isa=false;if(acl.user_can("edit_user_accounts")){isa=true}if(isa){window.open(BF_STATIC.terminal_root_url+"?action=buzz_edit&bid="+id)}};this.toggle_raw=function(el,type){if(!acl.user_can("edit_user_posts")||!acl.user_can("user_moderators")){return alert("You do not have permission to toggle raw")}if(el.event){el=el.event.target}this.el=el;var id=el.getAttribute("user_id");var current_state=el.getAttribute("current_state");var hide_success_dialog=el.getAttribute("rel:hide_success_dialog")==1;if(current_state==0){return}el.innerHTML="User Cannot Post to Raw";this.new_raw_state=current_state=="1"?0:1;var isa=false;if(acl.user_can("edit_user_accounts")){isa=true}if(isa){var ajax=new BF_Request();ajax.request("/buzzfeed/_user_admin",{method:"post",parameters:{action:"update_flags",id:id,raw:this.new_raw_state},onSuccess:function(resp){var msg="This user's posts will be shown in the Raw Feed";if(this.new_raw_state==0){msg="This user's posts will not be shown in the Raw Feed"}if(!hide_success_dialog){alert(msg)}el.setAttribute("current_state",this.new_raw_state)}.bind(this),onFailure:function(resp){ajax.alert("Error contacting server")},bf_auth:true})}};this.editUser=function(el,type){var dialog_id="user_admin_panel";if(typeof el.event!="undefined"){el=el.event.target;dialog_id+=el.getAttribute("user_id")||(new Date()).getTime()}var id=el.getAttribute("user_id");var username=el.getAttribute("username");var isa=false;if(acl.user_can("edit_user_accounts")){isa=true}if(isa){BF_UI.create_or_show_dialog({height:490,scrolling:"no",title:"Edit User",id:dialog_id,url:BF_STATIC.web_root+"/user_panel?username="+username,user_id:id})}};this.deleteUser=function(el,type){if(!acl.user_can("edit_user_accounts")){return alert("You do not have permission to delete user")}if(typeof el.event!="undefined"){el=el.event.target}var id=el.getAttribute("user_id");if(confirm("Are you sure you want to delete this user?")){var ajax=new BF_Request();ajax.request("/buzzfeed/_user_admin",{method:"post",parameters:{action:"delete",id:id},onSuccess:function(resp){alert("user deleted")}.bind(this),onFailure:function(resp){ajax.alert("Error contacting server")},bf_auth:true})}};this.report=function(el,type){var id=el.getAttribute("contributionid");var param_type="boring";if(type=="flag"){param_type="spam"}if(type=="not_raw"){param_type="remove_from_raw_feed"}try{var user=new BF_User();var isa=false;var username="";if(acl.user_can("edit_user_accounts")){isa=true}if(user.isLoggedIn()){var userinfo=user.getUserInfo();if(userinfo.username){username=userinfo.username}}var params={id:id,f:param_type,username:username};try{el.addClassName("reporting");if(type!=="flag"){el.innerHTML="Reporting..."}}catch(e){}var type_string="remove this contribution from this page";if(type=="flag"){var type_string="delete this contribution forever"}else{if(type=="not_raw"){var type_string="remove this contribution from the raw feed"}}if(isa==true){if(confirm("Are you sure you want to "+type_string+"?")){this._request(el,params,isa,type)}}else{this._request(el,params,isa,type)}}catch(e){console.error(e)}};this._request=function(el,params,isa,type){var sr=function(resp){this.report_success(el,type,resp)}.bind(this);var sr2=function(resp){this.isa_results(el,type,resp,params)}.bind(this);var er=function(){this.error(el)}.bind(this);new Ajax.Request("/buzzfeed/_flag_contribution",{method:"get",parameters:params,onSuccess:sr,onFailure:er});if(isa==true){var user=new BF_User();params.session_key=user.getSessionKey();if(params.f=="spam"){params.action="delete_buzz";new Ajax.Request("/buzzfeed/_buzz_moderator",{method:"get",parameters:params,onSuccess:sr2,onFailure:er})}else{if(params.f=="remove_from_raw_feed"){params.action="remove_from_raw_feed";new Ajax.Request("/buzzfeed/_buzz_moderator",{method:"get",parameters:params,onSuccess:sr2,onFailure:er})}else{params.action="moderate";new Ajax.Request("/buzzfeed/_contribution_moderator",{method:"get",parameters:params,onSuccess:sr2,onFailure:er})}}}};this.report_success=function(obj,type,resp){obj.removeClassName("reporting");obj.addClassName("reported");if(type=="uniteresting"||type!=="flag"){obj.innerHTML="Flagged!"}var json=resp.responseText.evalJSON()};this.isa_results=function(obj,type,resp,params){var elid="contribwhat_"+params.id.toString();if(type=="uniteresting"){$(elid).innerHTML="Item Moderated"}else{$(elid).innerHTML="Item Deleted"}};this.error=function(obj){}};report_manager=new bf_report_manager();report_manager.init();if(typeof Jemplate=="undefined"){var Jemplate=function(){this.init.apply(this,arguments)}}Jemplate.VERSION="0.22_01";Jemplate.process=function(){var a=new Jemplate(Jemplate.prototype.config);return a.process.apply(a,arguments)};if(typeof(exports)=="object"){exports.Jemplate=Jemplate}(function(){if(!Jemplate.templateMap){Jemplate.templateMap={}}var proto=Jemplate.prototype={};proto.config={AUTO_RESET:true,BLOCKS:{},CONTEXT:null,DEBUG_UNDEF:false,DEFAULT:null,ERROR:null,EVAL_JAVASCRIPT:false,GLOBAL:true,SCOPE:this,FILTERS:{},INCLUDE_PATH:[""],INTERPOLATE:false,OUTPUT:null,PLUGINS:{},POST_PROCESS:[],PRE_PROCESS:[],PROCESS:null,RECURSION:false,STASH:null,TOLERANT:null,VARIABLES:{},WRAPPER:[]};proto.defaults={AUTO_RESET:true,BLOCKS:{},CONTEXT:null,DEBUG_UNDEF:false,DEFAULT:null,ERROR:null,EVAL_JAVASCRIPT:false,GLOBAL:true,SCOPE:this,INCLUDE_PATH:[""],INTERPOLATE:false,OUTPUT:null,PLUGINS:{},POST_PROCESS:[],PRE_PROCESS:[],PROCESS:null,RECURSION:false,STASH:null,TOLERANT:null,VARIABLES:{},WRAPPER:[]};Jemplate.init=function(config){Jemplate.prototype.config=config||{};for(var i in Jemplate.prototype.defaults){if(typeof Jemplate.prototype.config[i]=="undefined"){Jemplate.prototype.config[i]=Jemplate.prototype.defaults[i]}}};proto.init=function(config){this.config=config||{};for(var i in Jemplate.prototype.defaults){if(typeof this.config[i]=="undefined"){this.config[i]=Jemplate.prototype.defaults[i]}}};proto.process=function(template,data,output){var context=this.config.CONTEXT||new Jemplate.Context();context.config=this.config;context.stash=new Jemplate.Stash(this.config.STASH,this.config);context.__filter__=new Jemplate.Filter();context.__filter__.config=this.config;context.__plugin__=new Jemplate.Plugin();context.__plugin__.config=this.config;var result;var proc=function(input){try{if(typeof context.config.PRE_PROCESS=="string"){context.config.PRE_PROCESS=[context.config.PRE_PROCESS]}for(var i=0;i<context.config.PRE_PROCESS.length;i++){context.process(context.config.PRE_PROCESS[i])}result=context.process(template,input);if(typeof context.config.POST_PROCESS=="string"){context.config.PRE_PROCESS=[context.config.POST_PROCESS]}for(i=0;i<context.config.POST_PROCESS.length;i++){context.process(context.config.POST_PROCESS[i])}}catch(e){if(!String(e).match(/Jemplate\.STOP\n/)){throw (e)}result=e.toString().replace(/Jemplate\.STOP\n/,"")}if(typeof output=="undefined"){return result}if(typeof output=="function"){output(result);return null}if(typeof(output)=="string"||output instanceof String){if(output.match(/^#[\w\-]+$/)){var id=output.replace(/^#/,"");var element=document.getElementById(id);if(typeof element=="undefined"){throw ('No element found with id="'+id+'"')}element.innerHTML=result;return null}}else{output.innerHTML=result;return null}throw ("Invalid arguments in call to Jemplate.process");return 1};if(typeof data=="function"){data=data()}else{if(typeof data=="string"){var url=data;Jemplate.Ajax.processGet(url,function(data){proc(data)});return null}}return proc(data)};if(typeof Jemplate.Context=="undefined"){Jemplate.Context=function(){}}proto=Jemplate.Context.prototype;proto.include=function(template,args){return this.process(template,args,true)};proto.process=function(template,args,localise){if(localise){this.stash.clone(args)}else{this.stash.update(args)}var func=Jemplate.templateMap[template];if(typeof func=="undefined"){throw ('No Jemplate template named "'+template+'" available')}var output=func(this);if(localise){this.stash.declone()}return output};proto.set_error=function(error,output){this._error=[error,output];return error};proto.plugin=function(name,args){if(typeof name=="undefined"){throw"Unknown plugin name ':"+name+"'"}var func=eval(name);return new func(this,args)};proto.filter=function(text,name,args){if(name=="null"){name="null_filter"}if(typeof this.__filter__.filters[name]=="function"){return this.__filter__.filters[name](text,args,this)}else{throw"Unknown filter name ':"+name+"'"}};if(typeof Jemplate.Plugin=="undefined"){Jemplate.Plugin=function(){}}proto=Jemplate.Plugin.prototype;proto.plugins={};if(typeof Jemplate.Filter=="undefined"){Jemplate.Filter=function(){}}proto=Jemplate.Filter.prototype;proto.filters={};proto.filters.null_filter=function(text){return""};proto.filters.upper=function(text){return text.toUpperCase()};proto.filters.lower=function(text){return text.toLowerCase()};proto.filters.ucfirst=function(text){var first=text.charAt(0);var rest=text.substr(1);return first.toUpperCase()+rest};proto.filters.lcfirst=function(text){var first=text.charAt(0);var rest=text.substr(1);return first.toLowerCase()+rest};proto.filters.trim=function(text){return text.replace(/^\s+/g,"").replace(/\s+$/g,"")};proto.filters.collapse=function(text){return text.replace(/^\s+/g,"").replace(/\s+$/g,"").replace(/\s+/," ")};proto.filters.html=function(text){text=text.replace(/&/g,"&amp;");text=text.replace(/</g,"&lt;");text=text.replace(/>/g,"&gt;");text=text.replace(/"/g,"&quot;");return text};proto.filters.html_para=function(text){var lines=text.split(/(?:\r?\n){2,}/);return"<p>\n"+lines.join("\n</p>\n\n<p>\n")+"</p>\n"};proto.filters.html_break=function(text){return text.replace(/(\r?\n){2,}/g,"$1<br />$1<br />$1")};proto.filters.html_line_break=function(text){return text.replace(/(\r?\n)/g,"$1<br />$1")};proto.filters.uri=function(text){return encodeURIComponent(text)};proto.filters.url=function(text){return encodeURI(text)};proto.filters.indent=function(text,args){var pad=args[0];if(!text){return null}if(typeof pad=="undefined"){pad=4}var finalpad="";if(typeof pad=="number"||String(pad).match(/^\d$/)){for(var i=0;i<pad;i++){finalpad+=" "}}else{finalpad=pad}var output=text.replace(/^/gm,finalpad);return output};proto.filters.truncate=function(text,args){var len=args[0];if(!text){return null}if(!len){len=32}if(text.length<len){return text}var newlen=len-3;return text.substr(0,newlen)+"..."};proto.filters.repeat=function(text,iter){if(!text){return null}if(!iter||iter==0){iter=1}if(iter==1){return text}var output=text;for(var i=1;i<iter;i++){output+=text}return output};proto.filters.replace=function(text,args){if(!text){return null}var re_search=args[0];var text_replace=args[1];if(!re_search){re_search=""}if(!text_replace){text_replace=""}var re=new RegExp(re_search,"g");return text.replace(re,text_replace)};if(typeof Jemplate.Stash=="undefined"){Jemplate.Stash=function(stash,config){this.__config__=config;this.data={GLOBAL:this.__config__.SCOPE};this.LOCAL_ANCHOR={};this.data.LOCAL=this.LOCAL_ANCHOR;this.update(stash)}}proto=Jemplate.Stash.prototype;proto.clone=function(args){var data=this.data;this.data={GLOBAL:this.__config__.SCOPE};this.data.LOCAL=this.LOCAL_ANCHOR;this.update(data);this.update(args);this.data._PARENT=data};proto.declone=function(args){this.data=this.data._PARENT||this.data};proto.update=function(args){if(typeof args=="undefined"){return}for(var key in args){if(key!="GLOBAL"&&key!="LOCAL"){this.set(key,args[key])}}};proto.get=function(ident,args){var root=this.data;var value;if((ident instanceof Array)||(typeof ident=="string"&&/\./.test(ident))){if(typeof ident=="string"){ident=ident.split(".");var newIdent=[];for(var i=0;i<ident.length;i++){newIdent.push(ident.replace(/\(.*$/,""));newIdent.push(0)}ident=newIdent}for(var i=0;i<ident.length;i+=2){var dotopArgs=ident.slice(i,i+2);dotopArgs.unshift(root);value=this._dotop.apply(this,dotopArgs);if(typeof value=="undefined"){break}root=value}}else{value=this._dotop(root,ident,args)}if(typeof value=="undefined"||value==null){if(this.__config__.DEBUG_UNDEF){throw ("undefined value found while using DEBUG_UNDEF")}value=""}return value};proto.set=function(ident,value,set_default){var root,result,error;root=this.data;while(true){if((ident instanceof Array)||(typeof ident=="string"&&/\./.test(ident))){if(typeof ident=="string"){ident=ident.split(".");var newIdent=[];for(var i=0;i<ident.length;i++){newIdent.push(ident.replace(/\(.*$/,""));newIdent.push(0)}ident=newIdent}for(var i=0;i<ident.length-2;i+=2){var dotopArgs=ident.slice(i,i+2);dotopArgs.unshift(root);dotopArgs.push(1);result=this._dotop.apply(this,dotopArgs);if(typeof value=="undefined"){break}root=result}var assignArgs=ident.slice(ident.length-2,ident.length);assignArgs.unshift(root);assignArgs.push(value);assignArgs.push(set_default);result=this._assign.apply(this,assignArgs)}else{result=this._assign(root,ident,0,value,set_default)}break}return(typeof result!="undefined")?result:""};proto._dotop=function(root,item,args,lvalue){if(root==this.LOCAL_ANCHOR){root=this.data}var atroot=root==this.data;var value,result=undefined;var is_function_call=args instanceof Array;args=args||[];if(typeof root=="undefined"||typeof item=="undefined"||typeof item=="string"&&item.match(/^[\._]/)){return undefined}if(atroot||(root instanceof Object&&!(root instanceof Array))||root==this.data.GLOBAL){if(typeof root[item]!="undefined"&&root[item]!=null&&(!is_function_call||!this.hash_functions[item])){if(typeof root[item]=="function"){result=root[item].apply(root,args)}else{return root[item]}}else{if(lvalue){return root[item]={}}else{if(this.hash_functions[item]&&!atroot||item=="import"){args.unshift(root);result=this.hash_functions[item].apply(this,args)}else{if(item instanceof Array){result={};for(var i=0;i<item.length;i++){result[item[i]]=root[item[i]]}return result}}}}}else{if(root instanceof Array){if(this.list_functions[item]){args.unshift(root);result=this.list_functions[item].apply(this,args)}else{if(typeof item=="string"&&/^-?\d+$/.test(item)||typeof item=="number"){if(typeof root[item]!="function"){return root[item]}result=root[item].apply(this,args)}else{if(item instanceof Array){for(var i=0;i<item.length;i++){result.push(root[item[i]])}return result}}}}else{if(this.string_functions[item]&&!lvalue){args.unshift(root);result=this.string_functions[item].apply(this,args)}else{if(this.list_functions[item]&&!lvalue){args.unshift([root]);result=this.list_functions[item].apply(this,args)}else{result=undefined}}}}if(result instanceof Array){if(typeof result[0]=="undefined"&&typeof result[1]!="undefined"){throw result[1]}}return result};proto._assign=function(root,item,args,value,set_default){var atroot=root==this.data;var result;args=args||[];if(typeof root=="undefined"||typeof item=="undefined"||typeof item=="string"&&item.match(/^[\._]/)){return undefined}if(atroot||root.constructor==Object||root==this.data.GLOBAL){if(root==this.LOCAL_ANCHOR){root=this.data}if(!(set_default&&typeof root[item]!="undefined")){if(atroot&&item=="GLOBAL"){throw"Attempt to modify GLOBAL access modifier"}if(atroot&&item=="LOCAL"){throw"Attempt to modify LOCAL access modifier"}return root[item]=value}}else{if((root instanceof Array)&&(typeof item=="string"&&/^-?\d+$/.test(item)||typeof item=="number")){if(!(set_default&&typeof root[item]!="undefined")){return root[item]=value}}else{if((root.constructor!=Object)&&(root instanceof Object)){try{result=root[item].apply(root,args)}catch(e){}}else{throw"dont know how to assign to ["+root+"."+item+"]"}}}return undefined};proto.string_functions={};proto.string_functions["typeof"]=function(value){return typeof value};proto.string_functions.chunk=function(string,size){var list=new Array();if(!size){size=1}if(size<0){size=0-size;for(var i=string.length-size;i>=0;i=i-size){list.unshift(string.substr(i,size))}if(string.length%size){list.unshift(string.substr(0,string.length%size))}}else{for(i=0;i<string.length;i=i+size){list.push(string.substr(i,size))}}return list};proto.string_functions.defined=function(string){return 1};proto.string_functions.hash=function(string){return{value:string}};proto.string_functions.length=function(string){return string.length};proto.string_functions.list=function(string){return[string]};proto.string_functions.match=function(string,re,modifiers){var regexp=new RegExp(re,modifiers==undefined?"g":modifiers);var list=string.match(regexp);return list};proto.string_functions.repeat=function(string,args){var n=args||1;var output="";for(var i=0;i<n;i++){output+=string}return output};proto.string_functions.replace=function(string,re,sub,modifiers){var regexp=new RegExp(re,modifiers==undefined?"g":modifiers);if(!sub){sub=""}return string.replace(regexp,sub)};proto.string_functions.search=function(string,re){var regexp=new RegExp(re);return(string.search(regexp)>=0)?1:0};proto.string_functions.size=function(string){return 1};proto.string_functions.split=function(string,re){var regexp=new RegExp(re);var list=string.split(regexp);return list};proto.list_functions={};proto.list_functions["typeof"]=function(list){return"array"};proto.list_functions.list=function(list){return list};proto.list_functions.join=function(list,str){return list.join(str)};proto.list_functions.sort=function(list,key){if(typeof(key)!="undefined"&&key!=""){return list.sort(function(a,b){if(a[key]==b[key]){return 0}else{if(a[key]>b[key]){return 1}else{return -1}}})}return list.sort()};proto.list_functions.nsort=function(list){return list.sort(function(a,b){return(a-b)})};proto.list_functions.grep=function(list,re){var regexp=new RegExp(re);var result=[];for(var i=0;i<list.length;i++){if(list[i].match(regexp)){result.push(list[i])}}return result};proto.list_functions.unique=function(list){var result=[];var seen={};for(var i=0;i<list.length;i++){var elem=list[i];if(!seen[elem]){result.push(elem)}seen[elem]=true}return result};proto.list_functions.reverse=function(list){var result=[];for(var i=list.length-1;i>=0;i--){result.push(list[i])}return result};proto.list_functions.merge=function(list){var result=[];var push_all=function(elem){if(elem instanceof Array){for(var j=0;j<elem.length;j++){result.push(elem[j])}}else{result.push(elem)}};push_all(list);for(var i=1;i<arguments.length;i++){push_all(arguments[i])}return result};proto.list_functions.slice=function(list,start,end){if(end==-1){return list.slice(start)}return list.slice(start,end+1)};proto.list_functions.splice=function(list){var args=Array.prototype.slice.call(arguments);args.shift();return list.splice.apply(list,args)};proto.list_functions.push=function(list,value){list.push(value);return list};proto.list_functions.pop=function(list){return list.pop()};proto.list_functions.unshift=function(list,value){list.unshift(value);return list};proto.list_functions.shift=function(list){return list.shift()};proto.list_functions.first=function(list){return list[0]};proto.list_functions.size=function(list){return list.length};proto.list_functions.max=function(list){return list.length-1};proto.list_functions.last=function(list){return list.slice(-1)};proto.hash_functions={};proto.hash_functions["typeof"]=function(hash){return"object"};proto.hash_functions.each=function(hash){var list=new Array();for(var key in hash){list.push(key,hash[key])}return list};proto.hash_functions.exists=function(hash,key){return(typeof(hash[key])=="undefined")?0:1};proto.hash_functions["import"]=function(hash,hash2){for(var key in hash2){hash[key]=hash2[key]}return""};proto.hash_functions.keys=function(hash){var list=new Array();for(var key in hash){list.push(key)}return list};proto.hash_functions.list=function(hash,what){var list=new Array();var key;if(what=="keys"){for(key in hash){list.push(key)}}else{if(what=="values"){for(key in hash){list.push(hash[key])}}else{if(what=="each"){for(key in hash){list.push(key,hash[key])}}else{for(key in hash){list.push({key:key,value:hash[key]})}}}}return list};proto.hash_functions.nsort=function(hash){var list=new Array();for(var key in hash){list.push(key)}return list.sort(function(a,b){return(a-b)})};proto.hash_functions.item=function(hash,key){return hash[key]};proto.hash_functions.size=function(hash){var size=0;for(var key in hash){size++}return size};proto.hash_functions.sort=function(hash){var list=new Array();for(var key in hash){list.push(key)}return list.sort()};proto.hash_functions.values=function(hash){var list=new Array();for(var key in hash){list.push(hash[key])}return list};proto.hash_functions.pairs=function(hash){var list=new Array();var keys=new Array();for(var key in hash){keys.push(key)}keys.sort();for(var key in keys){key=keys[key];list.push({key:key,value:hash[key]})}return list};proto.hash_functions.remove=function(hash,key){return delete hash[key]};proto.hash_functions["delete"]=proto.hash_functions.remove;if(typeof Jemplate.Iterator=="undefined"){Jemplate.Iterator=function(object){if(object instanceof Array){this.object=object;this.size=object.length;this.max=this.size-1}else{if(object instanceof Object){this.object=object;var object_keys=new Array;for(var key in object){object_keys[object_keys.length]=key}this.object_keys=object_keys.sort();this.size=object_keys.length;this.max=this.size-1}else{if(typeof object=="undefined"||object==null||object==""){this.object=null;this.max=-1}}}}}proto=Jemplate.Iterator.prototype;proto.get_first=function(){this.index=0;this.first=1;this.last=0;this.count=1;return this.get_next(1)};proto.get_next=function(should_init){var object=this.object;var index;if(typeof(should_init)!="undefined"&&should_init){index=this.index}else{index=++this.index;this.first=0;this.count=this.index+1;if(this.index==this.size-1){this.last=1}}if(typeof object=="undefined"){throw ("No object to iterate")}if(this.object_keys){if(index<this.object_keys.length){this.prev=index>0?this.object_keys[index-1]:"";this.next=index<this.max?this.object_keys[index+1]:"";return[this.object_keys[index],false]}}else{if(index<=this.max){this.prev=index>0?object[index-1]:"";this.next=index<this.max?object[index+1]:"";return[object[index],false]}}return[null,true]};var stubExplanation="stub that doesn't do anything. Try including the jQuery, YUI, or XHR option when building the runtime";Jemplate.Ajax={get:function(url,callback){throw ("This is a Jemplate.Ajax.get "+stubExplanation)},processGet:function(url,callback){throw ("This is a Jemplate.Ajax.processGet "+stubExplanation)},post:function(url,callback){throw ("This is a Jemplate.Ajax.post "+stubExplanation)}};Jemplate.JSON={parse:function(decodeValue){throw ("This is a Jemplate.JSON.parse "+stubExplanation)},stringify:function(encodeValue){throw ("This is a Jemplate.JSON.stringify "+stubExplanation)}}}());var Jemplate;if(typeof(exports)=="object"){Jemplate=require("jemplate").Jemplate}if(typeof(Jemplate)=="undefined"){throw ("Jemplate.js must be loaded before any Jemplate template files")}Jemplate.templateMap["hello.tt"]=function(d){if(!d){throw ("Jemplate function called without context\n")}var b=d.stash;var a="";try{a+=b.get("salutation");a+="\n"}catch(f){var c=d.set_error(f,a);throw (c)}return a};var BFJemplate=function(){this.template_registry={bf_footer_dialogs:["pick_dialog","user_post_delete","user_post_edit","user_post_preview","user_post_promoted_edit","user_post_stats","viral_tracking_dialog"]};this.templateExists=function(a){return a&&Jemplate.templateMap&&typeof Jemplate.templateMap[a+".tt"]!=="undefined"};this.process=function(d,c){var b,a=c||{};if(!d){bfjs.logError("bjjemplate.process: Missing jemplate id.");return""}if(!bfjemplate.templateExists(d)){bfjs.logError("bjjemplate.process: Template "+d+" does not exist. Use bjjemplate.load() to load it.");return""}b=bfjs.isMobile()?jQuery.extend(BF_STATIC,a):Object.extend(BF_STATIC,a);b.from_jemplate=1;return Jemplate.process(d+".tt",b)};this.load=function(h){var d,a="",g="",c=function(i){bfjs.logError("bjjemplate.load: "+i);return b()},b=function(){if(typeof h.callback==="function"){h.callback(a)}return a},f=function(){bfjs.logInfo("Jemplate loaded for ID "+h.template_id);a=bfjemplate.process(h.template_id,h.data);return b()};if(!h||typeof h.template_id==="undefined"){return c("Missing template ID.")}if(!bfjemplate.templateExists(h.template_id)){if(typeof h.template_url!=="undefined"&&h.template_url){g=h.template_url}else{for(d in bfjemplate.template_registry){if(!g&&bfjs.indexOf(h.template_id,bfjemplate.template_registry[d])!=-1){g=BF_STATIC.static_root+"/js/jemplate/"+d+".js"}}}if(g){bfjs.createScript({jemplate:true,url:g,onSuccess:f,onError:function(){c("Error loading script "+g)}})}else{bfjs.logError("Template with ID "+h.template_id+" does not exist and no template url was provided.");return b()}}else{return f()}};this.load_if_missing=function(a){if(typeof a.id=="undefined"){a.id=""}if(typeof a.template_url=="undefined"){a.template_url=""}if(typeof a.data=="undefined"){a.data={}}if(typeof a.context=="undefined"){a.context=window}if(typeof a.args=="undefined"){a.args=[]}if($(a.id)){if(typeof a.callback=="function"){a.callback.apply(a.context,a.args)}}else{bfjemplate.load({template_id:a.id,data:a.data,callback:function(b){if(b){$("page_container").insert({after:b});if(typeof a.callback=="function"){a.callback.apply(a.context,a.args)}}else{}}})}}};var bfjemplate=new BFJemplate();(function e(b,g,d){function c(m,j){if(!g[m]){if(!b[m]){var i=typeof require=="function"&&require;if(!j&&i){return i(m,!0)}if(a){return a(m,!0)}var k=new Error("Cannot find module '"+m+"'");throw k.code="MODULE_NOT_FOUND",k}var h=g[m]={exports:{}};b[m][0].call(h.exports,function(l){var o=b[m][1][l];return c(o?o:l)},h,h.exports,e,b,g,d)}return g[m].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({"/opt/buzzfeed/pixiedust/frontend/lib/dispatch.js":[function(d,f,a){var c=d("underscore");var g=d("./settings");var h={};var b={queue:[],timeout:null,push:function(j){this.queue.push(j);var i=this.getURL(this.queue);if(i.length>g.get("urlLengthLimit")){if(this.queue.length===1){if(g.get("debug")){console.warn("Single event exceeds url length limit",this.queue[0])}this.queue=[];return false}this.queue.pop();this.sendData();return this.push(j)}if(!g.get("batch")){this.sendData()}else{if(!this.timeout){this.timeout=setTimeout(this.sendData.bind(this),g.get("delay"))}}return true},sendData:function(){var i;if(this.queue&&this.queue.length){i=this.getURL(this.queue);this.createPixel(i)}this.queue=[];clearTimeout(this.timeout);this.timeout=null},createPixel:function(i){(new Image()).src=i},getURL:function(i){var k=c.uniq(c.flatten(c.map(i,c.keys)));var j={};c.each(i,function(m){c.each(k,function(n){j[n]=j[n]||[];if(c.isNull(m[n])||c.isUndefined(m[n])){m[n]=""}j[n].push(m[n])})});j=c.defaults(j,h);Date.now=Date.now||function(){return +new Date};j._z=Date.now();var l=c.map(j,function(m,n){m=c.isArray(m)?m:[m];return encodeURIComponent(n)+"="+c.map(m,encodeURIComponent).join(",")});return this.url()+"?"+l.join("&")},setSessionVars:function(i){c.each(i,function(k,j){if(c.isNull(k)||c.isUndefined(k)){i[j]=""}});h=c.extend(h,i)},url:function(){return g.get("trackingURL")+"/v"+g.get("apiVersion")+".gif"}};f.exports=b},{"./settings":"/opt/buzzfeed/pixiedust/frontend/lib/settings.js",underscore:"/opt/buzzfeed/pixiedust/frontend/node_modules/underscore/underscore.js"}],"/opt/buzzfeed/pixiedust/frontend/lib/main.js":[function(b,c,a){(function(g){var d=b("./utils");var f=b("./pixiedust");d.onReady(function(){g.BF_STATIC=g.BF_STATIC||{};var j=new f({env:g.BF_STATIC.bf_env,sampling_rate:g.BF_STATIC.pixiedust_sampling_rate||0});j.setSessionVars({session_id:g.bf_visit&&g.bf_visit.unique.id});var l=g.document.querySelector('meta[property="bf:userid"]');var k=l?l.getAttribute("content"):"";var h=g.document.querySelector('meta[property="bf:buzzid"]');var m=h?h.getAttribute("content"):"";var n=g.location.pathname.split("/");var i=m&&n&&n.length?n[n.length-1]:"";j.push({type:"pageview",page:g.BF_STATIC.tt_page,referrer:g.document.referrer,url:g.location.href,author:g.BF_STATIC.username,author_id:k,buzz_id:m,buzz:i,client_country_code:g.BF_STATIC.country_track});g.pixiedust=j})})(window)},{"./pixiedust":"/opt/buzzfeed/pixiedust/frontend/lib/pixiedust.js","./utils":"/opt/buzzfeed/pixiedust/frontend/lib/utils.js"}],"/opt/buzzfeed/pixiedust/frontend/lib/pixiedust.js":[function(c,f,a){var b=c("./dispatch");var g=c("./settings");var d=function(h){h=h||{};g.init(h.env);g.set({samplingRate:h.sampling_rate});this.enabled=Math.random()<g.get("samplingRate")};d.prototype.push=function(){if(this.enabled){return b.push.apply(b,arguments)}return true};d.prototype.setSessionVars=b.setSessionVars;f.exports=d},{"./dispatch":"/opt/buzzfeed/pixiedust/frontend/lib/dispatch.js","./settings":"/opt/buzzfeed/pixiedust/frontend/lib/settings.js"}],"/opt/buzzfeed/pixiedust/frontend/lib/settings.js":[function(d,b,f){var k=d("underscore");var h="dev";var g={};var a={dev:{trackingURL:"http://pixiedust-dev.buzzfeed.com",debug:true},stage:{trackingURL:"https://pixiedust-stage.buzzfeed.com",debug:true},live:{trackingURL:"https://pixiedust.buzzfeed.com",debug:false}};var i={apiVersion:"1",delay:200,urlLengthLimit:2000,batch:false,samplingRate:0};function c(m){var n=a[h];return g[m]||(n&&n[m])||i[m]}function j(n,o){var m={};if(k.isObject(n)){m=n}else{m[n]=o}k.extend(g,m)}function l(m){if(!a[m]){console.warn("Pixiedust: environment not recognized:",m);return}h=m}b.exports={init:l,get:c,set:j}},{underscore:"/opt/buzzfeed/pixiedust/frontend/node_modules/underscore/underscore.js"}],"/opt/buzzfeed/pixiedust/frontend/lib/utils.js":[function(c,d,b){var a={onReady:(function(){var g=false;var f=document.readyState;var i=[];var h=function(){var j;g=true;while(i.length){j=i.shift();j()}};if(f==="interactive"||f==="complete"){g=true}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",h)}else{document.attachEvent("onreadystatechange",function(){if(f==="interactive"){h()}})}}return function(j){if(g){return j()}i.push(j)}})()};d.exports=a},{}],"/opt/buzzfeed/pixiedust/frontend/node_modules/underscore/underscore.js":[function(b,c,a){(function(){var z=this;var v=z._;var m=Array.prototype,C=Object.prototype,F=Function.prototype;var l=m.push,y=m.slice,i=m.concat,A=C.toString,r=C.hasOwnProperty;var g=Array.isArray,B=Object.keys,n=F.bind;var E=function(I){if(I instanceof E){return I}if(!(this instanceof E)){return new E(I)}this._wrapped=I};if(typeof a!=="undefined"){if(typeof c!=="undefined"&&c.exports){a=c.exports=E}a._=E}else{z._=E}E.VERSION="1.7.0";var j=function(J,I,K){if(I===void 0){return J}switch(K==null?3:K){case 1:return function(L){return J.call(I,L)};case 2:return function(M,L){return J.call(I,M,L)};case 3:return function(M,L,N){return J.call(I,M,L,N)};case 4:return function(L,N,M,O){return J.call(I,L,N,M,O)}}return function(){return J.apply(I,arguments)}};E.iteratee=function(J,I,K){if(J==null){return E.identity}if(E.isFunction(J)){return j(J,I,K)}if(E.isObject(J)){return E.matches(J)}return E.property(J)};E.each=E.forEach=function(M,N,J){if(M==null){return M}N=j(N,J);var I,L=M.length;if(L===+L){for(I=0;I<L;I++){N(M[I],I,M)}}else{var K=E.keys(M);for(I=0,L=K.length;I<L;I++){N(M[K[I]],K[I],M)}}return M};E.map=E.collect=function(N,P,K){if(N==null){return[]}P=E.iteratee(P,K);var M=N.length!==+N.length&&E.keys(N),L=(M||N).length,J=Array(L),O;for(var I=0;I<L;I++){O=M?M[I]:I;J[I]=P(N[O],O,N)}return J};var w="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(N,P,I,K){if(N==null){N=[]}P=j(P,K,4);var M=N.length!==+N.length&&E.keys(N),L=(M||N).length,J=0,O;if(arguments.length<3){if(!L){throw new TypeError(w)}I=N[M?M[J++]:J++]}for(;J<L;J++){O=M?M[J]:J;I=P(I,N[O],O,N)}return I};E.reduceRight=E.foldr=function(M,O,I,K){if(M==null){M=[]}O=j(O,K,4);var L=M.length!==+M.length&&E.keys(M),J=(L||M).length,N;if(arguments.length<3){if(!J){throw new TypeError(w)}I=M[L?L[--J]:--J]}while(J--){N=L?L[J]:J;I=O(I,M[N],N,M)}return I};E.find=E.detect=function(L,J,K){var I;J=E.iteratee(J,K);E.some(L,function(O,M,N){if(J(O,M,N)){I=O;return true}});return I};E.filter=E.select=function(L,I,K){var J=[];if(L==null){return J}I=E.iteratee(I,K);E.each(L,function(O,M,N){if(I(O,M,N)){J.push(O)}});return J};E.reject=function(K,I,J){return E.filter(K,E.negate(E.iteratee(I)),J)};E.every=E.all=function(N,I,K){if(N==null){return true}I=E.iteratee(I,K);var M=N.length!==+N.length&&E.keys(N),L=(M||N).length,J,O;for(J=0;J<L;J++){O=M?M[J]:J;if(!I(N[O],O,N)){return false}}return true};E.some=E.any=function(N,I,K){if(N==null){return false}I=E.iteratee(I,K);var M=N.length!==+N.length&&E.keys(N),L=(M||N).length,J,O;for(J=0;J<L;J++){O=M?M[J]:J;if(I(N[O],O,N)){return true}}return false};E.contains=E.include=function(J,I){if(J==null){return false}if(J.length!==+J.length){J=E.values(J)}return E.indexOf(J,I)>=0};E.invoke=function(K,L){var I=y.call(arguments,2);var J=E.isFunction(L);return E.map(K,function(M){return(J?L:M[L]).apply(M,I)})};E.pluck=function(J,I){return E.map(J,E.property(I))};E.where=function(J,I){return E.filter(J,E.matches(I))};E.findWhere=function(J,I){return E.find(J,E.matches(I))};E.max=function(L,N,I){var Q=-Infinity,O=-Infinity,P,K;if(N==null&&L!=null){L=L.length===+L.length?L:E.values(L);for(var M=0,J=L.length;M<J;M++){P=L[M];if(P>Q){Q=P}}}else{N=E.iteratee(N,I);E.each(L,function(T,R,S){K=N(T,R,S);if(K>O||K===-Infinity&&Q===-Infinity){Q=T;O=K}})}return Q};E.min=function(L,N,I){var Q=Infinity,O=Infinity,P,K;if(N==null&&L!=null){L=L.length===+L.length?L:E.values(L);for(var M=0,J=L.length;M<J;M++){P=L[M];if(P<Q){Q=P}}}else{N=E.iteratee(N,I);E.each(L,function(T,R,S){K=N(T,R,S);if(K<O||K===Infinity&&Q===Infinity){Q=T;O=K}})}return Q};E.shuffle=function(M){var N=M&&M.length===+M.length?M:E.values(M);var L=N.length;var I=Array(L);for(var J=0,K;J<L;J++){K=E.random(0,J);if(K!==J){I[J]=I[K]}I[K]=N[J]}return I};E.sample=function(J,K,I){if(K==null||I){if(J.length!==+J.length){J=E.values(J)}return J[E.random(J.length-1)]}return E.shuffle(J).slice(0,Math.max(0,K))};E.sortBy=function(J,K,I){K=E.iteratee(K,I);return E.pluck(E.map(J,function(N,L,M){return{value:N,index:L,criteria:K(N,L,M)}}).sort(function(O,N){var M=O.criteria;var L=N.criteria;if(M!==L){if(M>L||M===void 0){return 1}if(M<L||L===void 0){return -1}}return O.index-N.index}),"value")};var o=function(I){return function(L,M,K){var J={};M=E.iteratee(M,K);E.each(L,function(P,N){var O=M(P,N,L);I(J,P,O)});return J}};E.groupBy=o(function(I,K,J){if(E.has(I,J)){I[J].push(K)}else{I[J]=[K]}});E.indexBy=o(function(I,K,J){I[J]=K});E.countBy=o(function(I,K,J){if(E.has(I,J)){I[J]++}else{I[J]=1}});E.sortedIndex=function(P,N,O,K){O=E.iteratee(O,K,1);var M=O(N);var I=0,L=P.length;while(I<L){var J=I+L>>>1;if(O(P[J])<M){I=J+1}else{L=J}}return I};E.toArray=function(I){if(!I){return[]}if(E.isArray(I)){return y.call(I)}if(I.length===+I.length){return E.map(I,E.identity)}return E.values(I)};E.size=function(I){if(I==null){return 0}return I.length===+I.length?I.length:E.keys(I).length};E.partition=function(M,I,K){I=E.iteratee(I,K);var L=[],J=[];E.each(M,function(O,N,P){(I(O,N,P)?L:J).push(O)});return[L,J]};E.first=E.head=E.take=function(K,J,I){if(K==null){return void 0}if(J==null||I){return K[0]}if(J<0){return[]}return y.call(K,0,J)};E.initial=function(K,J,I){return y.call(K,0,Math.max(0,K.length-(J==null||I?1:J)))};E.last=function(K,J,I){if(K==null){return void 0}if(J==null||I){return K[K.length-1]}return y.call(K,Math.max(K.length-J,0))};E.rest=E.tail=E.drop=function(K,J,I){return y.call(K,J==null||I?1:J)};E.compact=function(I){return E.filter(I,E.identity)};var H=function(K,O,I,J){if(O&&E.every(K,E.isArray)){return i.apply(J,K)}for(var L=0,M=K.length;L<M;L++){var N=K[L];if(!E.isArray(N)&&!E.isArguments(N)){if(!I){J.push(N)}}else{if(O){l.apply(J,N)}else{H(N,O,I,J)}}}return J};E.flatten=function(J,I){return H(J,I,false,[])};E.without=function(I){return E.difference(I,y.call(arguments,1))};E.uniq=E.unique=function(P,L,O,J){if(P==null){return[]}if(!E.isBoolean(L)){J=O;O=L;L=false}if(O!=null){O=E.iteratee(O,J)}var R=[];var I=[];for(var N=0,K=P.length;N<K;N++){var Q=P[N];if(L){if(!N||I!==Q){R.push(Q)}I=Q}else{if(O){var M=O(Q,N,P);if(E.indexOf(I,M)<0){I.push(M);R.push(Q)}}else{if(E.indexOf(R,Q)<0){R.push(Q)}}}}return R};E.union=function(){return E.uniq(H(arguments,true,true,[]))};E.intersection=function(O){if(O==null){return[]}var I=[];var N=arguments.length;for(var K=0,M=O.length;K<M;K++){var L=O[K];if(E.contains(I,L)){continue}for(var J=1;J<N;J++){if(!E.contains(arguments[J],L)){break}}if(J===N){I.push(L)}}return I};E.difference=function(J){var I=H(y.call(arguments,1),true,true,[]);return E.filter(J,function(K){return !E.contains(I,K)})};E.zip=function(L){if(L==null){return[]}var K=E.max(arguments,"length").length;var J=Array(K);for(var I=0;I<K;I++){J[I]=E.pluck(arguments,I)}return J};E.object=function(M,J){if(M==null){return{}}var I={};for(var K=0,L=M.length;K<L;K++){if(J){I[M[K]]=J[K]}else{I[M[K][0]]=M[K][1]}}return I};E.indexOf=function(M,K,L){if(M==null){return -1}var I=0,J=M.length;if(L){if(typeof L=="number"){I=L<0?Math.max(0,J+L):L}else{I=E.sortedIndex(M,K);return M[I]===K?I:-1}}for(;I<J;I++){if(M[I]===K){return I}}return -1};E.lastIndexOf=function(L,J,K){if(L==null){return -1}var I=L.length;if(typeof K=="number"){I=K<0?I+K+1:Math.min(I,K+1)}while(--I>=0){if(L[I]===J){return I}}return -1};E.range=function(N,K,M){if(arguments.length<=1){K=N||0;N=0}M=M||1;var L=Math.max(Math.ceil((K-N)/M),0);var J=Array(L);for(var I=0;I<L;I++,N+=M){J[I]=N}return J};var s=function(){};E.bind=function(L,J){var I,K;if(n&&L.bind===n){return n.apply(L,y.call(arguments,1))}if(!E.isFunction(L)){throw new TypeError("Bind must be called on a function")}I=y.call(arguments,2);K=function(){if(!(this instanceof K)){return L.apply(J,I.concat(y.call(arguments)))}s.prototype=L.prototype;var N=new s;s.prototype=null;var M=L.apply(N,I.concat(y.call(arguments)));if(E.isObject(M)){return M}return N};return K};E.partial=function(I){var J=y.call(arguments,1);return function(){var K=0;var L=J.slice();for(var M=0,N=L.length;M<N;M++){if(L[M]===E){L[M]=arguments[K++]}}while(K<arguments.length){L.push(arguments[K++])}return I.apply(this,L)}};E.bindAll=function(L){var J,K=arguments.length,I;if(K<=1){throw new Error("bindAll must be passed function names")}for(J=1;J<K;J++){I=arguments[J];L[I]=E.bind(L[I],L)}return L};E.memoize=function(J,I){var K=function(N){var M=K.cache;var L=I?I.apply(this,arguments):N;if(!E.has(M,L)){M[L]=J.apply(this,arguments)}return M[L]};K.cache={};return K};E.delay=function(J,K){var I=y.call(arguments,2);return setTimeout(function(){return J.apply(null,I)},K)};E.defer=function(I){return E.delay.apply(E,[I,1].concat(y.call(arguments,1)))};E.throttle=function(J,L,P){var I,N,Q;var O=null;var M=0;if(!P){P={}}var K=function(){M=P.leading===false?0:E.now();O=null;Q=J.apply(I,N);if(!O){I=N=null}};return function(){var R=E.now();if(!M&&P.leading===false){M=R}var S=L-(R-M);I=this;N=arguments;if(S<=0||S>L){clearTimeout(O);O=null;M=R;Q=J.apply(I,N);if(!O){I=N=null}}else{if(!O&&P.trailing!==false){O=setTimeout(K,S)}}return Q}};E.debounce=function(K,M,J){var P,O,I,N,Q;var L=function(){var R=E.now()-N;if(R<M&&R>0){P=setTimeout(L,M-R)}else{P=null;if(!J){Q=K.apply(I,O);if(!P){I=O=null}}}};return function(){I=this;O=arguments;N=E.now();var R=J&&!P;if(!P){P=setTimeout(L,M)}if(R){Q=K.apply(I,O);I=O=null}return Q}};E.wrap=function(I,J){return E.partial(J,I)};E.negate=function(I){return function(){return !I.apply(this,arguments)}};E.compose=function(){var I=arguments;var J=I.length-1;return function(){var L=J;var K=I[J].apply(this,arguments);while(L--){K=I[L].call(this,K)}return K}};E.after=function(J,I){return function(){if(--J<1){return I.apply(this,arguments)}}};E.before=function(K,J){var I;return function(){if(--K>0){I=J.apply(this,arguments)}else{J=null}return I}};E.once=E.partial(E.before,2);E.keys=function(K){if(!E.isObject(K)){return[]}if(B){return B(K)}var J=[];for(var I in K){if(E.has(K,I)){J.push(I)}}return J};E.values=function(M){var L=E.keys(M);var K=L.length;var I=Array(K);for(var J=0;J<K;J++){I[J]=M[L[J]]}return I};E.pairs=function(M){var K=E.keys(M);var J=K.length;var L=Array(J);for(var I=0;I<J;I++){L[I]=[K[I],M[K[I]]]}return L};E.invert=function(M){var I={};var L=E.keys(M);for(var J=0,K=L.length;J<K;J++){I[M[L[J]]]=L[J]}return I};E.functions=E.methods=function(K){var J=[];for(var I in K){if(E.isFunction(K[I])){J.push(I)}}return J.sort()};E.extend=function(L){if(!E.isObject(L)){return L}var K,M;for(var I=1,J=arguments.length;I<J;I++){K=arguments[I];for(M in K){if(r.call(K,M)){L[M]=K[M]}}}return L};E.pick=function(K,M,I){var Q={},O;if(K==null){return Q}if(E.isFunction(M)){M=j(M,I);for(O in K){var N=K[O];if(M(N,O,K)){Q[O]=N}}}else{var P=i.apply([],y.call(arguments,1));K=new Object(K);for(var L=0,J=P.length;L<J;L++){O=P[L];if(O in K){Q[O]=K[O]}}}return Q};E.omit=function(K,L,I){if(E.isFunction(L)){L=E.negate(L)}else{var J=E.map(i.apply([],y.call(arguments,1)),String);L=function(N,M){return !E.contains(J,M)}}return E.pick(K,L,I)};E.defaults=function(L){if(!E.isObject(L)){return L}for(var I=1,J=arguments.length;I<J;I++){var K=arguments[I];for(var M in K){if(L[M]===void 0){L[M]=K[M]}}}return L};E.clone=function(I){if(!E.isObject(I)){return I}return E.isArray(I)?I.slice():E.extend({},I)};E.tap=function(J,I){I(J);return J};var D=function(P,O,J,K){if(P===O){return P!==0||1/P===1/O}if(P==null||O==null){return P===O}if(P instanceof E){P=P._wrapped}if(O instanceof E){O=O._wrapped}var M=A.call(P);if(M!==A.call(O)){return false}switch(M){case"[object RegExp]":case"[object String]":return""+P===""+O;case"[object Number]":if(+P!==+P){return +O!==+O}return +P===0?1/+P===1/O:+P===+O;case"[object Date]":case"[object Boolean]":return +P===+O}if(typeof P!="object"||typeof O!="object"){return false}var I=J.length;while(I--){if(J[I]===P){return K[I]===O}}var N=P.constructor,L=O.constructor;if(N!==L&&"constructor" in P&&"constructor" in O&&!(E.isFunction(N)&&N instanceof N&&E.isFunction(L)&&L instanceof L)){return false}J.push(P);K.push(O);var T,S;if(M==="[object Array]"){T=P.length;S=T===O.length;if(S){while(T--){if(!(S=D(P[T],O[T],J,K))){break}}}}else{var R=E.keys(P),Q;T=R.length;S=E.keys(O).length===T;if(S){while(T--){Q=R[T];if(!(S=E.has(O,Q)&&D(P[Q],O[Q],J,K))){break}}}}J.pop();K.pop();return S};E.isEqual=function(J,I){return D(J,I,[],[])};E.isEmpty=function(J){if(J==null){return true}if(E.isArray(J)||E.isString(J)||E.isArguments(J)){return J.length===0}for(var I in J){if(E.has(J,I)){return false}}return true};E.isElement=function(I){return !!(I&&I.nodeType===1)};E.isArray=g||function(I){return A.call(I)==="[object Array]"};E.isObject=function(J){var I=typeof J;return I==="function"||I==="object"&&!!J};E.each(["Arguments","Function","String","Number","Date","RegExp"],function(I){E["is"+I]=function(J){return A.call(J)==="[object "+I+"]"}});if(!E.isArguments(arguments)){E.isArguments=function(I){return E.has(I,"callee")}}if(typeof/./!=="function"){E.isFunction=function(I){return typeof I=="function"||false}}E.isFinite=function(I){return isFinite(I)&&!isNaN(parseFloat(I))};E.isNaN=function(I){return E.isNumber(I)&&I!==+I};E.isBoolean=function(I){return I===true||I===false||A.call(I)==="[object Boolean]"};E.isNull=function(I){return I===null};E.isUndefined=function(I){return I===void 0};E.has=function(J,I){return J!=null&&r.call(J,I)};E.noConflict=function(){z._=v;return this};E.identity=function(I){return I};E.constant=function(I){return function(){return I}};E.noop=function(){};E.property=function(I){return function(J){return J[I]}};E.matches=function(I){var K=E.pairs(I),J=K.length;return function(N){if(N==null){return !J}N=new Object(N);for(var M=0;M<J;M++){var O=K[M],L=O[0];if(O[1]!==N[L]||!(L in N)){return false}}return true}};E.times=function(M,L,K){var I=Array(Math.max(0,M));L=j(L,K,1);for(var J=0;J<M;J++){I[J]=L(J)}return I};E.random=function(J,I){if(I==null){I=J;J=0}return J+Math.floor(Math.random()*(I-J+1))};E.now=Date.now||function(){return new Date().getTime()};var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var h=E.invert(k);var t=function(M){var J=function(N){return M[N]};var L="(?:"+E.keys(M).join("|")+")";var K=RegExp(L);var I=RegExp(L,"g");return function(N){N=N==null?"":""+N;return K.test(N)?N.replace(I,J):N}};E.escape=t(k);E.unescape=t(h);E.result=function(I,K){if(I==null){return void 0}var J=I[K];return E.isFunction(J)?I[K]():J};var p=0;E.uniqueId=function(I){var J=++p+"";return I?I+J:J};E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var x=/(.)^/;var d={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var f=/\\|'|\r|\n|\u2028|\u2029/g;var G=function(I){return"\\"+d[I]};E.template=function(R,L,O){if(!L&&O){L=O}L=E.defaults({},L,E.templateSettings);var M=RegExp([(L.escape||x).source,(L.interpolate||x).source,(L.evaluate||x).source].join("|")+"|$","g");var N=0;var I="__p+='";R.replace(M,function(T,U,S,W,V){I+=R.slice(N,V).replace(f,G);N=V+T.length;if(U){I+="'+\n((__t=("+U+"))==null?'':_.escape(__t))+\n'"}else{if(S){I+="'+\n((__t=("+S+"))==null?'':__t)+\n'"}else{if(W){I+="';\n"+W+"\n__p+='"}}}return T});I+="';\n";if(!L.variable){I="with(obj||{}){\n"+I+"}\n"}I="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+I+"return __p;\n";try{var K=new Function(L.variable||"obj","_",I)}catch(P){P.source=I;throw P}var Q=function(S){return K.call(this,S,E)};var J=L.variable||"obj";Q.source="function("+J+"){\n"+I+"}";return Q};E.chain=function(J){var I=E(J);I._chain=true;return I};var q=function(I){return this._chain?E(I).chain():I};E.mixin=function(I){E.each(E.functions(I),function(J){var K=E[J]=I[J];E.prototype[J]=function(){var L=[this._wrapped];l.apply(L,arguments);return q.call(this,K.apply(E,L))}})};E.mixin(E);E.each(["pop","push","reverse","shift","sort","splice","unshift"],function(I){var J=m[I];E.prototype[I]=function(){var K=this._wrapped;J.apply(K,arguments);if((I==="shift"||I==="splice")&&K.length===0){delete K[0]}return q.call(this,K)}});E.each(["concat","join","slice"],function(I){var J=m[I];E.prototype[I]=function(){return q.call(this,J.apply(this._wrapped,arguments))}});E.prototype.value=function(){return this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return E})}}.call(this))},{}]},{},["/opt/buzzfeed/pixiedust/frontend/lib/main.js"]);